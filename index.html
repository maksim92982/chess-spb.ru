<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JANART STUDIO</title>
    <style>

        /* Стили для админ-панейли */
        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 3000;
            padding: 100px 20px 20px;
            overflow-y: auto;
        }

        .admin-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: #000;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 3001;
        }

        .admin-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .admin-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 8px;
        }

        .admin-section h2 {
            margin-bottom: 15px;
            color: #333;
        }

        .admin-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .admin-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .admin-btn {
            background: #000;
            color: white;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 16px;
        }

        .admin-btn:hover {
            background: #333;
        }

        .admin-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .painting-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }

        .preview-img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
        }

        .upload-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 10px;
        }

        .github-config {
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .collapse-arrow {
            font-size: 16px;
            transition: transform 0.3s ease;
            color: #666;
        }
        
        /* Стили для сворачиваемых блоков админ-панели */
        .admin-section.collapsible {
            overflow: hidden;
        }
        
        .admin-section-header {
            background: #e9ecef;
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            transition: background-color 0.3s ease;
            margin: 0;
        }
        
        .admin-section-header:hover {
            background: #dee2e6;
        }
        
        .admin-section-header h2 {
            margin: 0;
            color: #333;
        }
        
        .admin-section-content {
            padding: 15px;
            transition: max-height 0.3s ease, padding 0.3s ease, opacity 0.3s ease;
            overflow: hidden;
            opacity: 1;
            max-height: none;
        }
        
        .admin-section.collapsed .admin-section-content {
            max-height: 0;
            padding: 0 15px;
            opacity: 0;
        }
        
        .admin-section.collapsed .collapse-arrow {
            transform: rotate(-90deg);
        }
        
        /* Стили для раздела управления фотографиями */
        #photos-management-content {
            max-height: none !important;
            overflow: visible !important;
        }
        
        .photos-management-section {
            max-height: none !important;
            overflow: visible !important;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #007bff;
            transition: width 0.3s ease;
        }

        .config-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        /* Общие стили */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cormorant Garamond', serif;
        }
        
        body {
            color: #000;
            line-height: 1.6;
            background-color: #fff;
        }
        
        a {
            text-decoration: none;
            color: inherit;
        }
        
        /* Шапка */
        header {
            padding: 30px 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            background-color: rgba(255, 255, 255, 0.95);
            transition: padding 0.3s ease;
        }
        
        .logo {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 2px;
            font-family: 'Italiana', serif;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .logo:hover {
            opacity: 0.7;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 40px;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        nav ul li a:hover {
            opacity: 0.7;
        }
        
        /* Мобильное меню */
        .mobile-menu {
            display: none;
            cursor: pointer;
        }
        
        .mobile-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }
        
        .mobile-nav.active {
            transform: translateY(0);
        }
        
        .close-menu {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
        }

        .auth-modal {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1100;
        }

        .auth-modal.active {
            display: flex;
        }

        .auth-modal__backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
        }

        .auth-modal__panel {
            position: relative;
            background: #fff;
            border-radius: 20px;
            padding: 32px;
            width: min(520px, 95%);
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.35);
            z-index: 1;
        }

        .auth-modal__panel h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 26px;
        }

        .auth-modal__form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 14px;
        }

        .auth-modal__form label {
            font-size: 13px;
            color: #555;
        }

        .auth-modal__form input {
            padding: 11px 14px;
            border-radius: 8px;
            border: 1px solid #c9c9c9;
            font-size: 16px;
        }

        .auth-modal__actions {
            margin-top: 18px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .auth-modal__actions button {
            flex: 1;
            min-width: 140px;
        }

        .auth-modal__footer {
            margin-top: 16px;
            display: flex;
            justify-content: space-between;
            font-size: 13px;
        }

        .auth-modal__footer button {
            background: none;
            border: none;
            color: #0d6efd;
            padding: 0;
            cursor: pointer;
        }

        .link-btn {
            background: none;
            border: none;
            color: #0d6efd;
            text-decoration: underline;
            cursor: pointer;
            padding: 0;
            font-size: 13px;
        }

        .auth-modal__message {
            min-height: 22px;
            margin-top: 8px;
            font-size: 14px;
        }

        .auth-modal__message.success {
            color: #0d6efd;
        }

        .auth-modal__message.error {
            color: #dc3545;
        }
        
        /* Главная страница */
        .main-content {
            margin-top: 120px;
            padding: 0 60px;
        }
        
        .hero-image {
            width: 100%;
            height: 70vh;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }
        
        .hero-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        /* Галерея */
        .gallery-container {
            padding: 0 24px;
            max-width: none;
            width: 100%;
            margin: 0 auto;
            margin-top: 80px; /* Отступ для навигационной полосы */
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 24px;
        }

        .gallery-item {
            position: relative;
            cursor: pointer;
            overflow: hidden;
            border-radius: 0;
            background: #fff;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        /* Контейнер изображения: квадратный, чтобы три карточки заполняли всю ширину и давали большую высоту */
        .gallery-image-container {
            position: relative;
            width: 100%;
            aspect-ratio: 1 / 1;
            overflow: hidden;
            background: #f5f5f5;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        .gallery-item img.hover-image {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .gallery-item:hover img.hover-image {
            opacity: 1;
        }

        .gallery-item-info {
            padding: 20px;
            background: #fff;
        }

        .gallery-item-title {
            font-size: 16px;
            font-weight: 500;
            color: #212121;
            margin-bottom: 8px;
            font-family: 'Onest', sans-serif;
        }

        .gallery-item-price {
            font-size: 15px;
            color: #212121;
            font-weight: 400;
            margin-bottom: 8px;
        }

        .gallery-item-size {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .gallery-empty {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
        }

        /* Модальное окно картины */
        .painting-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            visibility: visible;
            opacity: 1;
        }

        .painting-modal__overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 1);
        }

        .painting-modal__container {
            position: relative;
            width: 90%;
            max-width: 1000px;
            max-height: 85vh;
            background: #fff;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .painting-modal__close {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10001;
        }

        .painting-modal__back {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10001;
        }

        .painting-modal__back-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .painting-modal__close-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .painting-modal__content {
            display: flex;
            height: 100%;
            padding-top: 60px; /* опускаем контент модалки ниже на 60px */
            box-sizing: border-box;
        }

        .painting-modal__gallery {
            flex: 1;
            padding: 20px;
        }

        .painting-modal__info {
            flex: 1;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .painting-slider {
            position: relative;
        }

        .painting-slider__main {
            position: relative;
            margin-bottom: 20px;
        }

        .painting-slider__image-container {
            width: 100%;
            /* Фиксируем высоту контейнера от высоты окна, чтобы масштаб был одинаковым */
            height: calc(100vh - 260px); /* 60px верхний отступ контента + ~200px под миниатюры/отступы */
            position: relative;
            overflow: hidden;
            background: #ebebeb;
            cursor: zoom-in;
        }
        
        .painting-slider__images-wrapper {
            display: flex;
            height: 100%;
            position: relative;
            transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform;
            transform: translateX(0);
            cursor: grab;
            user-select: none;
            -webkit-user-select: none;
            touch-action: pan-y pinch-zoom;
        }
        
        .painting-slider__image-item {
            flex-shrink: 0;
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .painting-slider__image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
            visibility: visible;
            opacity: 1;
            background: #f5f5f5;
        }
        
        .painting-slider__image--next {
            opacity: 0;
            pointer-events: none;
        }

        .painting-slider__image-container.zoomed {
            cursor: zoom-in; /* первая ступень зума — курсор с плюсиком */
        }

        .painting-slider__image-container.zoomed-high {
            cursor: zoom-out; /* вторая ступень зума — курсор с минусом */
        }

        .painting-slider__image-container.zoomed .painting-slider__image {
            transform: scale(2);
            cursor: zoom-out;
        }

        .painting-slider__nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            z-index: 100;
        }

        .painting-slider__arrow {
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: all;
            transition: all 0.2s ease;
            z-index: 1000;
            position: absolute;
        }

        /* Отключенная стрелка */
        .painting-slider__arrow[disabled] {
            opacity: 0.35;
            pointer-events: none;
        }

        .painting-slider__arrow:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }

        .painting-slider__arrow--prev {
            left: 10px;
        }

        .painting-slider__arrow--next {
            right: 10px;
        }
        
        /* Улучшаем видимость стрелок на мобильных устройствах */
        @media (max-width: 768px) {
            .painting-slider__arrow {
                width: 50px;
                height: 50px;
                background: rgba(128, 128, 128, 0.2); /* Серый цвет с 20% непрозрачности */
                border: 3px solid rgba(255, 255, 255, 0.3); /* Более прозрачная белая рамка */
                z-index: 1001;
                transition: background 0.2s ease, opacity 0.2s ease;
            }
            
            /* При нажатии - 40% непрозрачности */
            .painting-slider__arrow:active {
                background: rgba(128, 128, 128, 0.4);
                border-color: rgba(255, 255, 255, 0.5);
            }
            
            /* При наведении (для устройств с поддержкой hover) */
            .painting-slider__arrow:hover {
                background: rgba(128, 128, 128, 0.3);
                border-color: rgba(255, 255, 255, 0.4);
            }
            
            .painting-slider__arrow--prev {
                left: 5px;
            }
            
            .painting-slider__arrow--next {
                right: 5px;
            }
        }

        .painting-slider__thumbs {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .painting-slider__thumb {
            width: 80px;
            height: 80px;
            object-fit: cover;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s ease;
            flex-shrink: 0;
        }

        .painting-slider__thumb.active {
            opacity: 1;
        }

        .painting-slider__thumb:hover {
            opacity: 1;
        }

        .painting-modal__title {
            font-size: 17px;
            font-weight: 500;
            color: #212121;
            margin-bottom: 10px;
            font-family: 'Onest', sans-serif;
        }

        .painting-modal__price {
            font-size: 15px;
            color: #212121;
            font-weight: 400;
            margin-bottom: 20px;
        }

        .painting-modal__size {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }

        .painting-modal__description {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .painting-modal__btn {
            padding: 12px 24px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            font-family: 'Onest', sans-serif;
            transition: all 0.2s ease;
        }

        .painting-modal__btn--primary {
            background: #333;
            color: #fff;
        }

        .painting-modal__btn--primary:hover {
            background: #b89860;
        }

        @media (max-width: 768px) {
            .gallery-container {
                margin-top: 60px; /* Меньший отступ на мобильных */
            }
            
            .painting-modal {
                overflow-y: auto;
                overflow-x: hidden;
            }
            
            .painting-modal__container {
                width: 95%;
                max-height: 95vh;
                overflow-y: auto;
            }
            
            .painting-modal__content {
                flex-direction: column;
                padding-top: 40px;
                min-height: auto;
            }
            
            .painting-modal__gallery {
                padding: 10px;
                flex-shrink: 0;
            }
            
            /* Оптимизация для мобильных устройств */
            .gallery-image-container {
                min-height: 200px;
            }
            
            .painting-slider__image-container {
                height: 60vh; /* фиксированная высота для изображения */
                max-height: 500px;
            }
            
            .painting-slider__thumbs {
                margin-bottom: 20px;
            }
            
            .painting-slider__thumb {
                width: 40px;
                height: 40px;
            }
            
            /* Показываем мобильную информацию на всех мобильных устройствах */
            .painting-modal__info {
                display: none;
            }
            
            .painting-modal__mobile-info {
                display: block;
            }
        }
        
        /* Стили для мобильной информации о картине */
        .painting-modal__mobile-info {
            display: none;
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            position: relative;
            z-index: 10;
        }
        
        .painting-modal__mobile-header {
            margin-bottom: 15px;
        }
        
        .painting-modal__mobile-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.8rem;
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .painting-modal__mobile-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }
        
        .painting-modal__mobile-details {
            margin-bottom: 20px;
        }
        
        .painting-modal__mobile-size {
            font-size: 1rem;
            color: #666;
            margin-bottom: 10px;
        }
        
        .painting-modal__mobile-description {
            font-size: 0.9rem;
            color: #555;
            line-height: 1.4;
        }
        
        .painting-modal__mobile-actions {
            text-align: center;
            margin-bottom: 60px; /* Отступ после кнопки купить */
        }
        
        .painting-modal__mobile-actions .painting-modal__btn {
            width: 100%;
            padding: 15px;
            font-size: 16px;
        }
        
        /* Дополнительные оптимизации для очень маленьких экранов */
        @media (max-width: 480px) {
            .gallery-container {
                padding: 0 12px;
            }
            
            .gallery-grid {
                gap: 12px;
            }
            
            .gallery-image-container {
                min-height: 150px;
            }
            
            .painting-modal__info {
                display: none;
            }
            
            .painting-modal__mobile-info {
                display: block;
            }
            
            .painting-slider__image-container {
                height: 50vh;
                max-height: 400px;
            }
            }

        /* ПК: визуально уменьшаем модалку ~на 35% за счёт меньшей ширины */
        @media (min-width: 1024px) {
            /* Полноэкранная модалка на ПК */
            .painting-modal {
                width: 100vw;
                height: 100vh;
            }
            .painting-modal__container {
                position: fixed;
                width: 100vw;
                height: 100vh;
                max-width: none;
                max-height: none;
                border-radius: 0;
                box-shadow: none;
            }
            .painting-modal__content {
                height: 100%;
            }
        }
        
        .product-title {
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .product-price {
            font-size: 14px;
        }
        
        .product-photos-count {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .sold-out {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #000;
            color: #fff;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        /* Страница товара */
        .product-page {
            display: none;
            padding: 120px 60px 60px;
        }
        
        .product-container {
            display: flex;
            flex-wrap: wrap;
            gap: 40px;
            justify-content: center;
        }
        
        .product-gallery {
            flex: 1;
            min-width: 300px;
            max-width: 75%;
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            gap: 15px;
            position: relative;
        }
        
        .product-thumbnails {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 80px;
        }
        
        .product-thumbnail {
            width: 80px;
            height: 80px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s ease;
            border: 2px solid transparent;
        }
        
        .product-thumbnail:hover,
        .product-thumbnail.active {
            opacity: 1;
            border-color: #000;
        }
        
        .product-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .product-image-main {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            max-height: 65vh;
            position: relative;
            overflow: hidden;
            touch-action: pan-y;
        }
        
        .product-image-main img {
            max-width: 100%;
            max-height: 65vh;
            width: auto;
            height: auto;
            object-fit: contain;
            transition: transform 0.3s ease;
        }
        /* Стрелки навигации */
        .nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: background-color 0.3s ease;
            border: none;
        }
        .nav-arrow:hover {
            background: rgba(255, 255, 255, 0.95);
        }
        
        .nav-arrow.prev {
            left: 10px;
        }
        
        .nav-arrow.next {
            right: 10px;
        }
        
        .nav-arrow::before {
            content: '';
            width: 12px;
            height: 12px;
            border: 2px solid #000;
            border-width: 2px 2px 0 0;
            display: inline-block;
        }
        
        .nav-arrow.prev::before {
            transform: rotate(-135deg);
            margin-right: -2px;
        }
        
        .nav-arrow.next::before {
            transform: rotate(45deg);
            margin-left: -2px;
        }
        
        .product-details {
            flex: 1;
            min-width: 300px;
            max-width: 400px;
        }
        
        .back-button {
            display: inline-block;
            margin-bottom: 30px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .back-button:hover {
            opacity: 0.7;
        }
        
        .add-to-cart {
            background: #000;
            color: #fff;
            border: none;
            padding: 15px 30px;
            margin-top: 20px;
            cursor: pointer;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .add-to-cart:hover {
            background: #333;
        }
        
        /* Биография */
        .bio-page {
            display: none;
            padding: 120px 60px 60px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .bio-page h1 {
            margin-bottom: 30px;
            font-size: 32px;
        }
        
        .bio-page p {
            margin-bottom: 20px;
            font-size: 18px;
            line-height: 1.8;
        }
        
        /* Контакты */
        .contact-page {
            display: none;
            padding: 120px 60px 60px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .contact-page h1 {
            margin-bottom: 30px;
            font-size: 32px;
        }
        
        .contact-form {
            display: flex;
            flex-direction: column;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            font-size: 16px;
        }
        
        .form-group textarea {
            min-height: 150px;
        }
        
        .submit-button {
            background: #000;
            color: #fff;
            border: none;
            padding: 15px 30px;
            cursor: pointer;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            align-self: flex-start;
        }
        
        .submit-button:hover {
            background: #333;
        }
        
        /* Футер */
        footer {
            padding: 60px;
            background: #f7f7f7;
            margin-top: 60px;
            text-align: center;
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 30px;
        }
        
        .social-links a {
            font-size: 18px;
            padding: 12px 20px;
            transition: opacity 0.3s ease;
        }
        
        .social-links a:hover {
            opacity: 0.7;
        }
        
        /* Выпадающие меню */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 250px;
            width: max-content;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1000;
            border-radius: 4px;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 1px solid #ddd;
        }
        
        /* Стили для мобильного выпадающего меню */
        .mobile-nav .dropdown-content {
            position: static;
            display: none;
            background-color: transparent;
            box-shadow: none;
            margin-top: 10px;
            min-width: 250px;
            width: max-content;
        }
        
            .mobile-nav .dropdown-content a {
                padding: 6px 15px !important;
                font-size: 16px !important;
                color: #333 !important;
                font-family: inherit !important;
                font-weight: normal !important;
                text-align: left !important;
                transition: opacity 0.3s ease !important;
                border: none !important;
                background: none !important;
                cursor: pointer !important;
                text-transform: none !important;
                letter-spacing: normal !important;
                white-space: nowrap !important;
            }
            
            .mobile-nav .dropdown-content a:hover {
                opacity: 0.7;
            }
        
        .dropdown-content a {
            color: black !important;
            padding: 8px 20px !important;
            text-decoration: none !important;
            display: block !important;
            transition: opacity 0.3s ease !important;
            font-size: 18px !important;
            font-family: inherit !important;
            font-weight: normal !important;
            text-align: left !important;
            border: none !important;
            background: none !important;
            cursor: pointer !important;
            text-transform: none !important;
            letter-spacing: normal !important;
            white-space: nowrap !important;
        }
        
        .dropdown-content a:hover {
            opacity: 0.7;
        }
        
        .dropdown:hover .dropdown-content {
            display: block;
        }
        
        .dropdown:hover .nav-link {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Стили для радиокнопок в админ-панели */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }
        
        .radio-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .radio-item:hover {
            background-color: #f8f9fa;
        }
        
        .radio-item input[type="radio"] {
            margin: 0;
        }
        
        .radio-item label {
            margin: 0;
            cursor: pointer;
            flex: 1;
        }
        
        .radio-item input[type="radio"]:checked + label {
            font-weight: bold;
            color: #007bff;
        }
        
        /* Скрытие корзины когда пустая */
        .nav-link[data-page="order"] {
            display: none; /* Скрываем по умолчанию */
        }
        
        .nav-link[data-page="order"].show {
            display: block; /* Показываем когда есть товары */
        }
        
        /* Красный кружок с количеством товаров */
        .cart-counter {
            position: relative;
            display: inline-block;
        }
        .cart-counter::after {
            content: attr(data-count);
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 18px; /* 60% от 30px кнопки удаления */
            height: 18px;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            padding: 0;
        }
        
        .mobile-nav .nav-link[data-page="order"] {
            display: none; /* Скрываем в мобильном меню по умолчанию */
        }
        
        .mobile-nav .nav-link[data-page="order"].show {
            display: block; /* Показываем в мобильном меню когда есть товары */
        }

        /* Мобильная навигация */
        .mobile-cart-link {
            display: none; /* Скрываем по умолчанию на десктопе */
        }
        
        .mobile-cart-link.show {
            display: none; /* На десктопе не показываем даже с классом show */
        }
        
        .mobile-gallery-link {
            display: none;
        }
        
        .mobile-bio-link {
            display: none;
        }
        
        /* Модальное окно контактов */
        .contacts-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .contacts-modal.active {
            display: flex;
        }
        
        .contacts-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
        }
        
        .close-contacts {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
        }
        
        /* Модальное окно редактирования описания картины */
        .description-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 4000;
            justify-content: center;
            align-items: center;
        }
        
        .description-modal.active {
            display: flex;
        }
        
        .description-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            text-align: left;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .radio-group {
            display: flex;
            gap: 15px;
            margin-top: 5px;
        }
        
        .radio-group label {
            display: flex;
            align-items: center;
            font-weight: normal;
            cursor: pointer;
        }
        
        .radio-group input[type="radio"] {
            margin-right: 5px;
            width: auto;
        }
        
        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }
        
        .color-picker input[type="color"] {
            width: 50px;
            height: 40px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .color-presets {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .color-preset {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }
        
        .color-preset:hover,
        .color-preset.active {
            border-color: #333;
        }
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .modal-buttons .admin-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        /* Стили для табличек на картинах */
        .painting-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            padding: 8px 12px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            max-width: 80px;
            word-wrap: break-word;
        }
        
        .painting-overlay.rounded {
            border-radius: 15px;
        }
        
        .painting-overlay.square {
            border-radius: 4px;
        }
        
        .contact-item {
            margin: 15px 0;
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-direction: column;
        }
        
        .contact-item:last-child {
            border-bottom: none;
        }
        
        .contact-item a {
            color: #000;
            transition: opacity 0.3s ease;
        }
        
        .contact-item a:hover {
            opacity: 0.7;
        }
        
        .contact-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        /* Адаптивность */
        @media (max-width: 1024px) {
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 24px;
            }
            
            .product-gallery {
                max-width: 85%;
            }
        }
        
        @media (max-width: 768px) {
            header {
                padding: 20px;
            }
            
            .logo {
                font-size: 18px;
                letter-spacing: 1px;
                white-space: nowrap;
            }
            
            nav ul {
                display: none;
            }
            
            .mobile-menu {
                display: none;
            }
            
            .mobile-cart-link {
                display: none; /* Скрываем по умолчанию */
                font-size: 16px;
                text-transform: uppercase;
                letter-spacing: 1px;
                cursor: pointer;
                color: #333;
                font-weight: 500;
                transition: opacity 0.3s ease;
                padding: 8px 12px;
                margin-right: 10px;
            }
            
            .mobile-cart-link.show {
                display: block; /* Показываем только когда есть товары */
            }
            
            .mobile-cart-link:hover {
                opacity: 0.7;
            }
            
            .mobile-gallery-link {
                display: block;
                font-size: 16px;
                text-transform: uppercase;
                letter-spacing: 1px;
                cursor: pointer;
                color: #333;
                font-weight: 500;
                transition: opacity 0.3s ease;
                padding: 8px 12px;
            }
            
            /* Адаптивные стили для выпадающего меню */
            .dropdown-content a {
                font-size: 16px !important;
                padding: 6px 15px !important;
                font-weight: normal !important;
                border: none !important;
                background: none !important;
                cursor: pointer !important;
                text-transform: none !important;
                letter-spacing: normal !important;
                white-space: nowrap !important;
            }
            
            .mobile-gallery-link:hover {
                opacity: 0.7;
            }
            
            .main-content,
            .gallery,
            .product-page,
            .bio-page,
            .contact-page {
                padding-left: 20px;
                padding-right: 20px;
            }
            
            .hero-image {
                height: 50vh;
            }
            
            .gallery-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .product-container {
                flex-direction: column;
                align-items: center;
            }
            
            .product-gallery {
                flex-direction: column;
                max-width: 100%;
                min-width: unset;
            }
            
            .product-thumbnails {
                flex-direction: row;
                flex-wrap: wrap;
                width: 100%;
                justify-content: center;
                order: 2;
            }
            
            .product-image-main {
                order: 1;
                max-height: 55vh;
                width: 100%;
            }
            
            .product-image-main img {
                max-height: 55vh;
            }
            
            .product-details {
                max-width: 100%;
            }
            
            .product-thumbnail {
                width: 60px;
                height: 60px;
            }
            
            /* Стрелки для мобильной версии */
            .nav-arrow {
                width: 35px;
                height: 35px;
            }
            
            .nav-arrow::before {
                width: 10px;
                height: 10px;
            }
            
            /* Мобильная версия футера */
            footer {
                padding: 40px 20px 20px; /* Уменьшен отступ снизу в 2 раза */
            }
            
            .social-links {
                flex-direction: row;
                gap: 15px;
                justify-content: space-around;
            }
            
            .social-links a {
                font-size: 16px;
                padding: 10px 15px;
                flex: 1;
                text-align: center;
            }
            
            .mobile-bio-link {
                display: block;
                font-size: 18px;
                padding: 12px 20px;
                margin-bottom: 20px;
                cursor: pointer;
            }
            
            .mobile-bio-link:hover {
                opacity: 0.7;
            }
            
            /* Скрываем стандартные ссылки в футере на мобильных */
            /* Показываем все социальные ссылки на мобильных */
            .social-links a {
                display: block !important;
            }
            
            /* Текст контактов всегда виден */
            .social-link-instagram .social-link-text,
            .social-link-whatsapp .social-link-text,
            .social-link-email .social-link-text {
                display: inline;
            }
        }
        
        @media (max-width: 480px) {
            .gallery-item img {
                height: 250px;
            }
            
            .product-image-main {
                max-height: 50vh;
            }
            
            .product-image-main img {
                max-height: 50vh;
            }
            
            .product-thumbnail {
                width: 50px;
                height: 50px;
            }
            
            .nav-arrow {
                width: 30px;
                height: 30px;
            }
            
            .nav-arrow::before {
                width: 8px;
                height: 8px;
            }
            
            .nav-arrow.prev {
                left: 5px;
            }
            
            .nav-arrow.next {
                right: 5px;
            }
            
            /* Еще больше уменьшаем отступ в футере для мобильных */
            footer {
                padding: 30px 15px 15px;
            }
        }

        /* Стили для десктопной версии контактов */
        @media (min-width: 769px) {
            /* Скрываем кнопку "Контакты" в футере на десктопе */
            .social-links a.mobile-contact-link {
                display: none;
            }
            
            /* Стили для модального окна контактов на десктопе */
            .contacts-content {
                text-align: left;
                max-width: 500px;
            }
            
            .contact-item {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .contact-label {
                min-width: 100px;
                margin-bottom: 0;
            }
        }

        /* ===== СТИЛИ ДЛЯ КОРЗИНЫ И ЗАКАЗА ===== */
        .order-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            margin-top: 120px; /* Отступ для фиксированной шапки */
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 20px;
        }

        .order-header h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.5rem;
            margin: 0;
            color: #333;
        }

        .back-to-gallery-btn {
            background: #333;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .back-to-gallery-btn:hover {
            background: #555;
        }

        .cart-items {
            margin-bottom: 30px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 15px;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .cart-item-image {
            width: 100px;
            height: 100px;
            margin-right: 20px;
            border-radius: 8px;
            overflow: hidden;
        }

        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-info h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            margin: 0 0 10px 0;
            color: #333;
        }

        .cart-item-size {
            color: #666;
            margin: 5px 0;
            font-size: 14px;
        }

        .cart-item-price {
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }

        .cart-item-actions {
            margin-left: 20px;
        }

        .remove-item-btn {
            background: #f0f0f0; /* Очень бледно-серый фон */
            color: #999999; /* Очень бледно-серый текст */
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px; /* Еще меньше размер шрифта */
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease; /* Плавный переход для всех свойств */
            line-height: 1;
            padding: 0;
            font-family: Arial, sans-serif;
            font-weight: normal; /* Обычная толщина шрифта */
            opacity: 0.7; /* Делаем кнопку полупрозрачной */
        }

        .remove-item-btn:hover {
            background: #cccccc; /* При наведении - цвет как был раньше */
            color: #666666; /* При наведении - цвет как был раньше */
            opacity: 1; /* При наведении - полная непрозрачность */
        }
        .empty-cart {
            text-align: center;
            color: #666;
            font-size: 18px;
            padding: 40px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .order-summary {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        .total-price {
            text-align: center;
            margin-bottom: 30px;
        }

        .total-price h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            color: #333;
            margin: 0;
        }

        .order-documents {
            margin-bottom: 30px;
        }
        .order-documents h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #333;
        }

        .documents-links {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .documents-links a {
            color: #0066cc;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid #0066cc;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .documents-links a:hover {
            background: #0066cc;
            color: white;
        }

        .agreement-section {
            margin-bottom: 30px;
        }

        .agreement-checkbox {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 16px;
        }

        .agreement-checkbox input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
        }

        .agreement-checkbox a {
            color: #0066cc;
            text-decoration: underline;
        }

        .agreement-checkbox a:hover {
            color: #004499;
        }

        .contact-info {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }
        
        .contact-info h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: #333;
        }
        
        .contact-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .contact-field label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }
        
        .contact-input {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: white;
        }
        
        .contact-input:focus {
            outline: none;
            border-color: #0066cc;
        }
        
        .contact-input::placeholder {
            color: #999;
        }

        .order-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .clear-cart-btn {
            background: #666;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .clear-cart-btn:hover {
            background: #444;
        }

        .buy-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background 0.3s;
        }

        .buy-btn:hover:not(:disabled) {
            background: #218838;
        }

        .buy-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Стили для страниц документов */
        .document-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            margin-top: 120px; /* Отступ для фиксированной шапки */
        }

        .document-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 20px;
        }

        .document-header h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.2rem;
            margin: 0;
            color: #333;
        }

        .back-button {
            background: #333;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .back-button:hover {
            background: #555;
        }

        .document-content {
            line-height: 1.6;
            color: #333;
        }

        .document-content h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            margin: 30px 0 15px 0;
            color: #333;
        }

        .document-content p {
            margin-bottom: 15px;
        }

        .document-content ul {
            margin-bottom: 15px;
            padding-left: 20px;
        }

        .document-content li {
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .order-container {
                margin-top: 100px; /* Меньший отступ для мобильных */
            }
            
            .document-container {
                margin-top: 100px; /* Меньший отступ для мобильных */
            }
            
            .order-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .cart-item {
                flex-direction: column;
                text-align: center;
            }

            .cart-item-image {
                margin-right: 0;
                margin-bottom: 15px;
            }

            .cart-item-actions {
                margin-left: 0;
                margin-top: 15px;
            }
            
            .agreement-checkbox {
                display: block;
            }
            
            .agreement-checkbox a {
                display: inline;
                word-break: break-word;
            }

            .documents-links {
                justify-content: center;
            }

            .order-actions {
                flex-direction: column;
            }

            .document-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,500;0,700;1,300;1,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Italiana&display=swap" rel="stylesheet">
</head>
<body><!-- Панель администратора -->
    <div id="admin-panel" class="admin-panel">
        <!-- В заголовке админ-панели -->
<div class="admin-header">
    <h2>Панель администратора JANART STUDIO <span id="current-gallery-indicator"></span></h2>
    <button class="admin-close" id="admin-close">✕</button>
</div>
        <div class="admin-section collapsible collapsed">
            <div class="admin-section-header" id="gallery-settings-header">
                <h2>Настройки галереи</h2>
                <span class="collapse-arrow" id="gallery-settings-arrow">▼</span>
            </div>
            <div class="admin-section-content" id="gallery-settings-content">
                <div class="admin-form">
                    <label>Количество картин в галерее:</label>
                    <input type="number" id="paintings-count" class="admin-input" min="1" value="3">
                    <button class="admin-btn" id="save-settings">Сохранить настройки</button>
                </div>
            </div>
        </div>

        <div class="admin-section collapsible collapsed">
            <div class="admin-section-header" id="photos-management-header">
                <h2>Управление фотографиями картин</h2>
                <span class="collapse-arrow" id="photos-management-arrow">▼</span>
            </div>
            <div class="admin-section-content" id="photos-management-content">
                <div id="paintings-photos-config">
                    <!-- Конфигурация будет генерироваться здесь -->
                </div>
                <button class="admin-btn" id="save-photos-config">Сохранить конфигурацию фотографий</button>
            </div>
        </div>

        <div class="admin-section collapsible collapsed">
            <div class="admin-section-header" id="order-management-header">
                <h2>Изменение порядка картин в галерее</h2>
                <span class="collapse-arrow" id="order-management-arrow">▼</span>
            </div>
            <div class="admin-section-content" id="order-management-content">
                <div style="margin-bottom: 15px; padding: 10px; background: #e9ecef; border-radius: 5px;">
                    <strong>Изменение порядка картин:</strong>
                    <div style="margin-top: 10px;">
                        <button class="admin-btn" onclick="moveSelectedPainting('up')" style="margin-right: 10px; padding: 5px 15px; font-size: 12px;">↑ Вверх</button>
                        <button class="admin-btn" onclick="moveSelectedPainting('down')" style="padding: 5px 15px; font-size: 12px;">↓ Вниз</button>
                    </div>
                </div>
                <div id="paintings-order-config">
                    <!-- Список картин для изменения порядка будет генерироваться здесь -->
                </div>
            </div>
        </div>


        <div class="admin-section collapsible collapsed">
            <div class="admin-section-header" id="paintings-management-header">
                <h2>Управление существующими картинами</h2>
                <span class="collapse-arrow" id="paintings-management-arrow">▼</span>
            </div>
            <div class="admin-section-content" id="paintings-management-content">
                <div id="paintings-list">
                    <!-- Список картин будет генерироваться здесь -->
                </div>
            </div>
        </div>
    </div>
    <!-- Шапка -->
    <header>
        <div class="logo" id="home-logo" onclick="if(typeof showPage === 'function') { console.log('🏠 Клик по логотипу (HTML) - переходим на главную'); showPage('home'); } else { console.error('❌ Функция showPage не найдена'); }">JANART STUDIO</div>
        <nav>
            <ul>
                <li><a href="#" class="nav-link cart-counter" data-page="order" data-count="0">Корзина</a></li>
                <li><a href="#" class="nav-link" data-page="gallery">Галерея</a></li>
                <li><a href="#" class="nav-link" data-page="gallery2">Мастер-класс</a></li>
                <li><a href="#" class="nav-link" id="admin-access-link">Личный кабинет</a></li>
                <li><a href="#" class="nav-link" data-page="bio">Об авторе</a></li>
                <li><a href="#" class="nav-link" id="desktop-contacts-link">Контакты</a></li>
            </ul>
        </nav>
        <div class="mobile-cart-link cart-counter" data-page="order" data-count="0">Корзина</div>
        <div class="mobile-gallery-link" data-page="gallery">Галерея</div>
        <div class="mobile-gallery-link" data-page="gallery2">Мастер-класс</div>
        <div class="mobile-menu">Меню</div>
    </header>

    <!-- Мобильное меню (добавлено в HTML) -->
    <div class="mobile-nav">
        <div class="close-menu">✕</div>
        <ul>
            <li><a href="#" class="nav-link" data-page="home">Главная</a></li>
            <li><a href="#" class="nav-link" data-page="order">Корзина</a></li>
            <li><a href="#" class="nav-link" data-page="gallery">Галерея</a></li>
            <li><a href="#" class="nav-link" data-page="gallery2">Мастер-класс</a></li>
            <li><a href="#" class="nav-link" id="mobile-admin-access-link">Личный кабинет</a></li>
            <li><a href="#" class="nav-link" data-page="bio">Об авторе</a></li>
            <li><a href="#" class="nav-link" id="mobile-contacts-link">Контакты</a></li>
        </ul>
    </div>

    <div id="personal-cabinet-modal" class="auth-modal" aria-hidden="true">
        <div class="auth-modal__backdrop"></div>
        <div class="auth-modal__panel">
            <button type="button" class="auth-modal__close" id="personal-cabinet-close" aria-label="Закрыть">×</button>
            <h3>Личный кабинет</h3>
            <div class="auth-modal__message" id="personal-cabinet-message"></div>

            <form id="personal-login-form" class="auth-modal__form">
                <label for="personal-login-email">Email</label>
                <input type="email" id="personal-login-email" autocomplete="username" required placeholder="example@mail.ru">
                <label for="personal-login-password">Пароль</label>
                <input type="password" id="personal-login-password" autocomplete="current-password" required placeholder="Ваш пароль">
                <div class="auth-modal__actions">
                    <button type="button" class="admin-btn" id="personal-login-submit">Войти</button>
                    <button type="button" class="admin-btn" id="personal-register-show">Регистрация</button>
                </div>
            <div class="auth-modal__footer">
                <button type="button" class="link-btn" id="personal-forgot-password">Забыл пароль</button>
                <button type="button" class="link-btn" id="show-change-password">Сменить пароль</button>
            </div>
            </form>

            <form id="personal-register-form" class="auth-modal__form" style="display: none;">
                <label for="personal-register-email">Email</label>
                <input type="email" id="personal-register-email" autocomplete="email" required placeholder="your@email.ru">
                <div class="auth-modal__actions">
                    <button type="button" class="admin-btn" id="personal-register-submit">Отправить пароль</button>
                    <button type="button" class="admin-btn secondary" id="personal-register-back">Вход</button>
                </div>
                <div class="auth-modal__footer">
                    <span>Новый пароль будет отправлен на указанный Email.</span>
                </div>
            </form>
            <form id="personal-change-form" class="auth-modal__form" style="display: none;">
                <label for="personal-change-email">Email</label>
                <input type="email" id="personal-change-email" autocomplete="email" required placeholder="ваш@email.ru">
                <label for="personal-change-old">Старый пароль</label>
                <input type="password" id="personal-change-old" autocomplete="current-password" placeholder="старый пароль" required>
                <label for="personal-change-new">Новый пароль</label>
                <input type="password" id="personal-change-new" autocomplete="new-password" placeholder="новый пароль" required>
                <label for="personal-change-confirm">Повторите новый</label>
                <input type="password" id="personal-change-confirm" autocomplete="new-password" placeholder="повторите пароль" required>
                <div class="auth-modal__actions">
                    <button type="button" class="admin-btn" id="personal-change-submit">Сохранить</button>
                    <button type="button" class="admin-btn secondary" id="personal-change-back">Назад</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Главная страница -->
    <div id="home-page" class="page">
        <div class="main-content">
            <div class="hero-image">
                <img src="images/freepik-export-20241021134528sZDq.jpeg" alt="Главное изображение JANART STUDIO" id="main-hero">
            </div>
        </div>
    </div>

    <!-- Галерея -->
    <div id="gallery-page" class="page" style="display: none;">
        <div class="gallery-container">
            <div class="gallery-grid" id="gallery-grid">
                <!-- Картины будут загружены динамически -->
            </div>
        </div>
    </div>
    <div id="gallery2-page" class="page" style="display: none;">
    <div class="gallery-container">
        <div class="gallery-grid" id="gallery2-grid">
            <!-- Картины для второй галереи -->
        </div>
    </div>
</div>

    <!-- Страница заказа -->
    <div id="order-page" class="page" style="display: none;">
        <div class="order-container">
            <div class="order-header">
                <h1>Ваш заказ</h1>
                <button class="back-to-gallery-btn" onclick="showPage('gallery')">← Вернуться в галерею</button>
            </div>
            
            <div class="cart-items" id="cart-items">
                <!-- Элементы корзины будут добавлены динамически -->
            </div>
            
            <div class="order-summary">
                <div class="total-price">
                    <h2>К оплате: <span id="total-amount">0</span> ₽</h2>
                </div>
                
                <div class="contact-info">
                    <h3>Контактные данные</h3>
                    <div class="contact-field">
                        <label for="contact-input">Введите телефон/e-mail для связи:</label>
                        <input type="text" id="contact-input" placeholder="+7 (999) 123-45-67 или email@example.com" class="contact-input">
                    </div>
                </div>
                
                <div class="agreement-section">
                        <label class="agreement-checkbox">
                            <input type="checkbox" id="accept-agreement" required>
                            <span class="checkmark"></span>
                            Я принимаю&nbsp;<a href="javascript:void(0)" onclick="showPage('agreement')">договор</a>&nbsp;и&nbsp;<a href="javascript:void(0)" onclick="showPage('privacy')">политику обработки персональных данных</a>
                        </label>
                </div>
                
                <div class="order-actions">
                    <button class="buy-btn" id="proceed-to-payment" disabled>Перейти к оплате</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Страница договора -->
    <div id="agreement-page" class="page" style="display: none;">
        <div class="document-container">
            <div class="document-header">
                <h1>Договор об оказании услуг (публичная оферта)</h1>
                <button class="back-button" onclick="showPage('order')">← Назад к заказу</button>
            </div>
            
            <div class="document-content">
                <p>Ян Арт Студио (далее — Исполнитель) настоящей публичной офертой предлагает любому физическому или юридическому лицу, а также индивидуальному предпринимателю (далее – Заказчик) заключить настоящий договор об оказании услуг на указанных ниже условиях.</p>

                <h3>1. Термины и определения</h3>
                <p>1.1 Договор — настоящий договор об оказании услуг, постоянно опубликованный на сайте Исполнителя по адресу: https://janart-studio.ru/.</p>
                <p>1.2. Акцепт Договора — принятие публичной оферты Заказчиком на заключение Договора. Акцептом Договора считается нажатие Заказчиком кнопки «Перейти к оплате» под сформированным заказом на сайте https://janart-studio.ru/. Полным и безусловным акцептом Договора является осуществление Заказчиком оплаты предложенных Исполнителем услуг.</p>
                <p>1.3. Тарифы — перечень услуг Исполнителя с ценами, указанными в Прайс-листе на сайте Исполнителя по адресу https://janart-studio.ru/#pricing.</p>

                <h3>2. Предмет Договора</h3>
                <p>2.1. В соответствии с Договором Заказчик поручает и оплачивает, а Исполнитель принимает на себя обязательства по оказанию Заказчику услуг по продаже картин.</p>
                <p>2.2. Перечень услуг содержится в Тарифах.</p>
                <p>2.3. Заказчик соглашается, что совершая Акцепт Договора он подтверждает, что ознакомлен, согласен, полностью и безоговорочно принимает все условия Договора.</p>

                <h3>3. Права и обязанности сторон</h3>
                <p>3.1. Исполнитель обязуется:</p>
                <p>3.1.1. Предоставить Заказчику картины в соответствии с условиями Договора;</p>
                <p>3.1.2. Обеспечить качественную упаковку и доставку картин;</p>
                <p>3.1.3. Предоставить сертификат подлинности для каждой картины.</p>
                <p>3.2. Заказчик обязуется:</p>
                <p>3.2.1. Своевременно оплачивать услуги в соответствии с условиями Договора;</p>
                <p>3.2.2. Соблюдать условия использования приобретенных картин.</p>

                <h3>4. Стоимость услуг и порядок расчетов</h3>
                <p>4.1. Стоимость услуг определяется в соответствии с действующими Тарифами.</p>
                <p>4.2. Оплата производится в безналичном порядке путем перевода денежных средств на расчетный счет Исполнителя.</p>
                <p>4.3. Моментом оплаты считается поступление денежных средств на расчетный счет Исполнителя.</p>

                <h3>5. Ответственность сторон</h3>
                <p>5.1. За неисполнение или ненадлежащее исполнение обязательств по Договору стороны несут ответственность в соответствии с действующим законодательством РФ.</p>

                <h3>6. Заключительные положения</h3>
                <p>6.1. Договор вступает в силу с момента его акцепта Заказчиком и действует до полного исполнения сторонами своих обязательств.</p>
                <p>6.2. Все споры решаются путем переговоров, а при невозможности достижения соглашения — в судебном порядке.</p>

                <h3>РЕКВИЗИТЫ ИСПОЛНИТЕЛЯ:</h3>
                <p>Ян Арт Студио<br>
                Адрес: г. Москва<br>
                Адрес электронной почты: info@janart-studio.ru</p>
            </div>
        </div>
    </div>

    <!-- Страница тарифов -->
    <div id="pricing-page" class="page" style="display: none;">
        <div class="document-container">
            <div class="document-header">
                <h1>Тарифы и цены</h1>
                <button class="back-button" onclick="showPage('order')">← Назад к заказу</button>
            </div>
            
            <div class="document-content">
                <h3>Цены на картины</h3>
                <p>Цены на картины указаны в галерее и включают в себя:</p>
                <ul>
                    <li>Стоимость самой картины</li>
                    <li>Упаковку для безопасной транспортировки</li>
                    <li>Сертификат подлинности</li>
                </ul>
                
                <h3>Доставка</h3>
                <p>Стоимость доставки рассчитывается индивидуально в зависимости от:</p>
                <ul>
                    <li>Размера картины</li>
                    <li>Расстояния доставки</li>
                    <li>Способа доставки</li>
                </ul>
                
                <h3>Оплата</h3>
                <p>Принимаются следующие способы оплаты:</p>
                <ul>
                    <li>Банковские карты (Visa, MasterCard, МИР)</li>
                    <li>Банковские переводы</li>
                    <li>Электронные платежи</li>
                </ul>
            </div>
        </div>
    </div>
    <!-- Страница возврата -->
    <div id="refund-page" class="page" style="display: none;">
        <div class="document-container">
            <div class="document-header">
                <h1>Условия возврата и отмены платежа</h1>
                <button class="back-button" onclick="showPage('order')">← Назад к заказу</button>
            </div>
            
            <div class="document-content">
                <p>Настоящие условия определяют порядок возврата денежных средств и отмены платежей при приобретении картин.</p>

                <h3>1. Общие положения</h3>
                <p>1.1. Возврат денежных средств осуществляется в соответствии с действующим законодательством РФ.</p>
                <p>1.2. Все вопросы по возврату рассматриваются в индивидуальном порядке.</p>

                <h3>2. Условия возврата</h3>
                <p>2.1. Возврат денежных средств возможен в следующих случаях:</p>
                <p>2.1.1. Техническая ошибка при проведении платежа;</p>
                <p>2.1.2. Дублирование платежа;</p>
                <p>2.1.3. Отказ от услуг в течение 14 дней с момента оплаты при условии, что картина не была отправлена.</p>

                <h3>3. Случаи, когда возврат невозможен</h3>
                <p>3.1. Возврат денежных средств не производится в следующих случаях:</p>
                <p>3.1.1. Картина была отправлена покупателю;</p>
                <p>3.1.2. Прошло более 14 дней с момента оплаты;</p>
                <p>3.1.3. Картина была повреждена покупателем.</p>

                <h3>4. Порядок возврата</h3>
                <p>4.1. Для оформления возврата необходимо:</p>
                <p>4.1.1. Обратиться по адресу: info@janart-studio.ru;</p>
                <p>4.1.2. Указать номер заказа и причину возврата;</p>
                <p>4.1.3. Предоставить документы, подтверждающие платеж.</p>

                <h3>5. Сроки возврата</h3>
                <p>5.1. Возврат денежных средств осуществляется в течение 10 рабочих дней с момента принятия положительного решения о возврате.</p>
                <p>5.2. Возврат производится тем же способом, которым была произведена оплата.</p>

                <h3>6. Контактная информация</h3>
                <p>По вопросам возврата обращайтесь по адресу: info@janart-studio.ru</p>
            </div>
        </div>
    </div>

    <!-- Страница политики обработки персональных данных -->
    <div id="privacy-page" class="page" style="display: none;">
        <div class="document-container">
            <div class="document-header">
                <h1>Политика обработки персональных данных</h1>
                <button class="back-button" onclick="showPage('home')">← Назад</button>
            </div>
            
            <div class="document-content">
                <p><strong>Редакция от 26.10.2025</strong></p>

                <h3>Общие положения и термины, используемые в Политике</h3>
                <p>Настоящая Политика обработки персональных данных (далее — Политика) определяет политику Ян Арт Студио (далее – Оператор), в отношении обработки персональных данных и реализации требований к защите персональных данных в соответствии с Федеральным законом «О персональных данных» № 152-ФЗ от 27 июля 2006 г.</p>

                <p>Политика определяет принципы, цели, порядок и условия обработки персональных данных физических лиц - посетителей и пользователей сайта янАрт Студио.</p>

                <p>Использование Сайта означает безоговорочное согласие Пользователя (Субъекта персональных данных) с положениями настоящей Политики.</p>

                <h3>Термины и определения</h3>
                <p><strong>Оператор</strong> — Ян Арт Студио, осуществляющий обработку персональных данных.</p>
                <p><strong>Персональные данные</strong> — любая информация, относящаяся к прямо или косвенно определенному, или определяемому физическому лицу (субъекту персональных данных).</p>
                <p><strong>Обработка персональных данных</strong> — любое действие (операция) или совокупность действий (операций) с персональными данными, совершаемых с использованием средств автоматизации или без их использования, в том числе, сбор, запись, систематизация, накопление, хранение, уточнение (обновление, изменение), извлечение, использование, передача (распространение, предоставление доступа), обезличивание, блокирование, удаление, уничтожение персональных данных.</p>

                <h3>Принципы обработки персональных данных</h3>
                <p>Оператор придерживается следующих принципов при осуществлении обработки персональных данных:</p>
                <ul>
                    <li>Обработка персональных данных осуществляется на законной и справедливой основе</li>
                    <li>Обработка персональных данных ограничивается достижением конкретных, заранее определенных и законных целей</li>
                    <li>Не допускается обработка персональных данных, несовместимая с целями сбора персональных данных</li>
                    <li>Обрабатываются только те персональные данные, которые отвечают целям их обработки</li>
                </ul>

                <h3>Цели обработки персональных данных</h3>
                <p>Оператор обрабатывает персональные данные для следующих целей:</p>
                <ul>
                    <li>Обработка заказов и обеспечение функционирования сайта</li>
                    <li>Связь с покупателями и предоставление информации о статусе заказов</li>
                    <li>Соблюдение требований законодательства Российской Федерации</li>
                    <li>Выполнение договоров с покупателями</li>
                </ul>

                <h3>Категории обрабатываемых персональных данных</h3>
                <p>Оператор обрабатывает следующие категории персональных данных:</p>
                <ul>
                    <li>Контактные данные (телефон, электронная почта)</li>
                    <li>Данные о заказах (товары, сумма, дата и время заказа)</li>
                    <li>Технические данные (IP-адрес, информация о браузере)</li>
                </ul>

                <h3>Сроки обработки и хранения персональных данных</h3>
                <p>Оператор обрабатывает персональные данные в течение срока, необходимого для достижения целей обработки. После достижения целей обработки персональные данные подлежат уничтожению, за исключением случаев, когда законодательство Российской Федерации требует их дальнейшего хранения.</p>

                <h3>Меры по обеспечению безопасности персональных данных</h3>
                <p>Оператор принимает необходимые правовые, организационные и технические меры для защиты персональных данных от неправомерного или случайного доступа к ним, уничтожения, изменения, блокирования, копирования, предоставления, распространения персональных данных, а также от иных неправомерных действий.</p>

                <h3>Права субъектов персональных данных</h3>
                <p>Субъект персональных данных имеет право на:</p>
                <ul>
                    <li>Получение информации, касающейся обработки его персональных данных</li>
                    <li>Требовать уточнения своих персональных данных, их блокирования или уничтожения</li>
                    <li>Отзыв ранее данного согласия на обработку персональных данных</li>
                    <li>Обжалование действий или бездействия Оператора в уполномоченный орган по защите прав субъектов персональных данных или в суд</li>
                </ul>

                <h3>Обработка персональных данных третьими лицами</h3>
                <p>Оператор может передавать персональные данные третьим лицам только для выполнения обязательств по обработке заказов и обеспечения функционирования сайта. Передача персональных данных третьим лицам осуществляется с соблюдением требований законодательства о персональных данных.</p>

                <h3>Контактная информация</h3>
                <p>По вопросам, связанным с обработкой персональных данных, вы можете обратиться к Оператору по адресу электронной почты: <a href="mailto:info@janart-studio.ru">info@janart-studio.ru</a></p>
            </div>
        </div>
    </div>
    <!-- Модальное окно для просмотра картины -->
    <div id="painting-modal" class="painting-modal" style="display: none;">
        <div class="painting-modal__overlay"></div>
        <div class="painting-modal__container">
            <div class="painting-modal__back">
                <button type="button" class="painting-modal__back-btn" aria-label="Назад в галерею">
                    <svg width="18px" height="18px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <polyline fill="none" stroke="#000" stroke-width="1" points="14,6 8,12 14,18"></polyline>
                    </svg>
                </button>
            </div>
            <div class="painting-modal__close">
                <button type="button" class="painting-modal__close-btn" aria-label="Закрыть">
                    <svg width="23px" height="23px" viewBox="0 0 23 23" version="1.1" xmlns="http://www.w3.org/2000/svg">
                        <g stroke="none" stroke-width="1" fill="#000" fill-rule="evenodd">
                            <rect transform="translate(11.313708, 11.313708) rotate(-45.000000) translate(-11.313708, -11.313708) " x="10.3137085" y="-3.6862915" width="2" height="30"></rect>
                            <rect transform="translate(11.313708, 11.313708) rotate(-315.000000) translate(-11.313708, -11.313708) " x="10.3137085" y="-3.6862915" width="2" height="30"></rect>
                        </g>
                    </svg>
                </button>
            </div>
            
            <div class="painting-modal__content">
                <div class="painting-modal__gallery">
                    <div class="painting-slider">
                        <div class="painting-slider__main">
                            <div class="painting-slider__image-container">
                                <div class="painting-slider__images-wrapper">
                                    <div class="painting-slider__image-item">
                                <img class="painting-slider__image" src="" alt="">
                                    </div>
                                    <div class="painting-slider__image-item">
                                        <img class="painting-slider__image painting-slider__image--next" src="" alt="">
                                    </div>
                                </div>
                            </div>
                            <div class="painting-slider__nav">
                                <button class="painting-slider__arrow painting-slider__arrow--prev" id="prev-arrow" aria-label="Предыдущее изображение">
                                    <svg width="7px" height="13px" viewBox="0 0 7.3 13" xmlns="http://www.w3.org/2000/svg">
                                        <polyline fill="none" stroke="#fff" stroke-linejoin="butt" stroke-linecap="butt" stroke-width="2" points="6.5,0.5 0.5,6.5 6.5,12.5"/>
                                    </svg>
                                </button>
                                <button class="painting-slider__arrow painting-slider__arrow--next" id="next-arrow" aria-label="Следующее изображение">
                                    <svg width="7px" height="13px" viewBox="0 0 7.3 13" xmlns="http://www.w3.org/2000/svg">
                                        <polyline fill="none" stroke="#fff" stroke-linejoin="butt" stroke-linecap="butt" stroke-width="2" points="0.5,0.5 6.5,6.5 0.5,12.5"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="painting-slider__thumbs">
                            <!-- Миниатюры будут загружены динамически -->
                        </div>
                        
                        <!-- Мобильная информация о картине -->
                        <div class="painting-modal__mobile-info">
                            <div class="painting-modal__mobile-header">
                                <h1 class="painting-modal__mobile-title"></h1>
                                <div class="painting-modal__mobile-price"></div>
                            </div>
                            
                            <div class="painting-modal__mobile-details">
                                <div class="painting-modal__mobile-size"></div>
                                <div class="painting-modal__mobile-description"></div>
                            </div>
                            
                            <div class="painting-modal__mobile-actions">
                                <button class="painting-modal__btn painting-modal__btn--primary" id="buy-painting-btn-mobile">Купить</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="painting-modal__info">
                    <div class="painting-modal__header">
                        <h1 class="painting-modal__title"></h1>
                        <div class="painting-modal__price"></div>
                    </div>
                    
                    <div class="painting-modal__details">
                        <div class="painting-modal__size"></div>
                        <div class="painting-modal__description"></div>
                    </div>
                    
                    <div class="painting-modal__actions">
                        <button class="painting-modal__btn painting-modal__btn--primary" id="buy-painting-btn">Купить</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Страница товара -->
    <div id="product-page" class="product-page">
        <!-- Контент будет добавляться через JavaScript -->
    </div>

    <!-- Биография -->
    <div id="bio-page" class="bio-page">
        <h1>Об авторе</h1>
        <p>Я - современный художник, вдохновленный красотой окружающего мира и внутренними переживаниями. Мои работы отражают взаимодействие цвета, формы и текстуры, создавая уникальные визуальные narratives.</p>
        <p>Я работаю с различными медиа, включая акрил, масло и смешанную технику. Каждая картина - это исследование и выражение эмоций, зафиксированных на холсте.</p>
        <p>Мое искусство - это диалог со зрителем, приглашение к размышлению и эмоциональному отклику. Я стремлюсь создавать работы, которые resonate с людьми на глубоком уровне.</p>
        <p>Мои произведения находятся в частных коллекциях по всему миру и были представлены на нескольких выставках.</p>
    </div>

    <!-- Контакты -->
    <div id="contact-page" class="contact-page">
        <h1>Свяжитесь со мной</h1>
        <form class="contact-form">
            <div class="form-group">
                <label for="name">Имя</label>
                <input type="text" id="name" required>
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" required>
            </div>
            <div class="form-group">
                <label for="message">Сообщение</label>
                <textarea id="message" required></textarea>
            </div>
            <button type="submit" class="submit-button">Отправить</button>
        </form>
    </div>

    <!-- Футер -->
    <footer>
        <div class="mobile-bio-link" data-page="bio">Об авторе</div>
        <div class="social-links">
            <a href="mailto:tatiana.janart@gmail.com" class="social-link-email mobile-contact-link" id="contacts-link">
                <span class="social-link-text">tatiana.janart@gmail.com</span>
            </a>
            <a href="https://www.instagram.com/janart_studio/" target="_blank" class="social-link-instagram">
                <span class="social-link-text">Instagram</span>
            </a>
            <a href="https://wa.me/79046006365" target="_blank" class="social-link-whatsapp">
                <span class="social-link-text">WhatsApp</span>
            </a>
        </div>
    </footer>

    <!-- Модальное окно контактов -->
    <div class="contacts-modal" id="contacts-modal">
        <div class="contacts-content">
            <div class="close-contacts" id="close-contacts">✕</div>
            <h2>Контакты</h2>
            <div class="contact-item">
                <span class="contact-label">Instagram</span>
                <a href="https://www.instagram.com/janart_studio/" target="_blank">@janart_studio</a>
            </div>
            <div class="contact-item">
                <span class="contact-label">WhatsApp</span>
                <a href="https://wa.me/79046068107" target="_blank">+7 (904) 606 81 07</a>
            </div>
            <div class="contact-item">
                <span class="contact-label">Email</span>
                <a href="mailto:tatiana.janart@gmail.com">tatiana.janart@gmail.com</a>
            </div>
        </div>
    </div>

    <!-- Модальное окно редактирования описания картины -->
    <div class="description-modal" id="description-modal">
        <div class="description-content">
            <h2>Редактирование описания картины</h2>
            
            <div class="form-group">
                <label for="painting-title-modal">Название картины:</label>
                <input type="text" id="painting-title-modal" placeholder="Введите название картины">
            </div>
            
            <div class="form-group">
                <label for="painting-price-modal">Цена:</label>
                <input type="text" id="painting-price-modal" placeholder="Введите цену">
            </div>
            
            <div class="form-group">
                <label for="painting-size-modal">Размер:</label>
                <input type="text" id="painting-size-modal" placeholder="Введите размер">
            </div>
            
            <div class="form-group">
                <label for="painting-description-modal">Описание:</label>
                <textarea id="painting-description-modal" rows="4" placeholder="Введите описание картины"></textarea>
            </div>
            
            <div class="form-group">
                <label>Форма таблички:</label>
                <div class="radio-group">
                    <label><input type="radio" name="shape-type" value="none" checked> Нет</label>
                    <label><input type="radio" name="shape-type" value="rounded"> Скругленный</label>
                    <label><input type="radio" name="shape-type" value="square"> Квадратный</label>
                </div>
            </div>
            
            <div class="form-group" id="overlay-settings" style="display: none;">
                <label for="overlay-text">Текст на табличке:</label>
                <input type="text" id="overlay-text" placeholder="Введите текст для таблички">
                
                <label for="overlay-color">Цвет таблички:</label>
                <div class="color-picker">
                    <input type="color" id="overlay-color" value="#ff6b6b">
                    <div class="color-presets" id="color-presets">
                        <!-- Динамически генерируемые цветовые пресеты -->
                    </div>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button class="admin-btn" id="save-description" style="background: #28a745;">Сохранить</button>
                <button class="admin-btn" id="cancel-description" style="background: #6c757d;">Отмена</button>
            </div>
        </div>
    </div>
    <script>
        // ===== ГЛОБАЛЬНЫЕ ФУНКЦИИ ДЛЯ НАВИГАЦИИ МОДАЛЬНОГО ОКНА =====
        let currentModalPainting = null;
        let currentModalImageIndex = 0;
        
        // ===== ОСНОВНЫЕ ПЕРЕМЕННЫЕ ГАЛЕРЕИ =====
        let galleryData = {
            paintings: [] // Единая галерея картин
        };
        let gallery2Data = {
    paintings: [] // Вторая галерея
};

let currentGalleryType = 'gallery'; // 'gallery' или 'gallery2'
        // ===== СИСТЕМА КОРЗИНЫ =====
        let cart = {
            items: [], // Массив картин в корзине
            total: 0   // Общая сумма
        };
        
        // Функции для работы с корзиной
        function addToCart(painting) {
            console.log('🛒 Добавляем картину в корзину:', painting.title);
            console.log('🛒 Текущая корзина ДО добавления:', cart.items.map(item => item.id));
            
            // Проверяем, нет ли уже этой картины в корзине
            const existingItem = cart.items.find(item => item.id === painting.id);
            if (existingItem) {
                console.log('⚠️ Картина уже в корзине:', painting.title);
                console.log('🛒 Переходим в корзину без изменений');
                showPage('order');
                return;
            }
            
            console.log('✅ Картина НЕ найдена в корзине, добавляем...');
            cart.items.push(painting);
            updateCartTotal();
            saveCartToStorage();
            
            console.log('✅ Картина добавлена в корзину:', painting.title);
            console.log('🛒 Корзина ПОСЛЕ добавления:', cart.items.map(item => item.id));
            console.log('🛒 Общее количество товаров:', cart.items.length);
            
            // Переходим на страницу заказа
            showPage('order');
        }
        
        function removeFromCart(paintingId) {
            console.log('🗑️ Удаляем картину из корзины:', paintingId);
            console.log('🛒 Корзина ДО удаления:', cart.items);
            console.log('🛒 ID товаров в корзине ДО удаления:', cart.items.map(item => item.id));
            
            // Используем более надежный метод удаления
            const originalLength = cart.items.length;
            const newItems = [];
            
            for (let i = 0; i < cart.items.length; i++) {
                const item = cart.items[i];
                console.log(`🔍 Проверяем товар ${i}: ${item.id} (${item.title})`);
                
                if (item.id !== paintingId) {
                    newItems.push(item);
                    console.log(`✅ Оставляем товар: ${item.id}`);
                } else {
                    console.log(`❌ Удаляем товар: ${item.id}`);
                }
            }
            
            cart.items = newItems;
            
            console.log('🛒 Корзина ПОСЛЕ удаления:', cart.items);
            console.log('🛒 ID товаров в корзине ПОСЛЕ удаления:', cart.items.map(item => item.id));
            console.log(`📊 Удалено товаров: ${originalLength - cart.items.length}`);
            
            updateCartTotal();
            saveCartToStorage();
            
            console.log('❌ Картина удалена из корзины:', paintingId);
            console.log('🛒 Финальная корзина:', cart.items);
            
            // Обновляем отображение корзины
            updateCartDisplay();
        }
        
        function updateCartTotal() {
            cart.total = cart.items.reduce((sum, item) => {
                // Извлекаем число из строки цены (убираем "₽" и пробелы)
                const price = parseInt(item.price.replace(/[^\d]/g, ''));
                return sum + price;
            }, 0);
        }
        
        function saveCartToStorage() {
            localStorage.setItem('janart_cart', JSON.stringify(cart));
        }
        
        function loadCartFromStorage() {
            const savedCart = localStorage.getItem('janart_cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                updateCartTotal();
                updateCartVisibility(); // Обновляем видимость корзины при загрузке
                console.log('🛒 Корзина загружена из localStorage:', cart);
                console.log('🛒 Количество товаров в загруженной корзине:', cart.items.length);
            } else {
                console.log('🛒 localStorage пуст, корзина инициализирована как пустая');
            }
        }
        
        function clearCart() {
            console.log('🧹 Очищаем корзину...');
            console.log('🛒 Корзина ДО очистки:', cart.items);
            
            cart.items = [];
            cart.total = 0;
            saveCartToStorage();
            updateCartDisplay();
            updateCartVisibility(); // Обновляем видимость корзины при очистке
            
            console.log('🧹 Корзина очищена');
            console.log('🛒 Корзина ПОСЛЕ очистки:', cart.items);
        }
        
        // Функция для полной очистки localStorage (для отладки)
        function clearCartStorage() {
            localStorage.removeItem('janart_cart');
            console.log('🗑️ localStorage корзины полностью очищен');
            // Перезагружаем корзину
            cart = {
                items: [],
                total: 0
            };
            updateCartDisplay();
            updateCartVisibility();
            console.log('🔄 Корзина перезагружена');
        }
        
        // Функция для отладки - показать содержимое localStorage
        function debugCartStorage() {
            const savedCart = localStorage.getItem('janart_cart');
            console.log('🔍 Содержимое localStorage корзины:', savedCart);
            if (savedCart) {
                try {
                    const parsedCart = JSON.parse(savedCart);
                    console.log('🔍 Распарсенная корзина:', parsedCart);
                    console.log('🔍 Количество товаров в localStorage:', parsedCart.items ? parsedCart.items.length : 'N/A');
                } catch (e) {
                    console.error('❌ Ошибка парсинга localStorage:', e);
                }
            }
        }
        
        // Функция для обновления отображения корзины
        function updateCartDisplay() {
            const cartItemsContainer = document.getElementById('cart-items');
            const totalAmountElement = document.getElementById('total-amount');
            const proceedBtn = document.getElementById('proceed-to-payment');
            
            if (!cartItemsContainer || !totalAmountElement) return;
            
            // Очищаем контейнер
            cartItemsContainer.innerHTML = '';
            
            // Управляем видимостью корзины
            updateCartVisibility();
            
            if (cart.items.length === 0) {
                cartItemsContainer.innerHTML = '<p class="empty-cart">Корзина пуста</p>';
                totalAmountElement.textContent = '0';
                if (proceedBtn) proceedBtn.disabled = true;
                return;
            }
            
            // Добавляем элементы корзины
            cart.items.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-image">
                        <img src="${item.mainImage}" alt="${item.title}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjZjBmMGYwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7Qn9C+0LrQsNC30LDRgtC10LvRjzwvdGV4dD4KPC9zdmc+'">
                    </div>
                    <div class="cart-item-info">
                        <h3>${item.title}</h3>
                        <p class="cart-item-size">${item.size}</p>
                        <p class="cart-item-price">${item.price}</p>
                    </div>
                    <div class="cart-item-actions">
                        <button class="remove-item-btn" onclick="removeFromCart('${item.id}')">×</button>
                    </div>
                `;
                cartItemsContainer.appendChild(cartItem);
            });
            
            // Обновляем общую сумму
            totalAmountElement.textContent = cart.total.toLocaleString();
            
            // Обновляем состояние кнопки оплаты
            if (proceedBtn) {
                const agreementCheckbox = document.getElementById('accept-agreement');
                proceedBtn.disabled = !agreementCheckbox || !agreementCheckbox.checked;
            }
        }
        
        // Функция для управления видимостью корзины
        function updateCartVisibility() {
            const hasItems = cart.items.length > 0;
            
            // Десктопная корзина в шапке
            const desktopCartLink = document.querySelector('.nav-link[data-page="order"]');
            if (desktopCartLink) {
                if (hasItems) {
                    desktopCartLink.classList.add('show');
                    desktopCartLink.setAttribute('data-count', cart.items.length); // Обновляем счетчик
                } else {
                    desktopCartLink.classList.remove('show');
                    desktopCartLink.setAttribute('data-count', '0');
                }
            }
            
            // Мобильная корзина в шапке (только на мобильных устройствах)
            const mobileCartLink = document.querySelector('.mobile-cart-link');
            if (mobileCartLink && window.innerWidth <= 768) {
                if (hasItems) {
                    mobileCartLink.classList.add('show');
                    mobileCartLink.setAttribute('data-count', cart.items.length); // Обновляем счетчик
                } else {
                    mobileCartLink.classList.remove('show');
                    mobileCartLink.setAttribute('data-count', '0');
                }
            }
            
            // Корзина в мобильном меню
            const mobileNavCartLink = document.querySelector('.mobile-nav .nav-link[data-page="order"]');
            if (mobileNavCartLink) {
                if (hasItems) {
                    mobileNavCartLink.classList.add('show');
                } else {
                    mobileNavCartLink.classList.remove('show');
                }
            }
            
            console.log('🛒 Видимость корзины обновлена. Товаров в корзине:', cart.items.length);
        }
        
        // Функция для проверки готовности к оплате
        function checkPaymentReady() {
            const contactInput = document.getElementById('contact-input');
            const agreementCheckbox = document.getElementById('accept-agreement');
            const paymentButton = document.getElementById('proceed-to-payment');
            
            const hasContact = contactInput && contactInput.value.trim() !== '';
            const hasAgreement = agreementCheckbox && agreementCheckbox.checked;
            const hasItems = cart.items.length > 0;
            
            if (paymentButton) {
                paymentButton.disabled = !(hasContact && hasAgreement && hasItems);
            }
        }
        
        // Функция для генерации номера заказа
        function generateOrderNumber() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            
            return `JS${year}${month}${day}${hours}${minutes}${seconds}`;
        }
        
        // Функция для сохранения заказа на сервере
        async function saveOrderToServer(orderData) {
            try {
                const response = await fetch('save-order.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    console.log('✅ Заказ сохранен на сервере:', result);
                    return result.orderNumber;
                } else {
                    console.error('❌ Ошибка сохранения заказа:', result);
                    throw new Error(result.error || 'Ошибка сохранения заказа');
                }
            } catch (error) {
                console.error('❌ Ошибка отправки заказа:', error);
                throw error;
            }
        }
        
        // Функция для сохранения заказа (обновленная)
        function saveOrder(orderData) {
            // Сохраняем заказ в localStorage как резервную копию
            const orders = JSON.parse(localStorage.getItem('janart_orders') || '[]');
            orders.push(orderData);
            localStorage.setItem('janart_orders', JSON.stringify(orders));
            
            console.log('📦 Заказ сохранен локально:', orderData);
            return orderData.orderNumber;
        }
        
        // Функция для обработки чекбокса согласия
        function handleAgreementCheckbox() {
            const checkbox = document.getElementById('accept-agreement');
            const contactInput = document.getElementById('contact-input');
            
            if (checkbox) {
                checkbox.addEventListener('change', function() {
                    checkPaymentReady();
                });
            }
            
            if (contactInput) {
                contactInput.addEventListener('input', function() {
                    checkPaymentReady();
                });
            }
        }
        // Добавьте эту функцию в начало скрипта (после объявления переменных)
function logGalleryState() {
    console.log('📊 ===== СОСТОЯНИЕ ГАЛЕРЕЙ =====');
    console.log('📊 Текущая галерея:', currentGalleryType);
    console.log('📊 Галерея (gallery):', {
        paintings: galleryData.paintings ? galleryData.paintings.length : 0,
        items: galleryData.paintings ? galleryData.paintings.map(p => ({id: p.id, title: p.title})) : []
    });
    console.log('📊 Мастер-класс (gallery2):', {
        paintings: gallery2Data.paintings ? gallery2Data.paintings.length : 0,
        items: gallery2Data.paintings ? gallery2Data.paintings.map(p => ({id: p.id, title: p.title})) : []
    });
    console.log('📊 ==================================');
}
        // Функция для обработки кнопки "Перейти к оплате"
        function handleProceedToPayment() {
            const proceedBtn = document.getElementById('proceed-to-payment');
            
            if (proceedBtn) {
                proceedBtn.addEventListener('click', async function() {
                    const contactInput = document.getElementById('contact-input');
                    const agreementCheckbox = document.getElementById('accept-agreement');
                    
                    if (cart.items.length === 0) {
                        alert('Корзина пуста');
                        return;
                    }
                    
                    if (!contactInput || !contactInput.value.trim()) {
                        alert('Пожалуйста, введите контактные данные');
                        return;
                    }
                    
                    if (!agreementCheckbox || !agreementCheckbox.checked) {
                        alert('Необходимо принять условия договора');
                        return;
                    }
                    
                    // Показываем индикатор загрузки
                    proceedBtn.disabled = true;
                    proceedBtn.textContent = 'Сохранение заказа...';
                    
                    try {
                        // Генерируем номер заказа
                        const orderNumber = generateOrderNumber();
                        
                        // Создаем данные заказа
                        const orderData = {
                            orderNumber: orderNumber,
                            contact: contactInput.value.trim(),
                            items: cart.items.map(item => ({
                                id: item.id,
                                title: item.title,
                                price: item.price,
                                image: item.image
                            })),
                            total: cart.total,
                            timestamp: new Date().toISOString(),
                            status: 'pending'
                        };
                        
                        // Сохраняем заказ на сервере
                        const savedOrderNumber = await saveOrderToServer(orderData);
                        
                        // Также сохраняем локально как резервную копию
                        saveOrder(orderData);
                        
                        // Показываем сообщение об успехе
                        alert(`✅ Заказ №${savedOrderNumber} создан!\n\n📞 Контактные данные: ${contactInput.value.trim()}\n💰 Сумма к оплате: ${cart.total} ₽\n\n🎨 Товаров в заказе: ${cart.items.length}\n\nСпасибо за покупку! Мы свяжемся с вами в ближайшее время.`);
                        
                        console.log('📦 Заказ создан:', orderData);
                        
                        // Очищаем корзину
                        clearCart();
                        
                        // Переходим на главную страницу
                        showPage('home');
                        
                    } catch (error) {
                        console.error('❌ Ошибка создания заказа:', error);
                        
                        // Показываем ошибку пользователю
                        alert(`❌ Ошибка при создании заказа:\n\n${error.message}\n\nПопробуйте еще раз или свяжитесь с нами напрямую.`);
                        
                        // Восстанавливаем кнопку
                        proceedBtn.disabled = false;
                        proceedBtn.textContent = 'Перейти к оплате';
                    }
                });
            }
        }
        // Глобальная функция для обновления слайдера
        function updateModalSlider() {
            if (!currentModalPainting) {
                console.error('❌ currentModalPainting не установлена в updateModalSlider!');
                return;
            }
            
            const modal = document.getElementById('painting-modal');
            if (!modal) {
                console.error('❌ Модальное окно не найдено!');
                return;
            }
            
            const newImage = modal.querySelector('.painting-slider__image');
            const prevBtn = modal.querySelector('.painting-slider__arrow--prev');
            const nextBtn = modal.querySelector('.painting-slider__arrow--next');
            
            if (currentModalPainting.images && currentModalPainting.images.length > 0) {
                const photoNumber = currentModalImageIndex + 1;
                const totalPhotos = currentModalPainting.images.length;
                const currentPhotoPath = currentModalPainting.images[currentModalImageIndex];
                
                console.log('📸 ===== ОТОБРАЖЕНИЕ ФОТОГРАФИИ =====');
                console.log('📸 Картина:', currentModalPainting.title);
                console.log('📸 Фотография номер:', photoNumber, 'из', totalPhotos);
                console.log('📸 Индекс в массиве:', currentModalImageIndex);
                console.log('📸 Путь к файлу:', currentPhotoPath);
                console.log('📸 ======================================');
                
                if (newImage) {
                    // Добавляем обработчики ошибок загрузки
                    newImage.onerror = function() {
                        console.error('❌ ОШИБКА ЗАГРУЗКИ ИЗОБРАЖЕНИЯ:', currentPhotoPath);
                        console.error('❌ Картина:', currentModalPainting.title);
                        console.error('❌ Индекс:', currentModalImageIndex);
                        console.error('❌ Элемент изображения:', newImage);
                        console.error('❌ Текущий src:', newImage.src);
                        
                        // Показываем заглушку при ошибке загрузки
                        newImage.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDQwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNDAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0xNzUgMTI1SDIyNVYyNzVIMTc1VjEyNVoiIGZpbGw9IiNDQ0NDQ0MiLz4KPHBhdGggZD0iTTE1MCAyMDBIMjUwVjIyMEgxNTBWMjAwWiIgZmlsbD0iI0NDQ0NDQyIvPgo8L3N2Zz4K';
                    };
                    newImage.onload = function() {
                        console.log('✅ ИЗОБРАЖЕНИЕ ЗАГРУЖЕНО:', currentPhotoPath);
                        console.log('✅ Элемент изображения:', newImage);
                        console.log('✅ Текущий src:', newImage.src);
                        console.log('✅ Размеры изображения:', newImage.naturalWidth, 'x', newImage.naturalHeight);
                    };
                    
                    newImage.src = currentPhotoPath;
                }
                
                // Обновляем счетчик фотографий
                const photoCounter = modal.querySelector('.painting-slider__counter');
                if (photoCounter) {
                    photoCounter.textContent = `${photoNumber} / ${totalPhotos}`;
                }
                
                // Обновляем миниатюры
                const thumbnails = modal.querySelectorAll('.painting-slider__thumbnail');
                thumbnails.forEach((thumb, index) => {
                    thumb.classList.toggle('active', index === currentModalImageIndex);
                });
                
                // Показываем стрелки навигации
                if (prevBtn) {
                    prevBtn.style.display = 'flex';
                    prevBtn.style.visibility = 'visible';
                }
                if (nextBtn) {
                    nextBtn.style.display = 'flex';
                    nextBtn.style.visibility = 'visible';
                }
            } else {
                console.log('❌ У картины нет изображений');
                console.log('❌ Картина:', currentModalPainting.title);
                console.log('❌ Массив images:', currentModalPainting.images);
                console.log('❌ ======================================');
                
                // Показываем заглушку, если нет изображений
                if (newImage) {
                    newImage.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDQwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNDAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0xNzUgMTI1SDIyNVYyNzVIMTc1VjEyNVoiIGZpbGw9IiNDQ0NDQ0MiLz4KPHBhdGggZD0iTTE1MCAyMDBIMjUwVjIyMEgxNTBWMjAwWiIgZmlsbD0iI0NDQ0NDQyIvPgo8L3N2Zz4K';
                }
                
                // Скрываем стрелки навигации
                if (prevBtn) {
                    prevBtn.style.display = 'none';
                    prevBtn.style.visibility = 'hidden';
                }
                if (nextBtn) {
                    nextBtn.style.display = 'none';
                    nextBtn.style.visibility = 'hidden';
                }
            }
        }
        // Глобальная функция для перехода к предыдущей фотографии
        function handleModalPrevClick() {
            if (isAnimating) return; // Блокируем клики во время анимации
            
            if (!currentModalPainting) {
                console.error('❌ currentModalPainting не установлена!');
                return;
            }
            
            const oldIndex = currentModalImageIndex;
            const oldPhotoNumber = oldIndex + 1;
            
            console.log('⬅️ ===== КЛИК ПО ЛЕВОЙ СТРЕЛКЕ =====');
            console.log('⬅️ Картина:', currentModalPainting.title);
            console.log('⬅️ Текущая фотография:', oldPhotoNumber, 'из', currentModalPainting.images.length);
            console.log('⬅️ Текущий индекс:', oldIndex);
            
            if (currentModalPainting.images && currentModalPainting.images.length > 0 && currentModalImageIndex > 0) {
                const newIndex = currentModalImageIndex - 1;
                
                // Запускаем анимацию сдвига ленты
                animateImageChange(newIndex);
            } else {
                console.log('⬅️ Невозможно перейти назад (уже на первой фотографии)');
                console.log('⬅️ ======================================');
            }
        }
        
        // Глобальная функция для перехода к следующей фотографии
        function handleModalNextClick() {
            if (isAnimating) return; // Блокируем клики во время анимации
            
            if (!currentModalPainting) {
                console.error('❌ currentModalPainting не установлена!');
                return;
            }
            
            const oldIndex = currentModalImageIndex;
            const oldPhotoNumber = oldIndex + 1;
            
            console.log('➡️ ===== КЛИК ПО ПРАВОЙ СТРЕЛКЕ =====');
            console.log('➡️ Картина:', currentModalPainting.title);
            console.log('➡️ Текущая фотография:', oldPhotoNumber, 'из', currentModalPainting.images.length);
            console.log('➡️ Текущий индекс:', oldIndex);
            
            if (currentModalPainting.images && currentModalPainting.images.length > 0 && currentModalImageIndex < currentModalPainting.images.length - 1) {
                const newIndex = currentModalImageIndex + 1;
                
                // Запускаем анимацию сдвига ленты
                animateImageChange(newIndex);
            } else {
                console.log('➡️ Невозможно перейти вперед (уже на последней фотографии)');
                console.log('➡️ ======================================');
            }
        }
        
        // Глобальная функция для принудительной перезагрузки данных (для отладки)
        window.reloadGalleryData = async function() {
            console.log('🔄 Принудительная перезагрузка данных галереи...');
            localStorage.removeItem('janart_gallery_data');
            const success = await loadGalleryDataFromLocal();
            if (success) {
                initGallery(currentGalleryData, 'gallery-grid');
                console.log('✅ Данные перезагружены успешно!');
            } else {
                console.log('❌ Не удалось перезагрузить данные');
            }
        };
        
        // Глобальная функция для проверки доступности файла
        window.checkFileAccess = async function() {
            console.log('🔍 Проверяем доступность файла gallery-data.php...');
            try {
                const response = await fetch('gallery-data.php');
                console.log('📁 Статус ответа:', response.status, response.statusText);
                console.log('📁 Заголовки:', response.headers);
                if (response.ok) {
                    const data = await response.json();
                    console.log('📁 Данные файла:', data);
                    console.log('📁 Количество картин:', data.paintings ? data.paintings.length : 0);
                } else {
                    console.error('❌ Файл недоступен:', response.status);
                }
            } catch (error) {
                console.error('❌ Ошибка проверки файла:', error);
            }
        };
        
        // Инициализация обработчика логотипа (принудительная)
        function initLogoHandler() {
            const homeLogo = document.getElementById('home-logo');
            if (homeLogo) {
                console.log('✅ Логотип найден, добавляем обработчик клика');
                
                // Удаляем старые обработчики, если они есть
                homeLogo.removeEventListener('click', handleLogoClick);
                
                // Добавляем новый обработчик
                homeLogo.addEventListener('click', handleLogoClick);
                
                // Делаем логотип кликабельным
                homeLogo.style.cursor = 'pointer';
                homeLogo.style.userSelect = 'none';
                
                console.log('✅ Обработчик логотипа инициализирован');
                return true;
            } else {
                console.error('❌ Логотип с ID "home-logo" не найден!');
                return false;
            }
        }
        
        // Обработчик клика по логотипу
        function handleLogoClick(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('🏠 Клик по логотипу - переходим на главную');
            showPage('home');
        }
        let currentPaintingNumber = 1; // Номер текущей картины для управления фотографиями
        let currentProduct = null;
        let currentImageIndex = 0;
        let currentPaintingIndex = null; // индекс для модалки описания
        let touchStartX = 0;
        let touchEndX = 0;
        let numberOfPaintings = 3; // Количество картин по умолчанию
        let photosPerPainting = 1; // Количество фото на картину по умолчанию

        // ===== ФУНКЦИИ АДМИН-ПАНЕЛИ =====

        // Проверяем, является ли текущий URL админским
        function checkAdminURL() {
    const currentPath = window.location.pathname;
    const currentHash = window.location.hash;
    
    // Проверяем URL для Галереи 1
    if (currentPath.includes('/admin12345') || currentHash === '#admin12345') {
        setCurrentGallery('gallery');
        showAdminPanel();
        updateAdminPanelTitle('Галерея');
        return;
    }
    
    // Проверяем URL для Галереи 2
    if (currentPath.includes('/admin123456') || currentHash === '#admin123456') {
        setCurrentGallery('gallery2');
        showAdminPanel();
        updateAdminPanelTitle('Мастер-класс');
        return;
    }
}

        // Показать панель администратора
       function showAdminPanel() {
    const adminPanel = document.getElementById('admin-panel');
    if (adminPanel) {
        adminPanel.style.display = 'block';
        
        // Обновляем индикатор текущей галереи
        updateAdminGalleryIndicator();
        
        // Обновляем заголовок
        const galleryName = currentGalleryType === 'gallery' ? 'Галерея' : 'Мастер-класс';
        updateAdminPanelTitle(galleryName);
        
        // Загружаем данные для текущей галереи
        loadPaintingsList();
        generatePhotosConfig();
        generatePaintingsOrderConfig();
    }
}

        // Сохранить настройки количества картин
        async function savePaintingsSettings() {
            const count = parseInt(document.getElementById('paintings-count').value);
            if (count && count > 0) {
                numberOfPaintings = count;
                localStorage.setItem('numberOfPaintings', numberOfPaintings);
                
                // Создаем недостающие картины
                await createMissingPaintings();
                
                // Обновляем конфигурацию фотографий
                generatePhotosConfig();
                
                // Генерируем конфигурацию порядка картин
                generatePaintingsOrderConfig();
                
                // Обновляем галерею
            const galleryPayload = getCurrentGalleryData();
            initGallery(galleryPayload, 'gallery-grid');
                
                alert(`Настройки сохранены! Количество картин: ${count}`);
            } else {
                alert('Введите корректное количество картин');
            }
        }

        // Создать недостающие картины
        async function createMissingPaintings() {
            // Инициализируем массив для галереи, если его нет
        const currentGalleryData = getCurrentGalleryData();
        if (!currentGalleryData.paintings) {
            currentGalleryData.paintings = [];
        }
            
            // Создаем картины, которых еще нет
            for (let i = 1; i <= numberOfPaintings; i++) {
                const paintingIndex = i - 1;
                
                // Если картины еще нет, создаем ее
            if (!currentGalleryData.paintings[paintingIndex]) {
                    const newPainting = {
                        id: `PAINTING_${i}`,
                        title: `Без названия, №${i}`,
                        size: i % 2 === 0 ? '36" x 48"' : '48" x 36"',
                        price: i === 5 ? "2 160 ₽" : "3 450 ₽",
                        mainImage: '', // Пустое изображение
                        images: [], // Пустой массив изображений
                        soldOut: false,
                        description: "Акрил, мраморная пыль и пигмент на холсте, 2024"
                    };
                    
                    currentGalleryData.paintings[paintingIndex] = newPainting;
                }
            }
            
            // Удаляем лишние картины, если количество уменьшилось
            if (currentGalleryData.paintings.length > numberOfPaintings) {
                currentGalleryData.paintings.splice(numberOfPaintings);
            }
            
            // Сохраняем изменения
            await saveGalleryDataComplete();
        }
// Получить текущую галерею в админ-панели
function getCurrentAdminGallery() {
    return currentGalleryType;
}

// Получить данные текущей галереи
function getCurrentGalleryData() {
    return currentGalleryType === 'gallery' ? galleryData : gallery2Data;
}
// Сохранить данные текущей галереи
async function saveCurrentGalleryData() {
    const currentData = getCurrentGalleryData();
    const dataToSave = {
        gallery: galleryData,
        gallery2: gallery2Data,
        version: '3.0'
    };
    
    localStorage.setItem('janart_gallery_data', JSON.stringify(dataToSave));
    
    // Отправляем на сервер
    await saveGalleryDataToHosting(dataToSave);
}
        // Генерировать конфигурацию фотографий для картин
        // В функции generatePhotosConfig() добавляем переключатель:
function generatePhotosConfig() {
    const container = document.getElementById('paintings-photos-config');
    if (!container) return;
    
    // Получаем данные ТЕКУЩЕЙ галереи
    const currentGalleryData = getCurrentGalleryData();
    const currentGalleryItems = currentGalleryData.paintings || [];
    const numberOfPaintings = currentGalleryItems.length;
    
    container.innerHTML = ''; // Очищаем контейнер ПЕРВЫМ делом
            
            for (let i = 1; i <= numberOfPaintings; i++) {
                const paintingIndex = i - 1;
                const currentPainting = currentGalleryData.paintings && currentGalleryData.paintings[paintingIndex];
                const currentPhotosCount = currentPainting && currentPainting.images ? currentPainting.images.length : 0;
                const currentVideosCount = currentPainting && currentPainting.videos ? currentPainting.videos.length : 0;
                
                const paintingDiv = document.createElement('div');
                paintingDiv.className = 'painting-photos-config';
                paintingDiv.style.cssText = 'margin-bottom: 20px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9; display: grid; grid-template-columns: 140px 1fr; gap: 16px; align-items: start;';

                const previewUrl = currentPainting && currentPainting.images && currentPainting.images.length > 0 ? currentPainting.images[0] : '';
                const previewHtml = previewUrl ? `<img src="${previewUrl}" alt="preview" style="width: 140px; height: 140px; object-fit: cover; border-radius: 6px; border: 1px solid #ddd;">` : '<div style="width: 140px; height: 140px; background:#eee; border:1px solid #ddd; border-radius:6px;"></div>';
                
                paintingDiv.innerHTML = `
                    <div class="painting-admin-preview">${previewHtml}</div>
                    <div class="painting-admin-content">
                    <h4>Картина №${i} ${currentPainting ? `"${currentPainting.title}"` : ''} <span style="font-size: 12px; color: #999;">(${currentPainting ? currentPainting.id : 'Новая'})</span></h4>
                    <div style="margin-bottom: 10px;">
                        <strong>Текущее количество фотографий: <span id="current-photos-count-${i}" style="color: #007bff;">${currentPhotosCount}</span></strong>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>Прикреплено видео: <span id="current-videos-count-${i}" style="color: #ff8c00;">${currentVideosCount}</span></strong>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <button class="admin-btn" id="add-photos-btn-${i}" style="margin-right: 10px;">Добавить фотографии</button>
                        <button class="admin-btn" id="add-videos-btn-${i}" style="margin-right: 10px; background: #ff8c00;">Добавить видео</button>
                        <button class="admin-btn" id="manage-photos-btn-${i}" style="background: #28a745; margin-right: 10px;">Управлять фотографиями</button>
                            <button class="admin-btn" id="description-btn-photos-${i}" style="background: #6f42c1; margin-right: 10px;">Описание картины</button>
                        <button class="admin-btn" id="delete-painting-btn-${i}" style="background: #dc3545; margin-right: 10px;">Удалить картину</button>
                        <button class="admin-btn" id="move-painting-up-btn-${i}" style="background: #17a2b8; margin-right: 5px; padding: 5px 10px; font-size: 12px;">↑ Вверх</button>
                        <button class="admin-btn" id="move-painting-down-btn-${i}" style="background: #17a2b8; margin-right: 10px; padding: 5px 10px; font-size: 12px;">↓ Вниз</button>
                    </div>
                    <div id="photos-preview-${i}" class="image-preview" style="margin-top: 10px;"></div>
                    <div id="photos-management-${i}" class="photos-management-section" style="display: none; margin-top: 15px; padding: 15px; background: white; border-radius: 5px; border: 1px solid #ccc; max-height: none; overflow: visible;">
                        <h5>Управление фотографиями:</h5>
                        <div id="photos-list-${i}" style="max-height: none; overflow: visible;"></div>
                        <div id="videos-list-${i}" style="margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 15px;"></div>
                        </div>
                    </div>
                `;
                
                container.appendChild(paintingDiv);
            }
            
            // Добавляем обработчики для кнопок
            for (let i = 1; i <= numberOfPaintings; i++) {
                const addBtn = document.getElementById(`add-photos-btn-${i}`);
                const manageBtn = document.getElementById(`manage-photos-btn-${i}`);
                const moveUpBtn = document.getElementById(`move-painting-up-btn-${i}`);
                const moveDownBtn = document.getElementById(`move-painting-down-btn-${i}`);
                const deleteBtn = document.getElementById(`delete-painting-btn-${i}`);
                const descriptionBtn = document.getElementById(`description-btn-photos-${i}`);
                
                if (addBtn) {
                    addBtn.addEventListener('click', function() {
                        addPhotosForPainting(i);
                    });
                }
                
                const addVideoBtn = document.getElementById(`add-videos-btn-${i}`);
                if (addVideoBtn) {
                    addVideoBtn.addEventListener('click', function() {
                        addVideosForPainting(i);
                    });
                }

                if (manageBtn) {
                    manageBtn.addEventListener('click', function() {
                        togglePhotosManagement(i);
                    });
                }
                
                if (moveUpBtn) {
                    moveUpBtn.addEventListener('click', function() {
                        movePaintingInList(i - 1, 'up');
                    });
                }
                
                if (moveDownBtn) {
                    moveDownBtn.addEventListener('click', function() {
                        movePaintingInList(i - 1, 'down');
                    });
                }
                
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', function() {
                        deletePainting(i - 1);
                    });
                }

                if (descriptionBtn) {
                    descriptionBtn.addEventListener('click', function() {
                        const index = i - 1;
                        if (typeof window.openDescriptionModal === 'function') {
                            openDescriptionModal(index);
                        } else {
                            console.error('Функция openDescriptionModal не найдена');
                        }
                    });
                }
            }
        }

        // Переключить отображение управления фотографиями
        function togglePhotosManagement(paintingNumber) {
            const managementDiv = document.getElementById(`photos-management-${paintingNumber}`);
            const photosListDiv = document.getElementById(`photos-list-${paintingNumber}`);
            
            if (managementDiv.style.display === 'none') {
                managementDiv.style.display = 'block';
                currentPaintingNumber = paintingNumber; // Запоминаем текущую картину
                loadPhotosList(paintingNumber);
            } else {
                managementDiv.style.display = 'none';
            }
        }
        
        // Принудительно открыть управление фотографиями (не переключать)
        function openPhotosManagement(paintingNumber) {
            const managementDiv = document.getElementById(`photos-management-${paintingNumber}`);
            managementDiv.style.display = 'block';
            currentPaintingNumber = paintingNumber; // Запоминаем текущую картину
            console.log(`Открываем управление фотографиями для картины ${paintingNumber}, текущая картина: ${currentPaintingNumber}`);
            loadPhotosList(paintingNumber);
        }

        // Загрузить список фотографий для управления
        function loadPhotosList(paintingNumber) {
            const photosListDiv = document.getElementById(`photos-list-${paintingNumber}`);
            const paintingIndex = paintingNumber - 1;
            const currentGalleryData = getCurrentGalleryData();
            const painting = currentGalleryData.paintings && currentGalleryData.paintings[paintingIndex];
            
                if (!painting || !painting.images || painting.images.length === 0) {
                photosListDiv.innerHTML = '<p>У этой картины нет фотографий. Добавьте фотографии, нажав кнопку "Добавить фотографии".</p>';
                return;
            }
            
            photosListDiv.innerHTML = `
                <div style="margin-bottom: 15px; padding: 10px; background: #e9ecef; border-radius: 5px;">
                    <strong>Изменение порядка фотографий:</strong>
                    <div style="margin-top: 10px;">
                        <button class="admin-btn" onclick="moveSelectedPhoto(${paintingNumber}, 'up')" style="margin-right: 10px; padding: 5px 15px; font-size: 12px;">↑ Вверх</button>
                        <button class="admin-btn" onclick="moveSelectedPhoto(${paintingNumber}, 'down')" style="padding: 5px 15px; font-size: 12px;">↓ Вниз</button>
                    </div>
                </div>
            `;
            
                painting.images.forEach((imageUrl, index) => {
                const photoDiv = document.createElement('div');
                photoDiv.style.cssText = 'display: flex; align-items: center; margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: white;';
                
                photoDiv.innerHTML = `
                    <input type="radio" name="photo-${paintingNumber}" value="${index}" style="margin-right: 15px;">
                    <img src="${imageUrl}" style="width: 60px; height: 60px; object-fit: cover; margin-right: 15px; border-radius: 4px;">
                    <div style="flex: 1;">
                        <div><strong>Фотография №${index + 1}</strong></div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">${imageUrl.split('/').pop()}</div>
                    </div>
                    <button class="admin-btn delete-photo-btn" data-painting="${paintingNumber}" data-photo-index="${index}" style="background: #dc3545; padding: 5px 10px; font-size: 12px;">Удалить</button>
                `;
                
                photosListDiv.appendChild(photoDiv);
            });

            // Назначаем обработчики удаления после рендера списка
            photosListDiv.querySelectorAll('.delete-photo-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const p = parseInt(btn.getAttribute('data-painting'));
                    const idx = parseInt(btn.getAttribute('data-photo-index'));
                    deletePhoto(p, idx);
                });
            });

            renderVideosList(paintingNumber, painting);
        }

        function renderVideosList(paintingNumber, painting) {
            const videosListDiv = document.getElementById(`videos-list-${paintingNumber}`);
            if (!videosListDiv) return;
            const videos = painting && painting.videos ? painting.videos : [];

            if (videos.length === 0) {
                videosListDiv.innerHTML = '<p style="margin:0;">Видео пока не загружены.</p>';
                return;
            }

            const list = document.createElement('div');
            list.style.display = 'flex';
            list.style.flexDirection = 'column';
            list.style.gap = '10px';

            videos.forEach((videoUrl, index) => {
                const item = document.createElement('div');
                item.style.cssText = 'display:flex; align-items:center; padding:10px; border:1px solid #ddd; border-radius:6px; background:#fff;';
                item.innerHTML = `
                    <video src="${videoUrl}" controls preload="metadata" style="width:140px; height:80px; object-fit:cover; margin-right: 10px;"></video>
                    <div style="flex:1;">
                        <div><strong>Видео №${index + 1}</strong></div>
                        <div style="font-size:12px; color:#666; margin-top:4px;">${videoUrl.split('/').pop()}</div>
                    </div>
                    <button class="admin-btn delete-video-btn" data-painting="${paintingNumber}" data-video-index="${index}" style="background:#dc3545; padding:5px 10px; font-size:12px;">Удалить</button>
                `;
                list.appendChild(item);
            });

            videosListDiv.innerHTML = `<h5 style="margin:0 0 10px;">Видео (${videos.length}):</h5>`;
            videosListDiv.appendChild(list);

            videosListDiv.querySelectorAll('.delete-video-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const p = parseInt(btn.getAttribute('data-painting'));
                    const idx = parseInt(btn.getAttribute('data-video-index'));
                    deleteVideo(p, idx);
                });
            });
        }

        function deleteVideo(paintingNumber, videoIndex) {
            if (!validateGalleryOperation(`Удаление видео ${videoIndex + 1} для картины ${paintingNumber}`)) {
                return;
            }

            const paintingIndex = paintingNumber - 1;
            const currentGalleryData = getCurrentGalleryData();
            const painting = currentGalleryData.paintings && currentGalleryData.paintings[paintingIndex];

            if (!painting || !painting.videos || painting.videos.length === 0) {
                return;
            }

            painting.videos.splice(videoIndex, 1);
            saveGalleryData();
            initGallery(currentGalleryData, 'gallery-grid');
            generatePhotosConfig();
            generatePaintingsOrderConfig();
            openPhotosManagement(paintingNumber);
        }

        // Удалить конкретную фотографию
        async function deletePhoto(paintingNumber, photoIndex) {
            // Проверяем, что операция выполняется для правильной галереи
            if (!validateGalleryOperation(`Удаление фотографии ${photoIndex + 1} для картины ${paintingNumber}`)) {
                return;
            }
            
            const paintingIndex = paintingNumber - 1;
            const currentGalleryData = getCurrentGalleryData();
            const painting = currentGalleryData.paintings && currentGalleryData.paintings[paintingIndex];
            
            console.log(`Удаление фотографии ${photoIndex + 1} из картины ${paintingNumber}`);
            console.log('Текущая картина:', painting);
            console.log('Фотографии до удаления:', painting ? painting.images : 'Картина не найдена');
            
            if (!painting || !painting.images || painting.images.length === 0) {
                return;
            }
            
            // Удаляем без подтверждения
                // Удаляем фотографию из массива
                painting.images.splice(photoIndex, 1);
                
                // Если фотографий не осталось, удаляем картину
                if (painting.images.length === 0) {
                    galleryData.paintings.splice(paintingIndex, 1);
                } else {
                    // Обновляем главное изображение
                    painting.mainImage = painting.images[0];
                }
                
                // Сохраняем изменения
                await saveGalleryDataComplete();
                
            // Сохраняем, обновляем галерею и конфигурации
            // (но оставляем раскрытым раздел "Управление фотографиями")
                initGallery(currentGalleryData, 'gallery-grid');
                generatePhotosConfig();
                generatePaintingsOrderConfig();
            
            // Повторно раскрываем раздел и перерисовываем список для выбранной картины
            setTimeout(() => {
                const photosSection = document.getElementById('photos-management-content');
                const photosHeader = document.getElementById('photos-management-header');
                const photosArrow = document.getElementById('photos-management-arrow');
                const section = photosHeader ? photosHeader.closest('.admin-section.collapsible') : null;
                if (section && section.classList.contains('collapsed')) {
                    section.classList.remove('collapsed');
                    if (photosSection) photosSection.style.maxHeight = photosSection.scrollHeight + 'px';
                    if (photosArrow) photosArrow.textContent = '▲';
                } else if (photosSection) {
                    photosSection.style.maxHeight = photosSection.scrollHeight + 'px';
                }
                openPhotosManagement(paintingNumber);
            }, 200);
                
                console.log('Фотографии после удаления:', painting.images);
                console.log('Галерея после удаления:', currentGalleryData.paintings);
        }
        // Переместить выбранную фотографию
        function moveSelectedPhoto(paintingNumber, direction) {
            const paintingIndex = paintingNumber - 1;
            const currentGalleryData = getCurrentGalleryData();
            const painting = currentGalleryData.paintings && currentGalleryData.paintings[paintingIndex];
            
            if (!painting || !painting.images) {
                alert('Картина не найдена');
                return;
            }
            
            // Получаем выбранную фотографию
            const selectedRadio = document.querySelector(`input[name="photo-${paintingNumber}"]:checked`);
            if (!selectedRadio) {
                alert('Выберите фотографию для перемещения');
                return;
            }
            
            const selectedIndex = parseInt(selectedRadio.value);
            const newIndex = direction === 'up' ? selectedIndex - 1 : selectedIndex + 1;
            
            // Проверяем границы
            if (newIndex < 0 || newIndex >= painting.images.length) {
                alert(`Нельзя переместить фотографию ${direction === 'up' ? 'вверх' : 'вниз'}`);
                return;
            }
            
            // Перемещаем фотографию
            const imageToMove = painting.images[selectedIndex];
            painting.images.splice(selectedIndex, 1);
            painting.images.splice(newIndex, 0, imageToMove);
            
            // Обновляем главное изображение, если переместили первую фотографию
            if (selectedIndex === 0 || newIndex === 0) {
                painting.mainImage = painting.images[0];
            }
            
            // Сохраняем изменения
            saveGalleryData();
            
            // Обновляем ТОЛЬКО текущую галерею
            initGallery(currentGalleryData, 'gallery-grid');
            
            // Перезагружаем список фотографий (не закрывая раздел управления)
            openPhotosManagement(paintingNumber);
            
            // Принудительно открываем раздел управления для текущей картины
            setTimeout(() => {
                console.log(`Принудительно открываем раздел управления для картины ${currentPaintingNumber}`);
                const managementDiv = document.getElementById(`photos-management-${currentPaintingNumber}`);
                if (managementDiv) {
                    managementDiv.style.display = 'block';
                    loadPhotosList(currentPaintingNumber);
                    console.log(`Раздел управления открыт для картины ${currentPaintingNumber}`);
                } else {
                    console.log(`Раздел управления не найден для картины ${currentPaintingNumber}`);
                }
            }, 100);
            
            // Восстанавливаем выделение на новой позиции
            setTimeout(() => {
                const newRadio = document.querySelector(`input[name="photo-${paintingNumber}"][value="${newIndex}"]`);
                if (newRadio) {
                    newRadio.checked = true;
                }
            }, 100);
        }

        // Удалить картину
        async function deletePainting(paintingIndex) {
            const currentGalleryData = getCurrentGalleryData();
            const painting = currentGalleryData.paintings && currentGalleryData.paintings[paintingIndex];
            
            if (!painting) {
                alert('Картина не найдена');
                return;
            }
            
            if (confirm(`Удалить картину "${painting.title}"?`)) {
                galleryData.paintings.splice(paintingIndex, 1);
                await saveGalleryDataComplete();
                initGallery(currentGalleryData, 'gallery-grid');
                generatePhotosConfig();
                generatePaintingsOrderConfig();
                alert('Картина удалена!');
            }
        }

        // Добавить фотографии для конкретной картины
        function addPhotosForPainting(paintingNumber) {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.accept = 'image/*,.heic,.heif';
            
            input.addEventListener('change', async function() {
                if (this.files && this.files.length > 0) {
                    await uploadPhotosForPainting(paintingNumber, this.files);
                }
            });
            
            input.click();
        }

        function addVideosForPainting(paintingNumber) {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.accept = 'video/*';
            
            input.addEventListener('change', async function() {
                if (this.files && this.files.length > 0) {
                    await uploadVideosForPainting(paintingNumber, this.files);
                }
            });
            
            input.click();
        }
        // Загрузить фотографии для картины на хостинг (reg.ru)
        async function uploadPhotosForPainting(paintingNumber, files) {
            if (!validateGalleryOperation(`Загрузка фотографий для картины ${paintingNumber}`)) {
                return;
            }
            
            const statusDiv = document.getElementById(`photos-preview-${paintingNumber}`);
            const addBtn = document.getElementById(`add-photos-btn-${paintingNumber}`);
            
            addBtn.disabled = true;
            statusDiv.innerHTML = '<div class="warning">Загружаем фотографии на сервер...</div>';
            
            try {
                const paintingIndex = paintingNumber - 1;
                const currentGalleryData = getCurrentGalleryData();

                if (!currentGalleryData.paintings) {
                    currentGalleryData.paintings = [];
                }

                if (!currentGalleryData.paintings[paintingIndex]) {
                    currentGalleryData.paintings[paintingIndex] = {
                        id: `PAINTING_${paintingNumber}`,
                        title: `Без названия, №${paintingNumber}`,
                        size: paintingNumber % 2 === 0 ? '36" x 48"' : '48" x 36"',
                        price: paintingNumber === 5 ? "2 160 ₽" : "3 450 ₽",
                        mainImage: '',
                        images: [],
                        soldOut: false,
                        description: "Акрил, мраморная пыль и пигмент на холсте, 2024"
                    };
                }

                const targetPainting = currentGalleryData.paintings[paintingIndex];
                const paintingId = targetPainting.id || `PAINTING_${paintingNumber}`;

                const formData = new FormData();
                formData.append('paintingId', paintingId);
                formData.append('galleryType', currentGalleryType);
                for (let i = 0; i < files.length; i++) {
                    formData.append('images[]', files[i]);
                }

                const response = await fetch('api/upload-image.php', {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                if (!data.success) {
                    console.error('Ошибки загрузки:', data.errors);
                    throw new Error('Не удалось загрузить файлы');
                }

                const uploaded = data.uploadedFiles || [];
                const newPaths = uploaded.map(f => f.path || f.url).filter(Boolean);

                // Инициализация структуры, если нужно
                
                const existingImages = targetPainting.images || [];
                const merged = [...existingImages, ...newPaths];
                    const unique = [];
                    const seen = new Set();
                    for (const url of merged) {
                        if (!seen.has(url)) {
                            seen.add(url);
                            unique.push(url);
                        }
                    }
                targetPainting.images = unique;
                if (!targetPainting.mainImage && unique.length > 0) {
                    targetPainting.mainImage = unique[0];
                }

                await saveGalleryDataComplete();
                const galleryPayload = getCurrentGalleryData();
                initGallery(galleryPayload, 'gallery-grid');
                generatePhotosConfig();
                generatePaintingsOrderConfig();
                openPhotosManagement(paintingNumber);
                    
                statusDiv.innerHTML = `<div class="success">✅ Загружено ${uploaded.length} файлов. Всего у картины: ${currentPainting.images.length}</div>`;
            } catch (error) {
                console.error('Ошибка загрузки:', error);
                statusDiv.innerHTML = `<div class=\"error\">❌ Ошибка: ${error.message}</div>`;
            } finally {
                addBtn.disabled = false;
            }
        }

        async function uploadVideosForPainting(paintingNumber, files) {
            if (!validateGalleryOperation(`Загрузка видео для картины ${paintingNumber}`)) {
                return;
            }

            const statusDiv = document.getElementById(`photos-preview-${paintingNumber}`);
            const addBtn = document.getElementById(`add-videos-btn-${paintingNumber}`);

            addBtn.disabled = true;
            statusDiv.innerHTML = '<div class="warning">Загружаем видео на сервер...</div>';

            try {
                const paintingIndex = paintingNumber - 1;
                const currentGalleryData = getCurrentGalleryData();

                if (!currentGalleryData.paintings) {
                    currentGalleryData.paintings = [];
                }

                if (!currentGalleryData.paintings[paintingIndex]) {
                    currentGalleryData.paintings[paintingIndex] = {
                        id: `PAINTING_${paintingNumber}`,
                        title: `Без названия, №${paintingNumber}`,
                        size: paintingNumber % 2 === 0 ? '36" x 48"' : '48" x 36"',
                        price: paintingNumber === 5 ? "2 160 ₽" : "3 450 ₽",
                        mainImage: '',
                        images: [],
                        videos: [],
                        soldOut: false,
                        description: "Акрил, мраморная пыль и пигмент на холсте, 2024"
                    };
                }

                const targetPainting = currentGalleryData.paintings[paintingIndex];
                const paintingId = targetPainting.id || `PAINTING_${paintingNumber}`;

                const formData = new FormData();
                formData.append('paintingId', paintingId);
                formData.append('galleryType', currentGalleryType);
                for (let i = 0; i < files.length; i++) {
                    formData.append('videos[]', files[i]);
                }

                const response = await fetch('api/upload-video.php', {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                if (!data.success) {
                    console.error('Ошибки загрузки видео:', data.errors);
                    throw new Error('Не удалось загрузить видео');
                }

                const uploaded = data.uploadedFiles || [];
                const newPaths = uploaded.map(f => f.path || f.url).filter(Boolean);
                const existingVideos = targetPainting.videos || [];
                const merged = [...existingVideos, ...newPaths];
                const unique = [];
                const seen = new Set();
                for (const url of merged) {
                    if (!seen.has(url)) {
                        seen.add(url);
                        unique.push(url);
                    }
                }
                targetPainting.videos = unique;

                await saveGalleryDataComplete();
                const galleryPayload = getCurrentGalleryData();
                initGallery(galleryPayload, 'gallery-grid');
                generatePhotosConfig();
                generatePaintingsOrderConfig();
                openPhotosManagement(paintingNumber);
                renderVideosList(paintingNumber, targetPainting);

                const videoCountSpan = document.getElementById(`current-videos-count-${paintingNumber}`);
                if (videoCountSpan) {
                    videoCountSpan.textContent = `${targetPainting.videos.length}`;
                }

                statusDiv.innerHTML = `<div class="success">✅ Прикреплено ${uploaded.length} видео</div>`;
            } catch (error) {
                console.error('Ошибка загрузки видео:', error);
                statusDiv.innerHTML = `<div class="error">❌ Ошибка: ${error.message}</div>`;
            } finally {
                if (addBtn) {
                    addBtn.disabled = false;
                }
            }
        }



        // Загрузить список картин для управления
        // Загрузить список картин для управления
function loadPaintingsList() {
    const paintingsList = document.getElementById('paintings-list');
    if (!paintingsList) return;
    
    // Получаем данные ТЕКУЩЕЙ галереи
    const currentGalleryData = getCurrentGalleryData();
    const currentGalleryItems = currentGalleryData.paintings || [];
    
    paintingsList.innerHTML = '<p>Загрузка списка картин...</p>';
    
    setTimeout(() => {
        paintingsList.innerHTML = '';
        
        if (currentGalleryItems.length === 0) {
            paintingsList.innerHTML = `<p>В ${getGalleryDisplayName()} картин пока нет. Добавьте картины через раздел "Управление фотографиями картин".</p>`;
            return;
        }
        
        // Создаем элементы для каждой картины в ТЕКУЩЕЙ галерее
        currentGalleryItems.forEach((item, index) => {
            const paintingElement = document.createElement('div');
            paintingElement.className = 'painting-item';
            paintingElement.innerHTML = `
                <h3>${item.title || 'Без названия'} <span style="font-size: 12px; color: #999;">(${item.id || `Картина ${index + 1}`})</span></h3>
                <p>Размер: ${item.size || 'Не указан'} | Цена: ${item.price || 'Не указана'}</p>
                <p>Количество фото: ${item.images ? item.images.length : 0}</p>
                <p>Галерея: ${currentGalleryType === 'gallery' ? 'Галерея' : 'Мастер-класс'}</p>
                <div style="margin-top: 10px;">
                    <button class="admin-btn" id="description-btn-list-${index}" style="background: #6f42c1; margin-right: 10px;">Описание картины</button>
                    <button class="delete-btn" data-gallery="${currentGalleryType}" data-index="${index}">Удалить</button>
                </div>
            `;
            
            paintingsList.appendChild(paintingElement);
        });
        
        // Добавляем обработчики для кнопок удаления (с указанием галереи)
        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const galleryType = this.getAttribute('data-gallery');
                const index = parseInt(this.getAttribute('data-index'));
                
                // Переключаемся на правильную галерею перед удалением
                setCurrentGallery(galleryType);
                deletePainting(index);
            });
        });
        
        // Добавляем обработчики для кнопок описания
        document.querySelectorAll('[id^="description-btn-list-"]').forEach(btn => {
            btn.addEventListener('click', function() {
                console.log('Кнопка описания нажата в списке картин');
                const index = parseInt(this.id.replace('description-btn-list-', ''));
                
                // Переключаемся на текущую галерею
                const currentGalleryData = getCurrentGalleryData();
                console.log('Текущая галерея:', currentGalleryType);
                console.log('Индекс картины:', index);
                console.log('Картина:', currentGalleryData.paintings ? currentGalleryData.paintings[index] : 'не найдена');
                console.log('Функция openDescriptionModal:', typeof window.openDescriptionModal);
                
                if (typeof window.openDescriptionModal === 'function') {
                    openDescriptionModal(index);
                } else {
                    console.error('Функция openDescriptionModal не найдена');
                }
            });
        });
        
        // Обновляем счетчик картин в заголовке
        updatePaintingsCount(currentGalleryItems.length);
        
        console.log(`✅ Список картин загружен для ${getGalleryDisplayName()}: ${currentGalleryItems.length} картин`);
        
    }, 300);
}

// Вспомогательная функция для обновления счетчика картин в заголовке
function updatePaintingsCount(count) {
    const paintingsManagementHeader = document.getElementById('paintings-management-header');
    if (paintingsManagementHeader) {
        const h2 = paintingsManagementHeader.querySelector('h2');
        if (h2) {
            // Обновляем заголовок с учетом текущей галереи
            const galleryName = getGalleryDisplayName();
            h2.innerHTML = `Управление существующими картинами (${galleryName}) <span style="font-size: 14px; color: #666;">- ${count} картин</span>`;
        }
    }
}

        // Удалить картину
        // Удалить картину из текущей галереи
async function deletePainting(paintingIndex) {
    // Получаем данные текущей галереи
    const currentGalleryData = getCurrentGalleryData();
    const painting = currentGalleryData.paintings && currentGalleryData.paintings[paintingIndex];
    
    if (!painting) {
        alert('Картина не найдена');
        return;
    }
    
    if (confirm(`Удалить картину "${painting.title}" из ${getGalleryDisplayName()}?`)) {
        // Удаляем картину из текущей галереи
        currentGalleryData.paintings.splice(paintingIndex, 1);
        
        // Сохраняем изменения
        await saveGalleryDataComplete();
        
        // Перезагружаем список для текущей галереи
        loadPaintingsList();
        
        // Обновляем галерею на фронтенде
        initGallery(currentGalleryData, 'gallery-grid');
        
        // Обновляем конфигурации в админ-панели
        generatePhotosConfig();
        generatePaintingsOrderConfig();
        
        alert(`Картина удалена из ${getGalleryDisplayName()}!`);
    }
}

        // Сохранить данные галереи в localStorage
        function saveGalleryData() {
            const dataToSave = {
                gallery: galleryData,
                gallery2: gallery2Data,
                version: '3.0'
            };
            localStorage.setItem('janart_gallery_data', JSON.stringify(dataToSave));
        }

        // Сохранить данные галереи (localStorage + Hosting)
        async function saveGalleryDataComplete() {
            saveGalleryData(); // Сохраняем в localStorage
            const now = new Date().toISOString();
            // Подготавливаем данные для отправки на сервер
            const dataToSave = {
                gallery: {
                    paintings: galleryData.paintings || [],
                    lastUpdated: now,
                    version: '3.0'
                },
                gallery2: {
                    paintings: gallery2Data.paintings || [],
                    lastUpdated: now,
                    version: '3.0'
                },
                version: '3.0'
            };
            await saveGalleryDataToHosting(dataToSave);
        }
        
        // Сохранить данные галереи на хостинге
        async function saveGalleryDataToHosting(payload) {
            try {
                const data = payload || {
                    gallery: {
                        paintings: galleryData.paintings || [],
                        lastUpdated: new Date().toISOString(),
                        version: '3.0'
                    },
                    gallery2: {
                        paintings: gallery2Data.paintings || [],
                        lastUpdated: new Date().toISOString(),
                        version: '3.0'
                    },
                    version: '3.0'
                };

                console.log('🌐 Сохраняем данные на хостинге для галерей:', {
                    gallery: data.gallery.paintings.length,
                    gallery2: data.gallery2.paintings.length,
                    timestamp: data.gallery.lastUpdated
                });
                
                const response = await fetch('update-gallery-data.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('✅ Данные успешно сохранены на хостинге:', result);
                } else {
                    const error = await response.text();
                    console.error('❌ Ошибка сохранения на хостинге:', response.status, error);
                }
            } catch (error) {
                console.error('❌ Ошибка при сохранении на хостинге:', error);
            }
        }

        // Загрузить данные галереи из файла
        // Загрузить данные галереи из файла (обновленная)
async function loadGalleryDataFromLocal() {
    console.log('📁 ===== ЗАГРУЗКА ДАННЫХ ИЗ ФАЙЛА =====');
    
    try {
        const filePath = 'gallery-data.php';
        const timestamp = new Date().getTime();
        const url = `${filePath}?t=${timestamp}`;
        
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 10000);
        
        console.log('📁 Загружаем данные из:', url);
        const response = await fetch(url, {
            signal: controller.signal,
            cache: 'no-cache'
        });
        clearTimeout(timeoutId);
        
        if (response.ok) {
            const data = await response.json();
            console.log('📁 Данные загружены из файла:', data);

            // Обработка нового формата с двумя галереями
            if (data.gallery && data.gallery2) {
                console.log('✅ Загружены данные двух галерей');
                galleryData.paintings = data.gallery.paintings || [];
                gallery2Data.paintings = data.gallery2.paintings || [];
                
                // ДЕТАЛЬНОЕ ЛОГИРОВАНИЕ
                console.log('📊 ===== СТАТИСТИКА ЗАГРУЖЕННЫХ ДАННЫХ =====');
                console.log('📊 Галерея (galleryData):', galleryData.paintings.length, 'картин');
                if (galleryData.paintings.length > 0) {
                    console.log('📊 Пример картин галереи 1 (первые 5):');
                    galleryData.paintings.slice(0, 5).forEach((p, i) => {
                        console.log(`   ${i + 1}. ID: ${p.id}, Название: "${p.title}", Фото: ${p.images ? p.images.length : 0}`);
                    });
                } else {
                    console.log('⚠️ Галерея ПУСТАЯ!');
                }
                
                console.log('---');
                console.log('📊 Мастер-класс (gallery2Data):', gallery2Data.paintings.length, 'картин');
                if (gallery2Data.paintings.length > 0) {
                    console.log('📊 Пример картин галереи 2 (первые 5):');
                    gallery2Data.paintings.slice(0, 5).forEach((p, i) => {
                        console.log(`   ${i + 1}. ID: ${p.id}, Название: "${p.title}", Фото: ${p.images ? p.images.length : 0}`);
                    });
                } else {
                    console.log('⚠️ Мастер-класс ПУСТАЯ!');
                }
                
                // Проверка на пустые массивы
                if (galleryData.paintings.length === 0 && gallery2Data.paintings.length > 0) {
                    console.warn('🚨 ВНИМАНИЕ: Галерея пустая, а Мастер-класс содержит данные!');
                } else if (gallery2Data.paintings.length === 0 && galleryData.paintings.length > 0) {
                    console.warn('🚨 ВНИМАНИЕ: Мастер-класс пустая, а Галерея содержит данные!');
                } else if (galleryData.paintings.length > 0 && gallery2Data.paintings.length > 0) {
                    console.log('✅ Обе галереи содержат данные');
                }
                
                console.log('📊 ===========================================');
                
            } else if (data.paintings) {
                console.log('✅ Мигрированы данные из старого формата');
                galleryData.paintings = data.paintings;
                gallery2Data.paintings = []; // Вторая галерея пустая
                
                console.log('📊 Старый формат: все картины загружены в Галерею 1');
                console.log(`📊 Картин в Галерее: ${galleryData.paintings.length}`);
                console.log(`📊 Картин в Мастер-классе: ${gallery2Data.paintings.length} (пустая)`);
                
                if (galleryData.paintings.length > 0) {
                    console.log('📊 Пример картин из старого формата:');
                    galleryData.paintings.slice(0, 3).forEach((p, i) => {
                        console.log(`   ${i + 1}. ID: ${p.id}, Название: "${p.title}"`);
                    });
                }
            } else {
                console.error('❌ Неизвестный формат данных:', data);
            }
            
            // Сохраняем в localStorage для отладки
            saveGalleryData();
            
            // Проверяем, что данные сохранились правильно
            const savedData = JSON.parse(localStorage.getItem('janart_gallery_data') || '{}');
            console.log('💾 Проверка сохраненных данных в localStorage:');
            console.log('💾 Галерея сохранена:', savedData.gallery ? savedData.gallery.paintings.length : 0);
            console.log('💾 Мастер-класс сохранена:', savedData.gallery2 ? savedData.gallery2.paintings.length : 0);
            
            return true;
        } else {
            console.error('❌ Ошибка HTTP при загрузке файла:', response.status, response.statusText);
        }
    } catch (error) {
        console.error('❌ Ошибка загрузки данных:', error);
        console.error('❌ Тип ошибки:', error.name);
        console.error('❌ Сообщение:', error.message);
        
        // Проверяем, есть ли данные в localStorage как fallback
        const savedData = loadGalleryData();
        if (savedData) {
            console.log('🔄 Используем данные из localStorage как fallback');
            if (savedData.gallery) galleryData = savedData.gallery;
            if (savedData.gallery2) gallery2Data = savedData.gallery2;
            
            console.log('🔄 Галерея из localStorage:', galleryData.paintings ? galleryData.paintings.length : 0);
            console.log('🔄 Мастер-класс из localStorage:', gallery2Data.paintings ? gallery2Data.paintings.length : 0);
            return true;
        }
    }
    
    console.log('⚠️ Не удалось загрузить данные ни из файла, ни из localStorage');
    return false;
}

        // Загрузить данные галереи из localStorage
        function loadGalleryData() {
    const savedData = localStorage.getItem('janart_gallery_data');
    if (savedData) {
        try {
            const data = JSON.parse(savedData);
            
            // Обработка нового формата (версия 3.0)
            if (data.gallery && data.gallery2) {
                galleryData = data.gallery;
                gallery2Data = data.gallery2;
                return data;
            }
            // Обработка старого формата (версия 2.0)
            else if (data.paintings) {
                galleryData.paintings = data.paintings;
                gallery2Data.paintings = [];
                return { gallery: galleryData, gallery2: gallery2Data };
            }
        } catch (error) {
            console.error('Ошибка парсинга сохраненных данных:', error);
        }
    }
    return null;
}


        // Проверить, что операция выполняется для галереи
        function validateGalleryOperation(operationName) {
            console.log(`Выполняется операция "${operationName}" для галереи`);
            return true;
        }

        // Мигрировать данные галереи (исправить ID)
        function migrateGalleryData() {
            // Мигрируем картины в единой галерее
            if (galleryData.paintings) {
                galleryData.paintings = galleryData.paintings.map((painting, index) => ({
                    ...painting,
                    id: `PAINTING_${index + 1}`
                }));
            }
            
            // Сохраняем обновленные данные
            saveGalleryData();
            console.log('Данные галереи мигрированы с обновленными ID');
        }

        // Очистить данные в GitHub
        async function clearGitHubData() {
            try {
                // Удаляем файл gallery-data.php
                const filePath = 'gallery-data.php';
                const existingFile = await getFileInfo(filePath);
                
                if (existingFile && existingFile.sha) {
                    await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${filePath}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `token ${GITHUB_CONFIG.token}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: 'Clear all gallery data',
                            sha: existingFile.sha
                        })
                    });
                }
                
                console.log('Данные в GitHub очищены');
            } catch (error) {
                console.error('Ошибка очистки данных в GitHub:', error);
            }
        }
        // Настройка сворачивания всех блоков админ-панели
        function setupCollapsibleSections() {
            const sections = [
                {
                    header: 'gallery-selection-header',
                    content: 'gallery-selection-content',
                    arrow: 'gallery-selection-arrow',
                    section: '.admin-section.collapsible'
                },
                {
                    header: 'gallery-settings-header',
                    content: 'gallery-settings-content',
                    arrow: 'gallery-settings-arrow',
                    section: '.admin-section.collapsible'
                },
                {
                    header: 'photos-management-header',
                    content: 'photos-management-content',
                    arrow: 'photos-management-arrow',
                    section: '.admin-section.collapsible'
                },
                {
                    header: 'order-management-header',
                    content: 'order-management-content',
                    arrow: 'order-management-arrow',
                    section: '.admin-section.collapsible'
                },
                {
                    header: 'paintings-management-header',
                    content: 'paintings-management-content',
                    arrow: 'paintings-management-arrow',
                    section: '.admin-section.collapsible'
                }
            ];
            
            sections.forEach(config => {
                const header = document.getElementById(config.header);
                const content = document.getElementById(config.content);
                const arrow = document.getElementById(config.arrow);
                
                if (header && content && arrow) {
                    // Устанавливаем начальное свернутое состояние
                    content.style.maxHeight = '0px';
                    
                    header.addEventListener('click', function() {
                        const section = header.closest(config.section);
                        
                        if (section.classList.contains('collapsed')) {
                            // Разворачиваем
                            section.classList.remove('collapsed');
                            content.style.maxHeight = content.scrollHeight + 'px';
                            arrow.textContent = '▲';
                        } else {
                            // Сворачиваем
                            section.classList.add('collapsed');
                            content.style.maxHeight = '0px';
                            arrow.textContent = '▼';
                        }
                    });
                }
            });
        }
// Добавить переключатель галерей в админ-панель
function addGallerySwitcherToAdminPanel() {
    const adminHeader = document.querySelector('.admin-header');
    if (!adminHeader) return;

    // Создаем переключатель
    const switcher = document.createElement('div');
    switcher.style.cssText = 'display: flex; gap: 10px; align-items: center; margin-left: 20px;';
    switcher.innerHTML = `
        <span style="font-size: 14px; color: #ccc;">Галерея:</span>
        <button id="switch-to-gallery1" class="admin-btn" style="padding: 5px 15px; font-size: 14px;">Галерея</button>
        <button id="switch-to-gallery2" class="admin-btn" style="padding: 5px 15px; font-size: 14px;">Мастер-класс</button>
        <button id="masterclass-visibility-toggle" class="admin-btn secondary" style="padding: 5px 15px; font-size: 14px;">Скрыть мастер-класс</button>
    `;

    // Вставляем после заголовка
    adminHeader.querySelector('h2').after(switcher);

    // Обработчики переключения
    document.getElementById('switch-to-gallery1').addEventListener('click', function() {
        setCurrentGallery('gallery');
        updateAdminPanelForCurrentGallery();
    });

    document.getElementById('switch-to-gallery2').addEventListener('click', function() {
        setCurrentGallery('gallery2');
        updateAdminPanelForCurrentGallery();
    });
    document.getElementById('masterclass-visibility-toggle').addEventListener('click', function() {
        toggleMasterclassVisibility();
    });
}

let masterClassVisible = true;

function loadMasterclassVisibilitySetting() {
    const stored = localStorage.getItem('masterclassVisible');
    if (stored === 'false') {
        masterClassVisible = false;
    } else {
        masterClassVisible = true;
    }
    applyMasterclassVisibility();
}

function toggleMasterclassVisibility() {
    masterClassVisible = !masterClassVisible;
    localStorage.setItem('masterclassVisible', masterClassVisible ? 'true' : 'false');
    applyMasterclassVisibility();
}

function applyMasterclassVisibility() {
    document.querySelectorAll('[data-page="gallery2"], .mobile-gallery-link[data-page="gallery2"]').forEach(el => {
        el.style.display = masterClassVisible ? '' : 'none';
    });
    const gallery2Page = document.getElementById('gallery2-page');
    if (gallery2Page) {
        gallery2Page.style.display = masterClassVisible ? '' : 'none';
    }
    const toggleBtn = document.getElementById('masterclass-visibility-toggle');
    if (toggleBtn) {
        toggleBtn.textContent = masterClassVisible ? 'Скрыть мастер-класс' : 'Показать мастер-класс';
    }
    if (!masterClassVisible && window.location.hash.replace('#', '') === 'gallery2') {
        showPage('gallery');
    }
}

// Обновить админ-панель для текущей галереи
function updateAdminPanelForCurrentGallery() {
    updateAdminPanelTitle();
    loadPaintingsList();
    generatePhotosConfig();
    generatePaintingsOrderConfig();
}
        // Инициализация админ-панели
function initAdminPanel() {
    // Проверяем URL при загрузке
    checkAdminURL();
    
    // Загружаем сохраненные настройки
    loadAdminSettings();
    
    // Загружаем настройки видимости Мастер-класса
    loadMasterclassVisibilitySetting();
    
    // Настройка сворачивания всех блоков админ-панели
    setupCollapsibleSections();
    
    // Настройка кнопки закрытия
    const adminCloseBtn = document.getElementById('admin-close');
    if (adminCloseBtn) {
        adminCloseBtn.addEventListener('click', function() {
            document.getElementById('admin-panel').style.display = 'none';
            window.location.hash = '';
            // Сбрасываем текущую галерею при закрытии
            setCurrentGallery('gallery');
        });
    }
    
    // Настройка кнопки сохранения настроек
    const saveSettingsBtn = document.getElementById('save-settings');
    if (saveSettingsBtn) {
        saveSettingsBtn.addEventListener('click', savePaintingsSettings);
    }
    
    // Настройка кнопки сохранения конфигурации фотографий
    const savePhotosConfigBtn = document.getElementById('save-photos-config');
    if (savePhotosConfigBtn) {
        savePhotosConfigBtn.addEventListener('click', function() {
            alert('Конфигурация фотографий сохранена!');
        });
    }
    
    // Обработчик для кнопки миграции данных
    const migrateDataBtn = document.getElementById('migrate-data');
    if (migrateDataBtn) {
        migrateDataBtn.addEventListener('click', function() {
            if (confirm('Это исправит ID всех картин в галерее. Продолжить?')) {
                migrateGalleryData();
                alert('Данные мигрированы! ID картин обновлены.');
                // Обновляем все админские функции
                generatePhotosConfig();
                generatePaintingsOrderConfig();
                loadPaintingsList();
            }
        });
    }
    
    // Загружаем сохраненные данные при инициализации
    const savedData = loadGalleryData();
    if (savedData) {
        if (savedData.gallery) {
            galleryData = savedData.gallery;
        }
        if (savedData.gallery2) {
            gallery2Data = savedData.gallery2;
        }
    }
    
    // Добавляем переключатель галерей в админ-панель (опционально)
    addGallerySwitcherToAdminPanel();
}

        // Загрузить настройки админ-панели
        function loadAdminSettings() {
            // Загружаем количество картин
            const savedPaintingsCount = localStorage.getItem('numberOfPaintings');
            if (savedPaintingsCount) {
                numberOfPaintings = parseInt(savedPaintingsCount);
                document.getElementById('paintings-count').value = numberOfPaintings;
            }
            
            // Генерируем конфигурацию фотографий
            generatePhotosConfig();
            
            // Генерируем конфигурацию порядка картин
            generatePaintingsOrderConfig();
        }

        // Генерировать конфигурацию порядка картин
        function generatePaintingsOrderConfig() {
            const container = document.getElementById('paintings-order-config');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Фильтруем картины, у которых есть фотографии
            const currentGalleryItems = galleryData.paintings || [];
            const validPaintings = currentGalleryItems.filter(item => item && item.images && item.images.length > 0);
            
            if (validPaintings.length === 0) {
                container.innerHTML = '<p>Нет картин с фотографиями для изменения порядка</p>';
                return;
            }
            
            validPaintings.forEach((painting, index) => {
                const paintingDiv = document.createElement('div');
                paintingDiv.style.cssText = 'display: flex; align-items: center; margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: white;';
                
                paintingDiv.innerHTML = `
                    <input type="radio" name="painting-order" value="${currentGalleryItems.indexOf(painting)}" style="margin-right: 15px;">
                    <img src="${painting.mainImage}" style="width: 60px; height: 60px; object-fit: cover; margin-right: 15px; border-radius: 4px;">
                    <div style="flex: 1;">
                        <div><strong>${painting.title}</strong> <span style="font-size: 10px; color: #999;">(${painting.id})</span></div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">Фотографий: ${painting.images.length} | Позиция: ${index + 1}</div>
                    </div>
                `;
                
                container.appendChild(paintingDiv);
            });
        }

        // Переместить картину в списке (новая функция для кнопок у каждой картины)
        async function movePaintingInList(paintingIndex, direction) {
            const newIndex = direction === 'up' ? paintingIndex - 1 : paintingIndex + 1;
            
            // Проверяем границы
            const currentGalleryItems = galleryData.paintings || [];
            if (newIndex < 0 || newIndex >= currentGalleryItems.length) {
                return; // Не показываем ошибку, просто ничего не делаем
            }
            
            // Перемещаем картину
            const paintingToMove = currentGalleryItems[paintingIndex];
            currentGalleryItems.splice(paintingIndex, 1);
            currentGalleryItems.splice(newIndex, 0, paintingToMove);
            
            // Сохраняем изменения и обновляем UI
            await saveGalleryDataComplete();
            initGallery(currentGalleryData, 'gallery-grid');
            generatePhotosConfig();
            generatePaintingsOrderConfig();
        }

        // Переместить выбранную картину (старая функция для радиокнопок)
        async function moveSelectedPainting(direction) {
            // Получаем выбранную картину
            const selectedRadio = document.querySelector('input[name="painting-order"]:checked');
            if (!selectedRadio) {
                alert('Выберите картину для перемещения');
                return;
            }
            
            const selectedIndex = parseInt(selectedRadio.value);
            const newIndex = direction === 'up' ? selectedIndex - 1 : selectedIndex + 1;
            const currentGalleryItems = galleryData.paintings || [];
            
            // Проверяем границы
            if (newIndex < 0 || newIndex >= currentGalleryItems.length) {
                alert(`Нельзя переместить картину ${direction === 'up' ? 'вверх' : 'вниз'}`);
                return;
            }
            
            // Перемещаем картину
            const paintingToMove = currentGalleryItems[selectedIndex];
            currentGalleryItems.splice(selectedIndex, 1);
            currentGalleryItems.splice(newIndex, 0, paintingToMove);
            
            // Сохраняем изменения
            await saveGalleryDataComplete();
            
            // Обновляем галерею
            initGallery(currentGalleryData, 'gallery-grid');
            
            // Перезагружаем конфигурацию порядка
            generatePaintingsOrderConfig();
        }

        // ===== ОСНОВНАЯ ФУНКЦИОНАЛЬНОСТЬ САЙТА =====
        // (ваш существующий код остается без изменений)

        // Автоматическое создание данных для галереи
        async function initializeGalleryItems() {
            // Загружаем настройки из localStorage
            const savedPaintingsCount = localStorage.getItem('numberOfPaintings');
            if (savedPaintingsCount) {
                numberOfPaintings = parseInt(savedPaintingsCount);
            }
            
            // Сначала пытаемся загрузить из локального файла
            const loadedFromLocal = await loadGalleryDataFromLocal();
            
            if (loadedFromLocal) {
                // Данные загружены из локального файла
                return;
            }
            
            // Если не удалось загрузить из GitHub, загружаем из localStorage
            const savedData = loadGalleryData();
            if (savedData && savedData.length > 0) {
                galleryItems = savedData;
                return;
            }
            
            // Данные по умолчанию
            galleryItems = Array.from({length: numberOfPaintings}, (_, i) => {
                const paintingNumber = i + 1;
                const images = Array.from({length: photosPerPainting}, (_, j) => {
                    const photoNumber = j + 1;
                    return `images/gallery/${paintingNumber}/${photoNumber}.JPG`;
                });
                
                return {
                    id: paintingNumber,
                    title: `Без названия, №${paintingNumber}`,
                    size: paintingNumber % 2 === 0 ? '36" x 48"' : '48" x 36"',
                    price: paintingNumber === 5 ? "2 160 ₽" : "3 450 ₽",
                    mainImage: images[0],
                    images: images,
                    soldOut: false,
                    description: "Акрил, мраморная пыль и пигмент на холсте, 2024"
                };
            });
            
            // Сохраняем данные по умолчанию
            saveGalleryData();
        }
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', async function() {
            // Показываем индикатор загрузки
            const loadingIndicator = document.createElement('div');
            loadingIndicator.id = 'loading-indicator';
            loadingIndicator.innerHTML = 'Загрузка...';
            loadingIndicator.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: white; padding: 20px; border-radius: 8px; z-index: 10000;';
            document.body.appendChild(loadingIndicator);
            
            try {
                // Очищаем localStorage для принудительной загрузки из файла
                localStorage.removeItem('janart_gallery_data');
                
                // Загружаем корзину из localStorage
                loadCartFromStorage();
                console.log('localStorage очищен, загружаем данные из файла...');
                
                // Принудительно загружаем данные из файла
                const loadedFromFile = await loadGalleryDataFromLocal();
                if (loadedFromFile) {
                    console.log('Данные успешно загружены из файла gallery-data.json');
                    initGallery(getCurrentGalleryData(), 'gallery-grid');
                    initNavigation();
                    initForms();
                    initContactsModal();
                    initURLRouting();
                    initAdminPanel();
                    initDescriptionModal();
                    
                    // Убираем индикатор загрузки
                    const loadingIndicator = document.getElementById('loading-indicator');
                    if (loadingIndicator) {
                        loadingIndicator.remove();
                    }
                    return;
                }
                
                // Если не удалось загрузить из файла, загружаем из localStorage
                const savedData = loadGalleryData();
                if (savedData && savedData.length > 0) {
                    galleryData.paintings = savedData;
                    initGallery(currentGalleryData, 'gallery-grid');
                    initNavigation();
                    initForms();
                    initContactsModal();
                    initURLRouting();
                    initAdminPanel();
                    initDescriptionModal();
                }
                
                // Затем пытаемся обновить данные из локального файла в фоне
                const localSuccess = await loadGalleryDataFromLocal();
                if (localSuccess) {
                    // Если данные обновились, перерисовываем галерею
                    initGallery(currentGalleryData, 'gallery-grid');
                } else {
                    // Если локальный файл недоступен, инициализируем с данными по умолчанию
            await initializeGalleryItems();
                    initGallery(currentGalleryData, 'gallery-grid');
                }
                
                // Инициализируем навигацию и остальные компоненты
                console.log('Инициализируем навигацию...');
                initNavigation();
                initForms();
                initContactsModal();
                initURLRouting();
                initAdminPanel();
                initDescriptionModal();
            } catch (error) {
                console.error('Ошибка инициализации:', error);
                // Fallback - инициализируем с данными по умолчанию
                await initializeGalleryItems();
            initGallery();
            initNavigation();
            initForms();
            initContactsModal();
            initURLRouting();
            initAdminPanel();
            initDescriptionModal();
            } finally {
                // Убираем индикатор загрузки
                if (loadingIndicator && loadingIndicator.parentNode) {
                    loadingIndicator.parentNode.removeChild(loadingIndicator);
                }
            }
            
            // Принудительно обновляем данные при обновлении страницы
            window.addEventListener('beforeunload', function() {
                // Очищаем кэш localStorage для принудительного обновления
                localStorage.removeItem('galleryData');
            });
            
            const mainHero = document.getElementById('main-hero');
            if (mainHero) {
                mainHero.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Клик по главной кнопке героя');
                showPage('gallery');
            });
            }
            
            // Инициализация обработчика логотипа
            initLogoHandler();
            
            // Дополнительная инициализация с задержкой (на случай, если DOM еще не готов)
            setTimeout(() => {
                console.log('🔄 Повторная инициализация логотипа...');
                initLogoHandler();
            }, 1000);
            
            // Глобальная функция для тестирования навигации
            window.testNavigation = function() {
                console.log('🧪 Тестируем навигацию...');
                
                // Проверяем наличие логотипа
                const homeLogo = document.getElementById('home-logo');
                console.log('🏠 Логотип:', homeLogo);
                
                // Проверяем наличие главной страницы
                const homePage = document.getElementById('home-page');
                console.log('🏠 Главная страница:', homePage);
                
                // Проверяем функцию showPage
                console.log('📄 Функция showPage:', typeof showPage);
                
                // Принудительно инициализируем логотип
                console.log('🔧 Принудительная инициализация логотипа...');
                const success = initLogoHandler();
                
                // Тестируем переход на главную
                if (typeof showPage === 'function') {
                    console.log('🧪 Тестируем переход на главную...');
                showPage('home');
                }
                
                return success;
            };
            
        // Глобальная функция для очистки обработчиков модального окна
        window.clearModalHandlers = function() {
            console.log('🧹 Очищаем все обработчики модального окна...');
            
            const modal = document.getElementById('painting-modal');
            if (!modal) return;
            
            const modalImageContainer = modal.querySelector('.painting-slider__image-container');
            if (modalImageContainer) {
                modalImageContainer.removeEventListener('touchstart', handleModalTouchStart);
                modalImageContainer.removeEventListener('touchend', handleModalTouchEnd);
            }
            
            const prevBtn = modal.querySelector('#prev-arrow');
            const nextBtn = modal.querySelector('#next-arrow');
            if (prevBtn) prevBtn.removeEventListener('click', handleModalPrevClick);
            if (nextBtn) nextBtn.removeEventListener('click', handleModalNextClick);
            
            console.log('✅ Обработчики модального окна очищены');
        };
            
            // Обработчики клавиатуры для стрелок
            document.addEventListener('keydown', handleKeyPress);
        });
        // Инициализация галереи
function initGallery(galleryDataObject = null, containerId = 'gallery-grid') {
    console.log('🎨 ===== ИНИЦИАЛИЗАЦИЯ ГАЛЕРЕИ =====');
    console.log('🎨 Тип галереи:', currentGalleryType);
    console.log('🎨 Контейнер ID:', containerId);
    
    // Используем данные текущей галереи, если не передан объект
    let galleryItems;
    if (galleryDataObject) {
        galleryItems = galleryDataObject.paintings || [];
    } else {
        // Получаем данные текущей галереи
        const currentGalleryData = getCurrentGalleryData();
        galleryItems = currentGalleryData.paintings || [];
    }
    
    console.log('🎨 Данные галереи:', galleryItems);
    
    // Проверка данных по галереям:
    console.log('🎨 Проверка данных по галереям:');
    if (currentGalleryType === 'gallery') {
        console.log('🎨 Используем данные galleryData:', galleryData.paintings ? galleryData.paintings.length : 0);
    } else {
        console.log('🎨 Используем данные gallery2Data:', gallery2Data.paintings ? gallery2Data.paintings.length : 0);
    }
    
    const galleryContainer = document.getElementById(containerId);
    if (!galleryContainer) {
        console.error('❌ Контейнер галереи не найден! ID:', containerId);
        console.error('❌ Доступные контейнеры на странице:');
        document.querySelectorAll('[id*="gallery"]').forEach(el => {
            console.error('   -', el.id, el.className);
        });
        return;
    }
    
    // Очищаем контейнер перед добавлением новых элементов
    galleryContainer.innerHTML = '';
    
    console.log('🎨 Текущие элементы галереи:', galleryItems);
    
    // Фильтруем картины, у которых есть хотя бы одно изображение
    const validGalleryItems = galleryItems.filter(item => item && item.images && item.images.length > 0);
    
    if (validGalleryItems.length === 0) {
        galleryContainer.innerHTML = `<div class="gallery-empty">Галерея пуста. Добавьте картины в админ-панели.</div>`;
        return;
    }
    
    validGalleryItems.forEach((item, index) => {
        console.log(`🖼️ Картина ${index + 1}: "${item.title}"`);
        console.log(`   ID: ${item.id}`);
        console.log(`   mainImage: ${item.mainImage}`);
        console.log(`   Количество фотографий: ${item.images ? item.images.length : 0}`);
        console.log(`   Все фотографии:`, item.images);
        
        const galleryItem = document.createElement('div');
        galleryItem.className = 'gallery-item';
        
        // Создаем основной контейнер для изображений (квадратный)
        const imageContainer = document.createElement('div');
        imageContainer.className = 'gallery-image-container';
        
        // Основное изображение
        const mainImage = document.createElement('img');
        mainImage.src = item.mainImage || item.images[0];
        mainImage.alt = item.title;
        mainImage.loading = 'lazy';
        mainImage.style.width = '100%';
        mainImage.style.height = '100%';
        mainImage.style.objectFit = 'cover';
        mainImage.style.transition = 'transform 0.3s ease';
        
        // Добавляем обработчик ошибок загрузки изображений
        mainImage.onerror = function() {
            this.style.display = 'none';
            const placeholder = document.createElement('div');
            placeholder.className = 'image-placeholder';
            placeholder.textContent = 'Изображение недоступно';
            placeholder.style.cssText = 'display: flex; align-items: center; justify-content: center; height: 100%; background: #f0f0f0; color: #666; font-size: 14px;';
            imageContainer.appendChild(placeholder);
        };
        
        // Второе изображение для hover эффекта
        let hoverImage = null;
        if (item.images.length > 1) {
            hoverImage = document.createElement('img');
            hoverImage.src = item.images[1];
            hoverImage.alt = item.title;
            hoverImage.className = 'hover-image';
            hoverImage.style.width = '100%';
            hoverImage.style.height = '100%';
            hoverImage.style.objectFit = 'cover';
        }
        
        imageContainer.appendChild(mainImage);
        if (hoverImage) {
            imageContainer.appendChild(hoverImage);
        }
        
        // Информация о картине
        const infoDiv = document.createElement('div');
        infoDiv.className = 'gallery-item-info';
        infoDiv.innerHTML = `
            <div class="gallery-item-title">${item.title}</div>
            <div class="gallery-item-price">${item.price}</div>
            <div class="gallery-item-size">${item.size}</div>
        `;
        
        galleryItem.appendChild(imageContainer);
        galleryItem.appendChild(infoDiv);
        
        galleryItem.addEventListener('click', function() {
            // Находим индекс картины в отфильтрованном массиве validGalleryItems
            const paintingIndex = validGalleryItems.findIndex(p => p.id === item.id || p === item);
            const finalIndex = paintingIndex !== -1 ? paintingIndex : index;
            
            // Передаем правильные данные в showPaintingModal
            showPaintingModal(item, finalIndex, galleryDataObject);
        });
        
        galleryContainer.appendChild(galleryItem);
    });
    
    console.log('🎨 Галерея инициализирована, добавлено элементов:', validGalleryItems.length);
    console.log('🎨 ===========================================');
    
    // Предзагружаем все изображения для ускорения открытия модального окна
    preloadAllImages(validGalleryItems);
}
        
        // Предзагрузка всех изображений
        function preloadAllImages(paintings) {
            console.log('📥 Начинаем предзагрузку изображений...');
            let totalImages = 0;
            let loadedImages = 0;
            
            paintings.forEach((painting, paintingIndex) => {
                if (painting.images && painting.images.length > 0) {
                    painting.images.forEach((imagePath, imageIndex) => {
                        totalImages++;
                        const img = new Image();
                        
                        img.onload = function() {
                            loadedImages++;
                            console.log(`✅ Загружено ${loadedImages}/${totalImages}: ${painting.title} - ${imagePath}`);
                        };
                        
                        img.onerror = function() {
                            loadedImages++;
                            console.warn(`❌ Ошибка загрузки ${loadedImages}/${totalImages}: ${painting.title} - ${imagePath}`);
                        };
                        
                        img.src = imagePath;
                    });
                }
            });
            
            console.log(`📥 Всего изображений для предзагрузки: ${totalImages}`);
        }

        // Показать модальное окно картины
        // Флаг для блокировки свайпов во время анимации
        let isAnimating = false;
        
        // Анимация переключения изображений: сдвиг ленты по индексу (оптимизированная версия)
        function animateImageChange(newIndex) {
            return new Promise((resolve) => {
                // Быстрая проверка на валидность
                if (isAnimating) { resolve(); return; }
                if (!currentModalPainting || !Array.isArray(currentModalPainting.images) || 
                    newIndex < 0 || newIndex >= currentModalPainting.images.length) { 
                    resolve(); return; 
                }
                
                const modal = document.getElementById('painting-modal');
                if (!modal) { resolve(); return; }
                
                const imagesWrapper = modal.querySelector('.painting-slider__images-wrapper');
                const container = modal.querySelector('.painting-slider__image-container');
                if (!imagesWrapper || !container) { resolve(); return; }
                
                // Блокируем повторные вызовы
                isAnimating = true;
                
                // Вычисляем смещение
                const offset = -newIndex * container.clientWidth;
                
                // Используем requestAnimationFrame для более плавной анимации
                requestAnimationFrame(() => {
                    // Увеличена скорость анимации в 2 раза (с 1s до 0.5s)
                    imagesWrapper.style.transition = 'transform 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
                    imagesWrapper.style.transform = `translateX(${offset}px)`;
                    
                    // Используем более точный таймер
                    setTimeout(() => {
                        currentModalImageIndex = newIndex;
                        updateModalSlider();
                        isAnimating = false;
                        resolve();
                    }, 500); // Уменьшено с 1000ms до 500ms
                });
            });
        }

        function showPaintingModal(painting, paintingIndex = null) {
            console.log('🎨 ===== ОТКРЫТИЕ КАРТИНЫ =====');
            console.log('🎨 Картина:', painting.title);
            console.log('🎨 ID картины:', painting.id);
            console.log('🎨 Индекс картины:', paintingIndex);
            console.log('🎨 Количество фотографий:', painting.images ? painting.images.length : 0);
            console.log('🎨 Все фотографии:', painting.images);
            console.log('🎨 ================================');
            // Получаем данные текущей галереи
    const currentGalleryData = getCurrentGalleryData();
    const currentGalleryItems = currentGalleryData.paintings || [];
            // Если индекс не передан, находим его
            if (paintingIndex === null || paintingIndex === undefined) {
                const currentGalleryItems = galleryData.paintings || [];
                const validGalleryItems = currentGalleryItems.filter(item => item && item.images && item.images.length > 0);
                paintingIndex = validGalleryItems.findIndex(p => (p.id && painting.id && p.id === painting.id) || p === painting);
                if (paintingIndex === -1) {
                    paintingIndex = 0; // Fallback на первую картину
                }
            }
            
            // Обновляем URL на #gallery/{index} (индекс начинается с 1 для пользователя)
            const baseURL = window.location.origin + window.location.pathname;
            const newURL = baseURL + `#gallery/${paintingIndex + 1}`;
            if (window.location.href !== newURL) {
                window.history.pushState({page: 'gallery', paintingIndex: paintingIndex}, '', newURL);
            }
            
            const modal = document.getElementById('painting-modal');
            if (!modal) {
                console.error('Модальное окно не найдено!');
                return;
            }
            
            console.log('Модальное окно найдено:', modal);
            console.log('HTML модального окна:', modal.innerHTML);

            // Заполняем информацию о картине
            modal.querySelector('.painting-modal__title').textContent = painting.title;
            modal.querySelector('.painting-modal__price').textContent = painting.price;
            modal.querySelector('.painting-modal__size').textContent = painting.size;
            modal.querySelector('.painting-modal__description').textContent = painting.description || '';
            
            // Заполняем мобильную информацию о картине
            const mobileTitle = modal.querySelector('.painting-modal__mobile-title');
            const mobilePrice = modal.querySelector('.painting-modal__mobile-price');
            const mobileSize = modal.querySelector('.painting-modal__mobile-size');
            const mobileDescription = modal.querySelector('.painting-modal__mobile-description');
            
            console.log('🔍 Мобильные элементы:', {
                mobileTitle: !!mobileTitle,
                mobilePrice: !!mobilePrice,
                mobileSize: !!mobileSize,
                mobileDescription: !!mobileDescription
            });
            
            if (mobileTitle) mobileTitle.textContent = painting.title;
            if (mobilePrice) mobilePrice.textContent = painting.price;
            if (mobileSize) mobileSize.textContent = painting.size;
            if (mobileDescription) mobileDescription.textContent = painting.description || '';
            
            console.log('📱 Мобильная информация заполнена:', {
                title: painting.title,
                price: painting.price,
                size: painting.size,
                description: painting.description
            });

            // Показываем модальное окно сначала
            console.log('Показываем модальное окно');
            modal.style.display = 'flex';
            modal.style.visibility = 'visible';
            modal.style.opacity = '1';
            document.body.style.overflow = 'hidden';
            
            // Принудительно обновляем стили
            modal.offsetHeight; // Принудительный reflow
            
            console.log('Модальное окно должно быть видимо');
            console.log('Стиль модального окна:', modal.style.display);
            console.log('Видимость модального окна:', modal.offsetParent !== null);
            console.log('Computed style display:', window.getComputedStyle(modal).display);
            console.log('Computed style visibility:', window.getComputedStyle(modal).visibility);

            // Теперь ищем элементы после показа модального окна
            const imageContainer = modal.querySelector('.painting-slider__image-container');
            const thumbsContainer = modal.querySelector('.painting-slider__thumbs');
            const imagesWrapper = modal.querySelector('.painting-slider__images-wrapper');
            
            // Сбрасываем позицию wrapper'а и скрываем следующее изображение
            if (imagesWrapper) {
                imagesWrapper.style.transform = 'translateX(0)';
            }
            // Очищаем и строим ленту изображений заново
            imagesWrapper.innerHTML = '';
            if (painting.images && painting.images.length) {
                painting.images.forEach((src, idx) => {
                    const item = document.createElement('div');
                    item.className = 'painting-slider__image-item';
                    const img = document.createElement('img');
                    img.className = 'painting-slider__image';
                    img.src = src;
                    img.alt = `${painting.title} - ${idx + 1}`;
                    item.appendChild(img);
                    imagesWrapper.appendChild(item);
                });
            }
            
            console.log('Построена лента изображений, всего:', painting.images.length);
            
            // Выставляем начальную позицию ленты
            currentModalImageIndex = 0;
            imagesWrapper.style.transform = 'translateX(0)';
            
            // Проверяем размеры контейнера изображения
            if (imageContainer) {
                console.log('Размеры контейнера изображения:', {
                    offsetWidth: imageContainer.offsetWidth,
                    offsetHeight: imageContainer.offsetHeight,
                    clientWidth: imageContainer.clientWidth,
                    clientHeight: imageContainer.clientHeight
                });
                
                // Принудительно обновляем стили контейнера
                imageContainer.style.position = 'relative';
                imageContainer.style.overflow = 'hidden';
                imageContainer.style.background = '#ebebeb';
                
                console.log('Принудительно установлены стили контейнера изображения');
            }
            
            if (!imageContainer) {
                console.error('imageContainer не найден!');
                return;
            }
            if (!thumbsContainer) {
                console.error('thumbsContainer не найден!');
                return;
            }
            
            // Создаём миниатюры
            if (painting.images && painting.images.length > 0) {
                thumbsContainer.innerHTML = '';
                painting.images.forEach((image, index) => {
                    const thumb = document.createElement('img');
                    thumb.className = 'painting-slider__thumb';
                    if (index === 0) thumb.classList.add('active');
                    thumb.alt = `${painting.title} - изображение ${index + 1}`;
                    thumb.src = image;
                    thumb.style.objectFit = 'cover';
                    thumbsContainer.appendChild(thumb);
                    
                    thumb.addEventListener('click', () => {
                        if (isAnimating) return;
                        animateImageChange(index);
                        // Обновляем активное состояние
                        thumbsContainer.querySelectorAll('.painting-slider__thumb').forEach((t, i) => {
                            t.classList.toggle('active', i === index);
                        });
                    });
                });
            }

            // Настраиваем навигацию слайдера
            const prevBtn = modal.querySelector('.painting-slider__arrow--prev');
            const nextBtn = modal.querySelector('.painting-slider__arrow--next');
            
            console.log('Стрелки найдены:', {
                prevBtn: !!prevBtn,
                nextBtn: !!nextBtn,
                prevBtnElement: prevBtn,
                nextBtnElement: nextBtn
            });
            
            // Принудительно показываем стрелки
            if (prevBtn) {
                prevBtn.style.display = 'flex';
                prevBtn.style.visibility = 'visible';
                prevBtn.style.opacity = '1';
                prevBtn.style.zIndex = '1000';
            }
            if (nextBtn) {
                nextBtn.style.display = 'flex';
                nextBtn.style.visibility = 'visible';
                nextBtn.style.opacity = '1';
                nextBtn.style.zIndex = '1000';
            }
            
            // Используем глобальные переменные для модального окна
            // Фильтруем только существующие изображения
                if (painting.images && painting.images.length > 0) {
                painting.images = painting.images.filter(imagePath => {
                    // Проверяем, что путь не пустой и содержит правильный формат
                    return imagePath && imagePath.trim() !== '' && 
                           (imagePath.endsWith('.jpg') || imagePath.endsWith('.jpeg') || 
                            imagePath.endsWith('.png') || imagePath.endsWith('.JPG') || 
                            imagePath.endsWith('.JPEG') || imagePath.endsWith('.PNG'));
                });
            }
            currentModalPainting = painting;
            currentModalImageIndex = 0;

            const updateSlider = () => {
                if (!currentModalPainting) {
                    console.error('❌ currentModalPainting не установлена в updateSlider!');
                    return;
                }
                
                if (currentModalPainting.images && currentModalPainting.images.length > 0) {
                    const photoNumber = currentModalImageIndex + 1;
                    const totalPhotos = currentModalPainting.images.length;
                    const currentPhotoPath = currentModalPainting.images[currentModalImageIndex];
                    
                    console.log('📸 ===== ОТОБРАЖЕНИЕ ФОТОГРАФИИ =====');
                    console.log('📸 Картина:', currentModalPainting.title);
                    console.log('📸 Фотография номер:', photoNumber, 'из', totalPhotos);
                    console.log('📸 Индекс в массиве:', currentModalImageIndex);
                    console.log('📸 Путь к файлу:', currentPhotoPath);
                    console.log('📸 ======================================');
                    
                    if (newImage) {
                        // Добавляем обработчики ошибок загрузки
                        newImage.onerror = function() {
                            console.error('❌ ОШИБКА ЗАГРУЗКИ ИЗОБРАЖЕНИЯ:', currentPhotoPath);
                            console.error('❌ Картина:', currentModalPainting.title);
                            console.error('❌ Индекс:', currentModalImageIndex);
                            console.error('❌ Элемент изображения:', newImage);
                            console.error('❌ Текущий src:', newImage.src);
                            
                            // Показываем заглушку при ошибке загрузки
                            newImage.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDQwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNDAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0xNzUgMTI1SDIyNVYyNzVIMTc1VjEyNVoiIGZpbGw9IiNDQ0NDQ0MiLz4KPHBhdGggZD0iTTE1MCAyMDBIMjUwVjIyMEgxNTBWMjAwWiIgZmlsbD0iI0NDQ0NDQyIvPgo8L3N2Zz4K';
                        };
                        newImage.onload = function() {
                            console.log('✅ ИЗОБРАЖЕНИЕ ЗАГРУЖЕНО:', currentPhotoPath);
                            console.log('✅ Элемент изображения:', newImage);
                            console.log('✅ Текущий src:', newImage.src);
                            console.log('✅ Размеры изображения:', newImage.naturalWidth, 'x', newImage.naturalHeight);
                            console.log('✅ Computed styles:', {
                                display: getComputedStyle(newImage).display,
                                visibility: getComputedStyle(newImage).visibility,
                                opacity: getComputedStyle(newImage).opacity,
                                width: getComputedStyle(newImage).width,
                                height: getComputedStyle(newImage).height
                            });
                        };
                        newImage.src = currentPhotoPath;
                    }
                    // Сбрасываем зум при смене изображения
                    newImageContainer.classList.remove('zoomed');
                    // Обновляем активную миниатюру
                    thumbsContainer.querySelectorAll('.painting-slider__thumb').forEach((thumb, index) => {
                        thumb.classList.toggle('active', index === currentModalImageIndex);
                    });

                    // Обновляем видимость стрелок
                    const totalImages = currentModalPainting.images.length;
                    console.log('Обновляем стрелки:', {
                        totalImages,
                        currentModalImageIndex,
                        prevBtn: !!prevBtn,
                        nextBtn: !!nextBtn
                    });
                    
                    if (totalImages <= 1) {
                        if (prevBtn) {
                            prevBtn.style.display = 'none';
                            prevBtn.style.visibility = 'hidden';
                        }
                        if (nextBtn) {
                            nextBtn.style.display = 'none';
                            nextBtn.style.visibility = 'hidden';
                        }
                    } else if (currentModalImageIndex === 0) {
                        if (prevBtn) {
                            prevBtn.style.display = 'none';
                            prevBtn.style.visibility = 'hidden';
                        }
                        if (nextBtn) {
                            nextBtn.style.display = 'flex';
                            nextBtn.style.visibility = 'visible';
                        }
                    } else if (currentModalImageIndex === totalImages - 1) {
                        if (prevBtn) {
                            prevBtn.style.display = 'flex';
                            prevBtn.style.visibility = 'visible';
                        }
                        if (nextBtn) {
                            nextBtn.style.display = 'none';
                            nextBtn.style.visibility = 'hidden';
                        }
                    } else {
                        if (prevBtn) {
                            prevBtn.style.display = 'flex';
                            prevBtn.style.visibility = 'visible';
                        }
                        if (nextBtn) {
                            nextBtn.style.display = 'flex';
                            nextBtn.style.visibility = 'visible';
                        }
                    }
                } else {
                    console.log('❌ У картины нет изображений');
                    console.log('❌ Картина:', currentModalPainting.title);
                    console.log('❌ Массив images:', currentModalPainting.images);
                    console.log('❌ ======================================');
                    
                    // Показываем заглушку, если нет изображений
                    if (newImage) {
                        newImage.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDQwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNDAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0xNzUgMTI1SDIyNVYyNzVIMTc1VjEyNVoiIGZpbGw9IiNDQ0NDQ0MiLz4KPHBhdGggZD0iTTE1MCAyMDBIMjUwVjIyMEgxNTBWMjAwWiIgZmlsbD0iI0NDQ0NDQyIvPgo8L3N2Zz4K';
                    }
                    
                    // Скрываем стрелки навигации
                    if (prevBtn) {
                        prevBtn.style.display = 'none';
                        prevBtn.style.visibility = 'hidden';
                    }
                    if (nextBtn) {
                        nextBtn.style.display = 'none';
                        nextBtn.style.visibility = 'hidden';
                    }
                }
            };

            // Инициализируем слайдер
            updateModalSlider();

            // Удаляем старые обработчики, если они есть
            prevBtn.removeEventListener('click', handleModalPrevClick);
            nextBtn.removeEventListener('click', handleModalNextClick);
            
            // Добавляем новые обработчики
            prevBtn.addEventListener('click', handleModalPrevClick);
            nextBtn.addEventListener('click', handleModalNextClick);

            // Обработчик закрытия
            const closeModal = () => {
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                document.body.style.overflow = '';
                
                // Очищаем обработчики событий
                const prevBtn = modal.querySelector('#prev-arrow');
                const nextBtn = modal.querySelector('#next-arrow');
                if (prevBtn) prevBtn.removeEventListener('click', handleModalPrevClick);
                if (nextBtn) nextBtn.removeEventListener('click', handleModalNextClick);
                
                // Сбрасываем глобальные переменные модального окна
                currentModalPainting = null;
                currentModalImageIndex = 0;
                
                // Возвращаем URL к #gallery
                const baseURL = window.location.origin + window.location.pathname;
                const newURL = baseURL + '#gallery';
                if (window.location.href !== newURL) {
                    window.history.pushState({page: 'gallery'}, '', newURL);
                }
                
                console.log('🔄 Модальное окно закрыто, переменные и обработчики сброшены');
            };

            modal.querySelector('.painting-modal__close-btn').addEventListener('click', closeModal);
            const backBtn = modal.querySelector('.painting-modal__back-btn');
            if (backBtn) backBtn.addEventListener('click', closeModal);
            modal.querySelector('.painting-modal__overlay').addEventListener('click', closeModal);
            
            // Обработчик кнопки "Купить"
            const buyBtn = modal.querySelector('#buy-painting-btn');
            if (buyBtn) {
                buyBtn.addEventListener('click', function() {
                    console.log('🛒 Добавляем картину в корзину:', painting.title);
                    addToCart(painting);
                    closeModal();
                });
            }
            
            const mobileBuyBtn = modal.querySelector('#buy-painting-btn-mobile');
            if (mobileBuyBtn) {
                mobileBuyBtn.addEventListener('click', function() {
                    console.log('🛒 Добавляем картину в корзину (мобильная):', painting.title);
                    addToCart(painting);
                    closeModal();
                });
            }

            // Закрытие по Escape
            const handleEscape = (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                    document.removeEventListener('keydown', handleEscape);
                }
            };
            document.addEventListener('keydown', handleEscape);
        }

        // Функция для создания миниатюры изображения
        function createThumbnail(imageUrl, size = 150) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                // Убираем crossOrigin для GitHub изображений
                
                img.onload = function() {
                    try {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Вычисляем размеры для сохранения пропорций
                        const aspectRatio = img.width / img.height;
                        let thumbWidth = size;
                        let thumbHeight = size;
                        
                        if (aspectRatio > 1) {
                            thumbHeight = size / aspectRatio;
                        } else {
                            thumbWidth = size * aspectRatio;
                        }
                        
                        canvas.width = thumbWidth;
                        canvas.height = thumbHeight;
                        
                        // Рисуем сжатое изображение
                        ctx.drawImage(img, 0, 0, thumbWidth, thumbHeight);
                        
                        // Конвертируем в base64
                        const thumbnailUrl = canvas.toDataURL('image/jpeg', 0.7);
                        resolve(thumbnailUrl);
                    } catch (error) {
                        console.error('Ошибка создания миниатюры:', error);
                        // Если не удалось создать миниатюру, возвращаем оригинальный URL
                        resolve(imageUrl);
                    }
                };
                
                img.onerror = function() {
                    console.error('Ошибка загрузки изображения для миниатюры:', imageUrl);
                    // Если не удалось загрузить, возвращаем оригинальный URL
                    resolve(imageUrl);
                };
                
                img.src = imageUrl;
            });
        }

        // Обновление отображения галереи
        function updateGalleryDisplay() {
            initGallery(currentGalleryData, 'gallery-grid');
        }

        // Инициализация URL-маршрутизации
        function initURLRouting() {
            // Обработчик изменения URL (кнопка назад/вперед)
            window.addEventListener('popstate', function(event) {
                handleURLChange();
            });
            
            // Обработчик изменения хеша
            window.addEventListener('hashchange', function(event) {
                handleURLChange();
            });
            
            // Инициализируем текущую страницу по URL
            handleURLChange();
        }

        // Инициализация навигации
        function initNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            console.log('Найдено ссылок навигации:', navLinks.length);
            
            navLinks.forEach((link, index) => {
                console.log(`Ссылка ${index}:`, link.textContent, 'data-page:', link.getAttribute('data-page'));
                
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const page = this.getAttribute('data-page');
                    console.log('Клик по ссылке:', this.textContent, 'page:', page);
                    
                    if (page) {
                        showPage(page);
                    } else {
                        console.log('У ссылки нет data-page атрибута');
                    }
                });
            });
            
            // Добавляем обработчики для контактов отдельно (только для desktop и mobile в меню, НЕ для футера)
            const contactsLinks = document.querySelectorAll('#desktop-contacts-link, #mobile-contacts-link');
            contactsLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Клик по контактам');
                    
                    const contactsModal = document.getElementById('contacts-modal');
                    if (contactsModal) {
                        contactsModal.classList.add('active');
                    }
                });
            });
            
            // Для #contacts-link в футере делаем исключение - пусть работает mailto:
            const footerContactsLink = document.getElementById('contacts-link');
            if (footerContactsLink) {
                footerContactsLink.addEventListener('click', function(e) {
                    // НЕ вызываем preventDefault - пусть откроется почтовый клиент
                    console.log('Клик по email в футере - открываем почтовый клиент');
                });
            }
            
            // Мобильная кнопка галереи
            // Мобильная кнопка "Корзина"
            const mobileCartLink = document.querySelector('.mobile-cart-link');
            if (mobileCartLink) {
                mobileCartLink.addEventListener('click', function() {
                    showPage('order');
                });
            }
            
             // Мобильные кнопки галерей
    const mobileGallery1Link = document.querySelector('.mobile-gallery-link[data-page="gallery"]');
    const mobileGallery2Link = document.querySelector('.mobile-gallery-link[data-page="gallery2"]');
    
    if (mobileGallery1Link) {
        mobileGallery1Link.addEventListener('click', function() {
            showPage('gallery');
        });
    }
    
    if (mobileGallery2Link) {
        mobileGallery2Link.addEventListener('click', function() {
            showPage('gallery2');
        });
    }
            
            // Мобильная кнопка "Об авторе" в футере
            const mobileBioLink = document.querySelector('.mobile-bio-link');
            if (mobileBioLink) {
                mobileBioLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Клик по "Об авторе" в футере');
                    showPage('bio');
                });
            }
            
            // Мобильное меню
            const mobileMenu = document.querySelector('.mobile-menu');
            const mobileNav = document.querySelector('.mobile-nav');
            const closeMenu = document.querySelector('.close-menu');
            
            if (mobileMenu && mobileNav && closeMenu) {
                mobileMenu.addEventListener('click', function() {
                    mobileNav.classList.add('active');
                });
                
                closeMenu.addEventListener('click', function() {
                    mobileNav.classList.remove('active');
                });
                
                const mobileNavLinks = document.querySelectorAll('.mobile-nav .nav-link');
                mobileNavLinks.forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const page = this.getAttribute('data-page');
                        console.log('Клик по мобильной ссылке:', this.textContent, 'page:', page);
                        
                        if (page) {
                            showPage(page);
                            // Закрываем мобильное меню после перехода
                        mobileNav.classList.remove('active');
                        }
                    });
                });
                
            }
            initAdminAccessButtons();
            initPersonalCabinetModal();
        }

        // Инициализация модального окна контактов
        function initContactsModal() {
            const contactsLink = document.getElementById('contacts-link');
            const desktopContactsLink = document.getElementById('desktop-contacts-link');
            const mobileContactsLink = document.getElementById('mobile-contacts-link');
            const contactsModal = document.getElementById('contacts-modal');
            const closeContacts = document.getElementById('close-contacts');
            
            // Функция для обновления текста контактов в зависимости от устройства
            function updateContactsContent() {
                const isMobile = window.innerWidth <= 768;
                const contactItems = document.querySelectorAll('.contact-item');
                
                contactItems.forEach((item, index) => {
                    const link = item.querySelector('a');
                    if (link) {
                        if (isMobile) {
                            // Для мобильных устройств показываем только email полностью
                            if (index === 2) { // Email
                                link.textContent = 'tatiana.janart@gmail.com';
                            } else {
                                link.textContent = '';
                            }
                        } else {
                            // Для ПК показываем полную информацию
                            if (index === 0) { // Instagram
                                link.textContent = '@janart_studio';
                            } else if (index === 1) { // WhatsApp
                                link.textContent = '+7 (904) 606 81 07';
                            } else if (index === 2) { // Email
                                link.textContent = 'tatiana.janart@gmail.com';
                            }
                        }
                    }
                });
            }
            
            // Обновляем контакты при загрузке и изменении размера окна
            updateContactsContent();
            window.addEventListener('resize', updateContactsContent);
            
            // Удаляем обработчик для кнопки контактов в футере, так как теперь это прямая ссылка на email
            // if (contactsLink) {
            //     contactsLink.addEventListener('click', function(e) {
            //         e.preventDefault();
            //         contactsModal.classList.add('active');
            //     });
            // }
            
            // Обработчик для кнопки контактов в футере - открываем почтовый клиент
            if (contactsLink) {
                contactsLink.addEventListener('click', function(e) {
                    // Не предотвращаем стандартное поведение - пусть откроется mailto:
                    // e.preventDefault(); // НЕ вызываем preventDefault
                    // Просто позволим браузеру обработать ссылку mailto:
                });
            }
            
            if (desktopContactsLink) {
                desktopContactsLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    contactsModal.classList.add('active');
                });
            }
            
            if (mobileContactsLink) {
                mobileContactsLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    contactsModal.classList.add('active');
                    // Закрываем мобильное меню после выбора пункта
                    const mobileNav = document.querySelector('.mobile-nav');
                    if (mobileNav) {
                        mobileNav.classList.remove('active');
                    }
                });
            }
            
            if (closeContacts) {
                closeContacts.addEventListener('click', function() {
                    contactsModal.classList.remove('active');
                });
            }
            
            if (contactsModal) {
                contactsModal.addEventListener('click', function(e) {
                    if (e.target === contactsModal) {
                        contactsModal.classList.remove('active');
                    }
                });
            }
        }
        // Инициализация модального окна редактирования описания картины
        function initDescriptionModal() {
            console.log('=== Инициализация модального окна описания ===');
            const descriptionModal = document.getElementById('description-modal');
            const saveDescription = document.getElementById('save-description');
            const cancelDescription = document.getElementById('cancel-description');
            
            console.log('Элементы модального окна:', {
                descriptionModal,
                saveDescription,
                cancelDescription
            });
            const shapeRadios = document.querySelectorAll('input[name="shape-type"]');
            const overlaySettings = document.getElementById('overlay-settings');
            const colorPresets = document.querySelectorAll('.color-preset');
            const colorInput = document.getElementById('overlay-color');
            
            let currentPaintingIndex = null;
            
            // Система управления цветовой историей
            function loadColorHistory() {
                const saved = localStorage.getItem('colorHistory');
                return saved ? JSON.parse(saved) : ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff', '#5f27cd'];
            }
            
            function saveColorHistory(colors) {
                localStorage.setItem('colorHistory', JSON.stringify(colors));
            }
            
            function addColorToHistory(color) {
                let colors = loadColorHistory();
                // Удаляем цвет, если он уже есть
                colors = colors.filter(c => c !== color);
                // Добавляем в начало
                colors.unshift(color);
                // Оставляем только 8 цветов
                colors = colors.slice(0, 8);
                saveColorHistory(colors);
                updateColorPresets();
            }
            
            function updateColorPresets() {
                const colors = loadColorHistory();
                const presetsContainer = document.getElementById('color-presets');
                presetsContainer.innerHTML = '';
                
                colors.forEach(color => {
                    const preset = document.createElement('div');
                    preset.className = 'color-preset';
                    preset.style.background = color;
                    preset.setAttribute('data-color', color);
                    preset.addEventListener('click', function() {
                        const colorInput = document.getElementById('overlay-color');
                        colorInput.value = color;
                        // Убираем активный класс с всех пресетов
                        document.querySelectorAll('.color-preset').forEach(p => p.classList.remove('active'));
                        // Добавляем активный класс к выбранному
                        this.classList.add('active');
                    });
                    presetsContainer.appendChild(preset);
                });
            }
            
            // Инициализируем цветовые пресеты
            updateColorPresets();
            
            // Обработчик изменения формы таблички
            shapeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'none') {
                        overlaySettings.style.display = 'none';
                    } else {
                        overlaySettings.style.display = 'block';
                    }
                });
            });
            
            // Обработчики для цветовых пресетов теперь в updateColorPresets()
            
            // Обработчик изменения цвета через input
            colorInput.addEventListener('change', function() {
                // Добавляем цвет в историю
                addColorToHistory(this.value);
                // Убираем активный класс с всех пресетов
                document.querySelectorAll('.color-preset').forEach(p => p.classList.remove('active'));
            });
            
            // Функция открытия модального окна
            window.openDescriptionModal = function(paintingIndex) {
                console.log('=== openDescriptionModal вызвана ===');
                console.log('Индекс картины:', paintingIndex);
                currentPaintingIndex = paintingIndex;
                const painting = (galleryData && galleryData.paintings) ? galleryData.paintings[paintingIndex] : null;
                console.log('Картина найдена:', painting);
                
                if (painting) {
                    console.log('Заполняем форму данными картины:', painting);
                    const titleField = document.getElementById('painting-title-modal');
                    const priceField = document.getElementById('painting-price-modal');
                    const sizeField = document.getElementById('painting-size-modal');
                    const descriptionField = document.getElementById('painting-description-modal');
                    
                    if (titleField) titleField.value = painting.title || '';
                    if (priceField) priceField.value = painting.price || '';
                    if (sizeField) sizeField.value = painting.size || '';
                    if (descriptionField) descriptionField.value = painting.description || '';
                    
                    console.log('Форма заполнена значениями:');
                    console.log('  title:', titleField ? titleField.value : 'не найдено');
                    console.log('  price:', priceField ? priceField.value : 'не найдено');
                    console.log('  size:', sizeField ? sizeField.value : 'не найдено');
                    console.log('  description:', descriptionField ? descriptionField.value : 'не найдено');
                    
                    // Устанавливаем значения для таблички
                    const overlayData = painting.overlay || { type: 'none', text: '', color: '#ff6b6b' };
                    const shapeRadio = document.querySelector(`input[name="shape-type"][value="${overlayData.type}"]`);
                    if (shapeRadio) shapeRadio.checked = true;
                    const overlayTextInput = document.getElementById('overlay-text');
                    const overlayColorInput = document.getElementById('overlay-color');
                    if (overlayTextInput) overlayTextInput.value = overlayData.text || '';
                    if (overlayColorInput) overlayColorInput.value = overlayData.color || '#ff6b6b';
                    
                    // Показываем/скрываем настройки таблички
                    if (overlayData.type === 'none') {
                        overlaySettings.style.display = 'none';
                    } else {
                        overlaySettings.style.display = 'block';
                    }
                }
                
                console.log('Модальное окно найдено:', descriptionModal);
                if (descriptionModal) {
                    descriptionModal.classList.add('active');
                    console.log('Модальное окно активировано');
                } else {
                    console.error('Модальное окно не найдено!');
                }
                console.log('=== Конец openDescriptionModal ===');
            };
            
            // Обработчики кнопок
            
            if (cancelDescription) {
                cancelDescription.addEventListener('click', function() {
                    descriptionModal.classList.remove('active');
                });
            }
            
            if (saveDescription) {
                saveDescription.addEventListener('click', function() {
                    console.log('=== Сохранение описания картины ===');
                    if (currentPaintingIndex !== null) {
                        const painting = (galleryData && galleryData.paintings) ? galleryData.paintings[currentPaintingIndex] : null;
                        console.log('Картина до изменения:', painting);
                        
                        // Обновляем данные картины
                        const titleElement = document.getElementById('painting-title-modal');
                        const priceElement = document.getElementById('painting-price-modal');
                        const sizeElement = document.getElementById('painting-size-modal');
                        const descriptionElement = document.getElementById('painting-description-modal');
                        
                        console.log('Элементы формы найдены:');
                        console.log('  titleElement:', titleElement);
                        console.log('  priceElement:', priceElement);
                        console.log('  sizeElement:', sizeElement);
                        console.log('  descriptionElement:', descriptionElement);
                        
                        const newTitle = titleElement ? titleElement.value : '';
                        const newPrice = priceElement ? priceElement.value : '';
                        const newSize = sizeElement ? sizeElement.value : '';
                        const newDescription = descriptionElement ? descriptionElement.value : '';
                        
                        console.log('Новые значения из формы:');
                        console.log('  title:', newTitle);
                        console.log('  price:', newPrice);
                        console.log('  size:', newSize);
                        console.log('  description:', newDescription);
                        
                        // Дополнительная проверка - читаем значения напрямую из элементов
                        console.log('Прямое чтение из элементов:');
                        console.log('  titleElement.value:', titleElement ? titleElement.value : 'не найдено');
                        console.log('  priceElement.value:', priceElement ? priceElement.value : 'не найдено');
                        console.log('  sizeElement.value:', sizeElement ? sizeElement.value : 'не найдено');
                        console.log('  descriptionElement.value:', descriptionElement ? descriptionElement.value : 'не найдено');
                        
                        painting.title = newTitle;
                        painting.price = newPrice;
                        painting.size = newSize;
                        painting.description = newDescription;
                        
                        // Обновляем данные таблички
                        const shapeElement = document.querySelector('input[name="shape-type"]:checked');
                        const overlayTextElement = document.getElementById('overlay-text');
                        const overlayColorElement = document.getElementById('overlay-color');
                        
                        console.log('Элементы таблички найдены:');
                        console.log('  shapeElement:', shapeElement);
                        console.log('  overlayTextElement:', overlayTextElement);
                        console.log('  overlayColorElement:', overlayColorElement);
                        
                        const selectedShape = shapeElement ? shapeElement.value : 'none';
                        const overlayText = overlayTextElement ? overlayTextElement.value : '';
                        const overlayColor = overlayColorElement ? overlayColorElement.value : '#ff6b6b';
                        
                        console.log('Новые значения таблички:');
                        console.log('  shape:', selectedShape);
                        console.log('  text:', overlayText);
                        console.log('  color:', overlayColor);
                        
                        painting.overlay = {
                            type: selectedShape,
                            text: overlayText,
                            color: overlayColor
                        };
                        
                        console.log('Картина после изменения:', painting);
                        
                        // Сохраняем в GitHub через общий путь
                        saveGalleryDataComplete().then(() => {
                            console.log('Данные сохранены в GitHub');
                        }).catch(error => {
                            console.error('Ошибка сохранения в GitHub:', error);
                        });
                        
                        // Обновляем отображение
                        updateGalleryDisplay();
                        loadPaintingsList();
                        
                        // Если открыт раздел управления фотографиями — держим его открытым и обновляем список текущей картины
                        setTimeout(() => {
                            const photosSection = document.getElementById('photos-management-content');
                            const photosHeader = document.getElementById('photos-management-header');
                            const photosArrow = document.getElementById('photos-management-arrow');
                            const section = photosHeader ? photosHeader.closest('.admin-section.collapsible') : null;
                            if (section && section.classList.contains('collapsed')) {
                                section.classList.remove('collapsed');
                                if (photosSection) photosSection.style.maxHeight = photosSection.scrollHeight + 'px';
                                if (photosArrow) photosArrow.textContent = '▲';
                            } else if (photosSection) {
                                photosSection.style.maxHeight = photosSection.scrollHeight + 'px';
                            }
                            // открыть управление для текущей картины
                            if (typeof openPhotosManagement === 'function' && currentPaintingIndex !== null) {
                                openPhotosManagement(currentPaintingIndex + 1);
                            }
                        }, 200);
                        
                        descriptionModal.classList.remove('active');
                        console.log('=== Конец сохранения ===');
                    }
                });
            }
            
            // Закрытие по клику вне модального окна
            // Модальное окно закрывается только при нажатии кнопок "Отмена" или "Сохранить"
        }

        // Инициализация форм
        function initForms() {
            const contactForm = document.querySelector('.contact-form');
            if (contactForm) {
                contactForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    alert('Сообщение отправлено! Я свяжусь с вами в ближайшее время.');
                    contactForm.reset();
                });
            }
        }

        // Показать страницу
        // Функция для установки текущей галереи
// Функция для установки текущей галереи
function getGalleryDisplayName(type = currentGalleryType) {
    return type === 'gallery' ? 'Галерея' : 'Мастер-класс';
}

function setCurrentGallery(galleryType) {
    currentGalleryType = galleryType;
    console.log(`📁 Текущая галерея установлена: ${galleryType}`);
    logGalleryState();
    
    updateAdminGalleryIndicator();

    const adminPanel = document.getElementById('admin-panel');
    if (adminPanel && adminPanel.style.display !== 'none') {
        updateAdminPanelTitle(getGalleryDisplayName());
    }
}
// Функция для обновления индикатора текущей галереи в админ-панели
function updateAdminGalleryIndicator() {
    const indicator = document.getElementById('current-gallery-indicator');
    if (!indicator) return;
    
    indicator.textContent = `(${getGalleryDisplayName()})`;
}
        function showPage(pageId) {
    console.log('showPage вызвана с pageId:', pageId);
    
    // Обработка галерей
    if (pageId === 'gallery2' && !masterClassVisible) {
        alert('Мастер-класс временно закрыт для посетителей');
        pageId = 'gallery';
    }

    if (pageId === 'gallery') {
        setCurrentGallery('gallery');
        loadGalleryDataForCurrent();
        showGallery();
    } else if (pageId === 'gallery2') {
        setCurrentGallery('gallery2');
        loadGalleryDataForCurrent();
        showGallery();
    }
            
            // Закрываем модальное окно картины, если оно открыто (кроме случая когда открываем картину из URL)
            if (pageId !== 'gallery' || !window.location.hash.match(/^#gallery\/\d+$/)) {
                const modal = document.getElementById('painting-modal');
                if (modal && modal.style.display === 'flex') {
                    modal.style.display = 'none';
                    modal.style.visibility = 'hidden';
                    modal.style.opacity = '0';
                    document.body.style.overflow = '';
                    currentModalPainting = null;
                    currentModalImageIndex = 0;
                    console.log('🔄 Модальное окно закрыто при переходе на страницу:', pageId);
                }
            }
            
            // Скрываем все возможные страницы
            const allPages = document.querySelectorAll('.page, .product-page, .bio-page, .contact-page');
            console.log('Найдено страниц для скрытия:', allPages.length);
            allPages.forEach(page => {
                page.style.display = 'none';
            });
            
            // Показываем нужную страницу
            const targetPage = document.getElementById(`${pageId}-page`);
            console.log('Целевая страница:', targetPage);
            if (targetPage) {
                targetPage.style.display = 'block';
                console.log('✅ Страница показана:', pageId);
                
                // Если переходим на страницу заказа, обновляем отображение корзины
                if (pageId === 'order') {
                    updateCartDisplay();
                }
                
                // Дополнительная проверка для главной страницы
                if (pageId === 'home') {
                    console.log('🏠 Переход на главную страницу выполнен');
                }
                
                // Обработка страницы заказа
                if (pageId === 'order') {
                    console.log('🛒 Переход на страницу заказа');
                    updateCartDisplay();
                    handleAgreementCheckbox();
                    handleProceedToPayment();
                }
            } else {
                console.error('❌ Страница не найдена:', `${pageId}-page`);
            }
            
            // Принудительно обновляем данные при переходе на галерею
            if (pageId === 'gallery') {
                loadGalleryDataFromLocal().then(() => {
    initGallery(getCurrentGalleryData(), 'gallery-grid');
});
            }
            
            // Обновляем URL
            updateURL(pageId);
            
            // Всегда прокручиваем наверх
            window.scrollTo(0, 0);
        }
function loadGalleryDataForCurrent() {
    console.log('📥 Загрузка данных для текущей галереи:', currentGalleryType);
    
    if (currentGalleryType === 'gallery') {
        console.log('📥 Возвращаем galleryData:', galleryData.paintings ? galleryData.paintings.length : 0);
        return galleryData;
    } else if (currentGalleryType === 'gallery2') {
        console.log('📥 Возвращаем gallery2Data:', gallery2Data.paintings ? gallery2Data.paintings.length : 0);
        return gallery2Data;
    }
    
    console.log('⚠️ Неизвестный тип галереи, возвращаем galleryData');
    return galleryData;
}

// Функция для отображения галереи
function showGallery() {
    const currentGallery = loadGalleryDataForCurrent();
    const galleryPageId = currentGalleryType === 'gallery' ? 'gallery-page' : 'gallery2-page';
    const gridId = currentGalleryType === 'gallery' ? 'gallery-grid' : 'gallery2-grid';
    
    console.log('🖼️ ===== ПОКАЗ ГАЛЕРЕИ =====');
    console.log('🖼️ Тип галереи:', currentGalleryType);
    console.log('🖼️ ID страницы:', galleryPageId);
    console.log('🖼️ ID контейнера:', gridId);
    console.log('🖼️ Данные текущей галереи:', {
        paintings: currentGallery.paintings ? currentGallery.paintings.length : 0,
        firstFew: currentGallery.paintings ? currentGallery.paintings.slice(0, 3).map(p => p.title) : []
    });
    
    // Показываем нужную страницу
    document.querySelectorAll('.page').forEach(page => {
        page.style.display = 'none';
    });
    document.getElementById(galleryPageId).style.display = 'block';
    
    // Инициализируем галерею с правильными данными
    initGallery(currentGallery, gridId);
}
        // Обновить URL
        function updateURL(page) {
            // Не обновляем URL если открыта админ-панель
            if (window.location.hash === '#admin12345') {
                return;
            }
            
            const baseURL = window.location.origin + window.location.pathname;
            let newURL = baseURL;
            
            switch(page) {
                case 'gallery':
                    newURL = baseURL + '#gallery';
                    break;
                case 'about':
                case 'bio':
                    newURL = baseURL + '#bio';
                    break;
                case 'contacts':
                    newURL = baseURL + '#contacts';
                    break;
                case 'order':
                    newURL = baseURL + '#order';
                    break;
                case 'agreement':
                    newURL = baseURL + '#agreement';
                    break;
                case 'pricing':
                    newURL = baseURL + '#pricing';
                    break;
                case 'refund':
                    newURL = baseURL + '#refund';
                    break;
                case 'home':
                default:
                    newURL = baseURL;
                    break;
            }
            
            // Обновляем URL без перезагрузки страницы
            if (window.location.href !== newURL) {
                window.history.pushState({page: page}, '', newURL);
            }
        }
        
        // Обработчик изменения URL
        function handleURLChange() {
            const hash = window.location.hash.substring(1);
            
            // Проверяем, не админ-панель ли это
            if (hash === 'admin12345') {
                showAdminPanel();
                return;
            }
            
            // Проверяем, не открыта ли конкретная картина (#gallery/{index})
            const galleryMatch = hash.match(/^gallery\/(\d+)$/);
            if (galleryMatch) {
                const paintingIndex = parseInt(galleryMatch[1], 10) - 1; // Индекс начинается с 0
                
                // Показываем страницу галереи
                showPage('gallery');
                
                // Ждем, чтобы галерея успела инициализироваться
                // Используем несколько попыток для надежности
                let attempts = 0;
                const maxAttempts = 20; // Максимум 2 секунды (20 * 100ms)
                
                const tryOpenPainting = () => {
                    attempts++;
                    
                    // Получаем отфильтрованный список картин
                    const currentGalleryItems = galleryData.paintings || [];
                    const validGalleryItems = currentGalleryItems.filter(item => item && item.images && item.images.length > 0);
                    
                    // Проверяем, что галерея инициализирована и есть картины
                    if (validGalleryItems.length > 0) {
                        // Проверяем, что индекс валидный
                        if (paintingIndex >= 0 && paintingIndex < validGalleryItems.length) {
                            const painting = validGalleryItems[paintingIndex];
                            if (painting) {
                                console.log('🎨 Открываем картину по URL:', painting.title, 'индекс:', paintingIndex);
                                showPaintingModal(painting, paintingIndex);
                                return; // Успешно открыли, выходим
                            }
                        } else {
                            console.warn('⚠️ Неверный индекс картины:', paintingIndex, 'всего картин:', validGalleryItems.length);
                            return; // Неверный индекс, выходим
                        }
                    } else if (attempts < maxAttempts) {
                        // Галерея еще не готова, пробуем еще раз
                        setTimeout(tryOpenPainting, 100);
                    } else {
                        console.error('❌ Не удалось открыть картину: галерея не инициализирована');
                    }
                };
                
                // Начинаем попытки открыть картину
                setTimeout(tryOpenPainting, 100);
                
                return;
            }
            
            let page = 'home';
            
            switch(hash) {
                case 'gallery':
                    page = 'gallery';
                    // Если модальное окно открыто, закрываем его
                    const modal = document.getElementById('painting-modal');
                    if (modal && modal.style.display === 'flex') {
                        modal.style.display = 'none';
                        modal.style.visibility = 'hidden';
                        modal.style.opacity = '0';
                        document.body.style.overflow = '';
                        currentModalPainting = null;
                        currentModalImageIndex = 0;
                        console.log('🔄 Модальное окно закрыто при переходе на #gallery');
                    }
                    break;
                case 'about':
                case 'bio':
                    page = 'bio';
                    break;
                case 'contacts':
                    page = 'contacts';
                    break;
                case 'order':
                    page = 'order';
                    break;
                case 'agreement':
                    page = 'agreement';
                    break;
                case 'pricing':
                    page = 'pricing';
                    break;
                case 'refund':
                    page = 'refund';
                    break;
                default:
                    page = 'home';
                    break;
            }
            
            showPage(page);
        }

        // Показать страницу товара
        function showProduct(product) {
            currentProduct = product;
            currentImageIndex = 0;
            const productPage = document.getElementById('product-page');
            
            productPage.innerHTML = `
                <div class="back-button" id="back-to-gallery">← Назад в галерею</div>
                <div class="product-container">
                    <div class="product-gallery">
                        <div class="product-thumbnails" id="thumbnailsContainer">
                            ${product.images.map((image, index) => `
                                <div class="product-thumbnail ${index === 0 ? 'active' : ''}" data-image="${image}" data-index="${index}">
                                    <img src="${image}" alt="Миниатюра ${index + 1}">
                                    ${product.overlay && product.overlay.type !== 'none' ? `<div class="painting-overlay ${product.overlay.type}" style="background-color: ${product.overlay.color};">${product.overlay.text}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                        <div class="product-image-main" id="product-image-container">
                            <img src="${product.images[0]}" alt="${product.title}" id="main-product-image">
                            <button class="nav-arrow prev" id="prev-arrow"></button>
                            <button class="nav-arrow next" id="next-arrow"></button>
                            ${product.overlay && product.overlay.type !== 'none' ? `<div class="painting-overlay ${product.overlay.type}" style="background-color: ${product.overlay.color};">${product.overlay.text}</div>` : ''}
                        </div>
                    </div>
                    <div class="product-details">
                        <h1 class="product-title">${product.title}</h1>
                        <div class="product-price">${product.price}</div>
                        <div class="product-size">${product.size}</div>
                        <div class="product-description">
                            <p>${product.description}</p>
                            <p>Картина поставляется без рамы.</p>
                        </div>
                        <button class="add-to-cart">Добавить в корзину</button>
                    </div>
                </div>
            `;
            
            initThumbnails(product);
            initSwipeNavigation();
            initArrowNavigation();
            
            document.getElementById('back-to-gallery').addEventListener('click', function() {
                showPage('gallery');
            });
            
            const addToCartBtn = document.querySelector('.add-to-cart');
            if (addToCartBtn) {
                addToCartBtn.addEventListener('click', function() {
                    alert('Товар добавлен в корзину!');
                });
            }
            
            showPage('product');
        }

        // Инициализация миниатюр
        function initThumbnails(product) {
            const thumbnails = document.querySelectorAll('.product-thumbnail');
            thumbnails.forEach(thumbnail => {
                thumbnail.addEventListener('click', function() {
                    thumbnails.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    const mainImage = document.getElementById('main-product-image');
                    mainImage.src = this.getAttribute('data-image');
                    currentImageIndex = parseInt(this.getAttribute('data-index'));
                    
                    mainImage.style.maxWidth = '100%';
                    mainImage.style.maxHeight = '65vh';
                    mainImage.style.width = 'auto';
                    mainImage.style.height = 'auto';
                    mainImage.style.objectFit = 'contain';
                    
                    // Обновляем табличку при переключении изображений
                    const overlayContainer = document.querySelector('#product-image-container .painting-overlay');
                    if (overlayContainer) {
                        overlayContainer.remove();
                    }
                    if (product.overlay && product.overlay.type !== 'none') {
                        const overlay = document.createElement('div');
                        overlay.className = `painting-overlay ${product.overlay.type}`;
                        overlay.style.backgroundColor = product.overlay.color;
                        overlay.textContent = product.overlay.text;
                        document.getElementById('product-image-container').appendChild(overlay);
                    }
                });
            });
        }
        // Инициализация свайп-навигации
        function initSwipeNavigation() {
            const imageContainer = document.getElementById('product-image-container');
            const mainImage = document.getElementById('main-product-image');
            
            if (!imageContainer || !mainImage) return;
            
            imageContainer.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
            });
            
            imageContainer.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });
        }

        // Инициализация навигации стрелками
        function initArrowNavigation() {
            const prevArrow = document.getElementById('prev-arrow');
            const nextArrow = document.getElementById('next-arrow');
            
            if (prevArrow) {
                prevArrow.addEventListener('click', showPreviousImage);
            }
            
            if (nextArrow) {
                nextArrow.addEventListener('click', showNextImage);
            }
        }

        // Обработка нажатий клавиш
        function handleKeyPress(e) {
            // Проверяем, открыто ли модальное окно картины
            const paintingModal = document.getElementById('painting-modal');
            if (paintingModal && paintingModal.style.display === 'flex') {
                if (e.key === 'ArrowLeft') {
                    const oldIndex = currentModalImageIndex;
                    const oldPhotoNumber = oldIndex + 1;
                    
                    console.log('⌨️ ===== НАЖАТИЕ СТРЕЛКИ ВЛЕВО =====');
                    console.log('⌨️ Картина:', currentModalPainting.title);
                    console.log('⌨️ Текущая фотография:', oldPhotoNumber, 'из', currentModalPainting.images.length);
                    
                    if (currentModalPainting && currentModalImageIndex > 0) {
                        currentModalImageIndex--;
                        const newPhotoNumber = currentModalImageIndex + 1;
                        
                        console.log('⌨️ Переходим к фотографии номер:', newPhotoNumber);
                        console.log('⌨️ ======================================');
                        
                        updateModalSlider();
                    } else {
                        console.log('⌨️ Невозможно перейти назад (уже на первой фотографии)');
                        console.log('⌨️ ======================================');
                    }
                } else if (e.key === 'ArrowRight') {
                    const oldIndex = currentModalImageIndex;
                    const oldPhotoNumber = oldIndex + 1;
                    
                    console.log('⌨️ ===== НАЖАТИЕ СТРЕЛКИ ВПРАВО =====');
                    console.log('⌨️ Картина:', currentModalPainting.title);
                    console.log('⌨️ Текущая фотография:', oldPhotoNumber, 'из', currentModalPainting.images.length);
                    
                    if (currentModalPainting && currentModalImageIndex < currentModalPainting.images.length - 1) {
                        currentModalImageIndex++;
                        const newPhotoNumber = currentModalImageIndex + 1;
                        
                        console.log('⌨️ Переходим к фотографии номер:', newPhotoNumber);
                        console.log('⌨️ ======================================');
                        
                        updateModalSlider();
                    } else {
                        console.log('⌨️ Невозможно перейти вперед (уже на последней фотографии)');
                        console.log('⌨️ ======================================');
                    }
                }
                return;
            }
            
            // Обработка для страницы товара
            if (document.getElementById('product-page').style.display === 'block') {
                if (e.key === 'ArrowLeft') {
                    showPreviousImage();
                } else if (e.key === 'ArrowRight') {
                    showNextImage();
                }
            }
        }

        // Обновить слайдер модального окна
        function updateModalSlider() {
            const photoNumber = currentModalImageIndex + 1;
            const totalPhotos = currentModalPainting.images.length;
            const currentPhotoPath = currentModalPainting.images[currentModalImageIndex];
            
            console.log('⌨️ ===== ОБНОВЛЕНИЕ ЧЕРЕЗ КЛАВИАТУРУ =====');
            console.log('⌨️ Картина:', currentModalPainting.title);
            console.log('⌨️ Фотография номер:', photoNumber, 'из', totalPhotos);
            console.log('⌨️ Индекс в массиве:', currentModalImageIndex);
            console.log('⌨️ Путь к файлу:', currentPhotoPath);
            console.log('⌨️ ==========================================');
            
            if (!currentModalPainting) return;
            
            const modal = document.getElementById('painting-modal');
            if (!modal) return;
            
            const newImage = modal.querySelector('.painting-slider__image');
            const thumbsContainer = modal.querySelector('.painting-slider__thumbs');
            const prevBtn = modal.querySelector('.painting-slider__arrow--prev');
            const nextBtn = modal.querySelector('.painting-slider__arrow--next');
            
            if (newImage && currentModalPainting.images && currentModalPainting.images.length > 0) {
                newImage.src = currentPhotoPath;
                
                // Обновляем активную миниатюру
                if (thumbsContainer) {
                    thumbsContainer.querySelectorAll('.painting-slider__thumb').forEach((thumb, index) => {
                        thumb.classList.toggle('active', index === currentModalImageIndex);
                    });
                }
                
                // Обновляем видимость стрелок
                const totalImages = currentModalPainting.images.length;
                if (totalImages <= 1) {
                    if (prevBtn) prevBtn.style.display = 'none';
                    if (nextBtn) nextBtn.style.display = 'none';
                } else if (currentModalImageIndex === 0) {
                    if (prevBtn) prevBtn.style.display = 'none';
                    if (nextBtn) nextBtn.style.display = 'flex';
                } else if (currentModalImageIndex === totalImages - 1) {
                    if (prevBtn) prevBtn.style.display = 'flex';
                    if (nextBtn) nextBtn.style.display = 'none';
                } else {
                    if (prevBtn) prevBtn.style.display = 'flex';
                    if (nextBtn) nextBtn.style.display = 'flex';
                }
            }
        }
        // Обработка свайпов
        function handleSwipe() {
            const minSwipeDistance = 50;
            
            if (!touchStartX || !touchEndX) return;
            
            const distance = touchStartX - touchEndX;
                        if (Math.abs(distance) < minSwipeDistance) return;
            
            if (distance > 0) {
                // Свайп влево - следующее изображение
                showNextImage();
            } else {
                // Свайп вправо - предыдущее изображение
                showPreviousImage();
            }
            
            // Сброс значений
            touchStartX = null;
            touchEndX = null;
        }

        // Показать предыдущее изображение
        function showPreviousImage() {
            if (!currentProduct) return;
            
            currentImageIndex--;
            if (currentImageIndex < 0) {
                currentImageIndex = currentProduct.images.length - 1;
            }
            
            updateMainImage();
        }

        // Показать следующее изображение
        function showNextImage() {
            if (!currentProduct) return;
            
            currentImageIndex++;
            if (currentImageIndex >= currentProduct.images.length) {
                currentImageIndex = 0;
            }
            
            updateMainImage();
        }

        // Обновить главное изображение
        function updateMainImage() {
            const mainImage = document.getElementById('main-product-image');
            const thumbnails = document.querySelectorAll('.product-thumbnail');
            
            if (mainImage && currentProduct) {
                mainImage.src = currentProduct.images[currentImageIndex];
                
                // Обновляем активную миниатюру
                thumbnails.forEach((thumbnail, index) => {
                    if (index === currentImageIndex) {
                        thumbnail.classList.add('active');
                    } else {
                        thumbnail.classList.remove('active');
                    }
                });
                
                // Прокручиваем миниатюры к активной
                const activeThumbnail = thumbnails[currentImageIndex];
                if (activeThumbnail) {
                    activeThumbnail.scrollIntoView({
                        behavior: 'smooth',
                        block: 'nearest',
                        inline: 'center'
                    });
                }
                
                // Обновляем табличку при переключении изображений
                const overlayContainer = document.querySelector('#product-image-container .painting-overlay');
                if (overlayContainer) {
                    overlayContainer.remove();
                }
                if (currentProduct.overlay && currentProduct.overlay.type !== 'none') {
                    const overlay = document.createElement('div');
                    overlay.className = `painting-overlay ${currentProduct.overlay.type}`;
                    overlay.style.backgroundColor = currentProduct.overlay.color;
                    overlay.textContent = currentProduct.overlay.text;
                    document.getElementById('product-image-container').appendChild(overlay);
                }
            }
        }
        // Функция для открытия админ-панели с проверкой пароля
// Функция для открытия админ-панели с выбором галереи и проверкой пароля
function openAdminPanel() {
    // Показываем диалог выбора галереи
    const galleryChoice = prompt(
        'Выберите галерею для редактирования:\n' +
        '1 - Галерея (Пароль: admin12345)\n' +
        '2 - Мастер-класс (Пароль: admin123456)\n\n' +
        'Введите номер галереи (1 или 2):'
    );
    
    if (galleryChoice === null) {
        // Пользователь нажал "Отмена"
        return;
    }
    
    // Проверяем выбор галереи
    let galleryType;
    let requiredPassword;
    let galleryName;
    
    if (galleryChoice === '1') {
        galleryType = 'gallery';
        requiredPassword = 'admin12345';
        galleryName = 'Галерея';
    } else if (galleryChoice === '2') {
        galleryType = 'gallery2';
        requiredPassword = 'admin123456';
        galleryName = 'Мастер-класс';
    } else {
        alert('Неверный выбор. Введите 1 или 2.');
        return;
    }
    
    // Запрашиваем пароль для выбранной галереи
    const password = prompt(`Введите пароль для доступа к ${galleryName}:`);
    
    if (password === requiredPassword) {
        // Устанавливаем текущую галерею
        setCurrentGallery(galleryType);
        
        // Показываем админ-панель
        showAdminPanel();
        
        // Обновляем заголовок админ-панели
        updateAdminPanelTitle(galleryName);
        
        // Устанавливаем URL для возможности поделиться ссылкой
        const hash = galleryType === 'gallery' ? '#admin12345' : '#admin123456';
        window.location.hash = hash;
        
        console.log(`✅ Админ вошел в ${galleryName}`);
    } else if (password !== null) {
        // Если пароль неверный и пользователь не нажал "Отмена"
        alert(`Неверный пароль для ${galleryName}`);
    }
}

// Функция для обновления заголовка админ-панели
function updateAdminPanelTitle(galleryName = getGalleryDisplayName()) {
    const adminHeader = document.querySelector('.admin-header h2');
    if (adminHeader) {
        adminHeader.textContent = `Панель администратора JANART STUDIO (${galleryName})`;
    }
}

// Инициализация обработчиков для кнопок личного кабинета
function initAdminAccessButtons() {
    // Десктопная кнопка
    const desktopAdminLink = document.getElementById('admin-access-link');
    if (desktopAdminLink) {
        desktopAdminLink.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            openPersonalCabinetModal();
        });
    }
    
    // Мобильная кнопка в меню
    const mobileAdminLink = document.getElementById('mobile-admin-access-link');
    if (mobileAdminLink) {
        mobileAdminLink.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            openPersonalCabinetModal();
            // Закрываем мобильное меню
            const mobileNav = document.querySelector('.mobile-nav');
            if (mobileNav) {
                mobileNav.classList.remove('active');
            }
        });
    }
}

const PERSISTENT_USER_KEY = 'janart_user_persist';

const userAuth = {
    apiBase: 'api/auth',
    async postJson(path, payload) {
        const response = await fetch(`${this.apiBase}/${path}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload || {})
        });
        const data = await response.json().catch(() => ({}));
        return { response, data };
    },
    async register(email) {
        const { response, data } = await this.postJson('register.php', { email });
        if (response.ok && data.ok) {
            return { success: true };
        }
        const error = data.error || `http_${response.status}`;
        return { success: false, error, message: mapAuthError(error) };
    },
    async login(email, password) {
        const { response, data } = await this.postJson('login.php', { email, password });
        if (response.ok && data.ok && data.user) {
            return { success: true, user: data.user };
        }
        const error = data.error || `http_${response.status}`;
        return { success: false, error, message: mapAuthError(error) };
    },
    async recover(email) {
        const { response, data } = await this.postJson('recover-password.php', { email });
        if (response.ok && data.ok) {
            return { success: true };
        }
        const error = data.error || `http_${response.status}`;
        return { success: false, error, message: mapAuthError(error) };
    },
    async change(email, oldPassword, newPassword) {
        const { response, data } = await this.postJson('change-password.php', { email, oldPassword, newPassword });
        if (response.ok && data.ok) {
            return { success: true };
        }
        const error = data.error || `http_${response.status}`;
        return { success: false, error, message: mapAuthError(error) };
    }
};

function mapAuthError(error) {
    switch (error) {
        case 'invalid_email':
            return 'Укажите корректный email';
        case 'email_exists':
            return 'Пользователь с таким email уже зарегистрирован';
        case 'user_not_found':
            return 'Указанный пользователь не найден';
        case 'invalid_password':
            return 'Введён неправильный пароль';
        case 'email_send_failed':
            return 'Не удалось отправить письмо. Проверьте почту позже или попробуйте снова.';
        case 'missing_password':
        case 'missing_passwords':
            return 'Заполните пароль';
        default:
            return 'Ошибка. Попробуйте ещё раз.';
    }
}

function savePersistentUser(user) {
    if (!user) return;
    const serialized = JSON.stringify(user);
    localStorage.setItem(PERSISTENT_USER_KEY, serialized);
    sessionStorage.setItem('janart_user', serialized);
}

function restorePersistentUser() {
    const stored = localStorage.getItem(PERSISTENT_USER_KEY);
    if (!stored) {
        return null;
    }
    sessionStorage.setItem('janart_user', stored);
    try {
        return JSON.parse(stored);
    } catch {
        return null;
    }
}

function forgetPersistentUser() {
    localStorage.removeItem(PERSISTENT_USER_KEY);
    sessionStorage.removeItem('janart_user');
}

restorePersistentUser();

function initPersonalCabinetModal() {
    const modal = document.getElementById('personal-cabinet-modal');
    if (!modal) return;
    const loginForm = document.getElementById('personal-login-form');
    const registerForm = document.getElementById('personal-register-form');
    const messageEl = document.getElementById('personal-cabinet-message');
    const closeButton = document.getElementById('personal-cabinet-close');

    function setMessage(text, type) {
        if (!messageEl) return;
        messageEl.textContent = text;
        messageEl.className = `auth-modal__message ${type || ''}`.trim();
    }

    function showModal() {
        modal.classList.add('active');
        modal.setAttribute('aria-hidden', 'false');
        loginForm.style.display = 'flex';
        registerForm.style.display = 'none';
        setMessage('', '');
    }

    function closeModal() {
        modal.classList.remove('active');
        modal.setAttribute('aria-hidden', 'true');
    }

    document.getElementById('personal-register-show').addEventListener('click', () => {
        loginForm.style.display = 'none';
        registerForm.style.display = 'flex';
        setMessage('', '');
    });
    document.getElementById('personal-register-back').addEventListener('click', () => {
        loginForm.style.display = 'flex';
        registerForm.style.display = 'none';
        setMessage('', '');
    });

    document.getElementById('personal-login-submit').addEventListener('click', async () => {
        const email = document.getElementById('personal-login-email').value;
        const password = document.getElementById('personal-login-password').value;

        if (email === 'admin12345' && password === 'admin12345') {
            setMessage('Запускаем админский режим...', 'success');
            setTimeout(() => {
                closeModal();
                openAdminPanel();
            }, 250);
            return;
        }

        setMessage('Проверяем данные...', '');
        const result = await userAuth.login(email, password);
        if (result.success) {
            savePersistentUser(result.user);
            setMessage('Данные сохранены. Добро пожаловать!', 'success');
            setTimeout(closeModal, 600);
        } else {
            setMessage(result.message, 'error');
        }
    });

    document.getElementById('personal-register-submit').addEventListener('click', async () => {
        const email = document.getElementById('personal-register-email').value;
        setMessage('Регистрируем...', '');
        const result = await userAuth.register(email);
        setMessage(result.success ? `Пароль отправлен на ${email}` : result.message, result.success ? 'success' : 'error');
        if (result.success) {
            document.getElementById('personal-register-email').value = '';
        }
    });

    document.getElementById('personal-forgot-password').addEventListener('click', async () => {
        const email = document.getElementById('personal-login-email').value;
        setMessage('Отправляем новый пароль...', '');
        const result = await userAuth.recover(email);
        setMessage(result.success ? `Новый пароль отправлен на ${email}` : result.message, result.success ? 'success' : 'error');
    });

    document.getElementById('show-change-password').addEventListener('click', () => {
        loginForm.style.display = 'none';
        registerForm.style.display = 'none';
        document.getElementById('personal-change-form').style.display = 'flex';
        setMessage('', '');
    });
    document.getElementById('personal-change-back').addEventListener('click', () => {
        document.getElementById('personal-change-form').style.display = 'none';
        loginForm.style.display = 'flex';
        registerForm.style.display = 'none';
        setMessage('', '');
    });

    document.getElementById('personal-change-submit').addEventListener('click', async () => {
        const email = document.getElementById('personal-change-email').value;
        const oldPassword = document.getElementById('personal-change-old').value;
        const newPassword = document.getElementById('personal-change-new').value;
        const confirm = document.getElementById('personal-change-confirm').value;

        if (newPassword !== confirm) {
            setMessage('Пароли не совпадают', 'error');
            return;
        }

        setMessage('Сохраняем новый пароль...', '');
        const result = await userAuth.change(email, oldPassword, newPassword);
        setMessage(result.success ? 'Пароль обновлён' : result.message, result.success ? 'success' : 'error');
        if (result.success) {
            document.getElementById('personal-change-form').style.display = 'none';
            loginForm.style.display = 'flex';
        }
    });

    closeButton.addEventListener('click', closeModal);
    modal.querySelector('.auth-modal__backdrop').addEventListener('click', closeModal);

    window.openPersonalCabinetModal = showModal;
}

function openPersonalCabinetModal() {
    const modal = document.getElementById('personal-cabinet-modal');
    if (!modal) return;
    modal.classList.add('active');
    modal.setAttribute('aria-hidden', 'false');
    const loginForm = document.getElementById('personal-login-form');
    const registerForm = document.getElementById('personal-register-form');
    loginForm.style.display = 'flex';
    registerForm.style.display = 'none';
    const messageEl = document.getElementById('personal-cabinet-message');
    if (messageEl) {
        messageEl.textContent = '';
        messageEl.className = 'auth-modal__message';
    }
}
    </script>
</body>
</html>
